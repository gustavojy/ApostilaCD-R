% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  brazilian,
]{book}
\title{Introdução à Ciência de Dados em R}
\author{Gustavo Jun Yakushiji\footnote{Graduando em Engenharia Agronômica - ESALQ/USP}; Cristian Marcelo Villegas Lobos\footnote{Professor Doutor do Departamento de Ciências Exatas - ESALQ/USP}}
\date{Agosto, 2022}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Introdução à Ciência de Dados em R},
  pdfauthor={Gustavo Jun Yakushiji; Cristian Marcelo Villegas Lobos},
  pdflang={pt-BR},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={blue},
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[left=3cm,right=3cm,top=3cm,bottom=3cm]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{float}
\let\origfigure\figure
\let\endorigfigure\endfigure
\renewenvironment{figure}[1][2] {
    \expandafter\origfigure\expandafter[H]
} {
    \endorigfigure
}
\usepackage[portuguese]{babel}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\ifXeTeX
  % Load polyglossia as late as possible: uses bidi with RTL langages (e.g. Hebrew, Arabic)
  \usepackage{polyglossia}
  \setmainlanguage[variant=brazilian]{portuguese}
\else
  \usepackage[main=brazilian]{babel}
% get rid of language-specific shorthands (see #6817):
\let\LanguageShortHands\languageshorthands
\def\languageshorthands#1{}
\fi
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{introduuxe7uxe3o}{%
\chapter[Introdução]{\texorpdfstring{Introdução\footnote{Esta apostila foi confeccionada a partir do \emph{Bookdown}. Todos os arquivos e códigos utilizados estão disponíveis em: \url{https://github.com/gustavojy/ApostilaCD-R}.}}{Introdução}}\label{introduuxe7uxe3o}}

A proposta desta apostila é compartilhar experiências sobre ciência de dados na linguagem de programação R, visando auxiliar àqueles que estão iniciando sua jornada nesta empreitada.

Antes de começarmos, levantaremos algumas perguntas norteadoras:

\begin{itemize}
\item
  O que é ciência de dados (\emph{Data Science})?
\item
  Quais são os primeiros passos a serem dados em R?
\item
  Quais as principais ferramentas aplicadas à ciência de dados em R?
\end{itemize}

Ao longo da apostila, construiremos as respostas para estas perguntas, cujo intuito principal é criar uma base sólida em programação na linguagem R aplicada à ciência de dados, a fim de dar maior autonomia ao leitor para que possa prosseguir em seus estudos.

\hypertarget{ciuxeancia-de-dados-e-r}{%
\chapter{Ciência de dados e R}\label{ciuxeancia-de-dados-e-r}}

\hypertarget{o-que-uxe9-ciuxeancia-de-dados}{%
\section{O que é Ciência de Dados?}\label{o-que-uxe9-ciuxeancia-de-dados}}

A ciência de dados, como o próprio termo sugere, consiste no estudo e análise de dados, com o objetivo de extrair informações relevantes, utilizando técnicas e conhecimentos multidisciplinares. Por mais que o termo tenha se popularizado fortemente nos últimos anos devido à massiva geração de dados em elevadas quantidades, diversidades e velocidades, sua concepção se origina no século passado, seja por nomes notáveis como o do matemático e estatístico \href{http://www.ru.ac.bd/wp-content/uploads/sites/25/2019/03/102_05_01_Tukey-Exploratory-Data-Analysis-1977.pdf}{John W. Tukey}, mas também por aqueles que atuavam nas áreas de negócios e de pesquisa que, sem a pretensão de nomear ou organizar uma nova área do conhecimento, poderiam ser considerados cientistas de dados.

A concepção recente de ciência de dados abrange pelo menos três grandes áreas do conhecimento, podendo ser descrita por um diagrama de Venn, idealizado em 2010, por \href{http://drewconway.com/zia/2013/3/26/the-data-science-venn-diagram}{Drew Conway}:

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/venn_pt} 

}

\caption{Diagrama de Venn da ciência de dados.}\label{fig:venn}
\end{figure}

O diagrama é composto pelo conjunto de habilidades \textbf{computacionais}, conhecimento de \textbf{matemática e estatística} e domínio da \textbf{área de conhecimento}. Assim, as intersecções entre os conjuntos resultam em certas habilidades, descritas da seguinte maneira:

\begin{itemize}
\item
  \textbf{Aprendizado de máquinas}: do termo em inglês \emph{machine learning}, consiste na intersecção entre as habilidades \textbf{computacionais} e de \textbf{matemática e estatística}. Utiliza estas bases para entender os modelos utilizados e detectar os padrões que serão replicados, a partir dos artifícios da programação, com o intuito de colocar em prática os algoritmos.
\item
  \textbf{Pesquisa tradicional}: é a intersecção entre as áreas da \textbf{matemática e estatística} e \textbf{área de conhecimento}. Consiste na aplicação das bases matemáticas e estatísticas para solucionar problemas de uma área de atuação específica, sendo uma prática comum e tradicional no meio da pesquisa, principalmente acadêmica.
\item
  \textbf{Zona de perigo}: a intersecção entre \textbf{habilidades computacionais} e \textbf{área de conhecimento} resulta em uma chamada \emph{zona de perigo}, pois quem se encontra nesta situação consegue resolver problemas aplicando algoritmos, porém sem ter bases teóricas para compreender ou averiguar os resultados.
\item
  \textbf{Ciência de dados}: a ciência de dados é o resultado da intersecção entre as três áreas - \textbf{habilidades computacionais}, \textbf{matemática e estatística} e \textbf{área de conhecimento}. Em teoria, um cientista de dados não possui total domínio destas três áreas, ou senão, possui especialização em alguma das três, contudo sabe aplicá-las para resolver problemas.
\end{itemize}

Tendo em vista as bases que definem um cientista de dados, entraremos no âmbito da programação, conhecendo um pouco mais sobre o software R.

\hypertarget{r-rstudio}{%
\section{R / RStudio}\label{r-rstudio}}

O R é uma das linguagens de programação mais utilizadas por cientistas de dados. Foi desenvolvido por Ross Ihaka e Robert Gentleman, na Universidade de Auckland, Nova Zelândia, em 1993. Iniciou como uma linguagem focada em programação estatística, mas que, ao longo do tempo, tornou-se cada vez mais encorpada e diversificada. Atualmente, o \href{https://www.r-project.org/foundation/}{\emph{R Development Core Team}} atua na manutenção e no desenvolvimento da linguagem, sendo composto por diversos membros, dentre eles, seus idealizadores.

Por ser um software gratuito de código aberto (\emph{Open source}), possibilitou a formação de uma comunidade que atua diretamente no desenvolvimento do programa, promovendo constantes facilidades, melhorias e inovações acessíveis ao público em geral. O compartilhamento de um conjunto de funções é dado através de \textbf{pacotes}, os quais devemos instalar para podermos utilizá-los. Detalharemos a instalação de pacotes na seção \ref{pacote}.

E, justamente, uma das principais contribuições idealizadas é o \textbf{RStudio}. O RStudio é uma IDE (\emph{Integrated Development Environment}), ou seja, um ambiente de trabalho que executa o R a partir de uma interface gráfica mais agradável e com diversas funcionalidades (Figura \ref{fig:rstudio-apresenta}), o que nos proporciona um maior conforto quando comparado ao R original, composto basicamente pelas janelas de script e console, como mostra a figura \ref{fig:r-original}.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/r_tela_basico} 

}

\caption{Tela do R original. Composto apenas pelo script e console.}\label{fig:r-original}
\end{figure}

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/rstudio_tela} 

}

\caption{Tela do RStudio. Como podemos perceber, bem diferente do R original.}\label{fig:rstudio-apresenta}
\end{figure}

Mais adiante, na subseção \ref{rstudio}, entraremos em mais detalhes sobre o ambiente do RStudio.

Vale salientar que o R pode ser utilizado sem o RStudio, porém o RStudio não funciona sem o R. No nosso caso, utilizaremos o RStudio para desenvolver nossas análises. Assim, precisamos ter instalados ambos os programas.

\hypertarget{instalando-o-r}{%
\subsection{Instalando o R}\label{instalando-o-r}}

O R está disponível para todos os sistemas operacionais. Sua instalação é feita via CRAN (\emph{Comprehensive R Archive Network}), ou seja, uma rede com diversos servidores localizados em várias regiões do mundo, os quais armazenam versões idênticas e atualizadas de códigos e documentações para o R. Assim, para instalar o R, recomenda-se selecionar o servidor mais próximo à sua região. A seguir está o passo a passo para o \emph{download}.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Acessar: \url{https://www.r-project.org/};
\item
  No canto superior esquerdo, clicar em \textbf{CRAN};
\item
  Selecionar o servidor (\emph{mirror}) mais próximo a você (perceba que há um servidor da ESALQ/USP-Piracicaba);
\item
  Escolha o link referente ao seu sistema operacional;
\item
  Sistemas operacionais:
\end{enumerate}

\begin{itemize}
\item
  \textbf{Windows}: após clicar em \emph{`Download R for Windows'}, selecione a opção \emph{`base'} e, posteriormente, \emph{`Download R x.x.x for Windows'}, sendo \emph{`x.x.x'} a versão mais recente a ser baixada;
\item
  \textbf{Linux}: após clicar em \emph{`Download R for Linux'}, selecione a distribuição que você utiliza e siga as instruções da página para instalar o R;
\item
  \textbf{MacOS}: após clicar em \emph{`Download R for macOS'}, selecione a opção mais recente do R, a partir do link \emph{`R-x.x.x.pkg'}, sendo \emph{`x.x.x'} a versão mais recente a ser baixada;
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Feito o download, abra o arquivo baixado e siga as instruções para a instalação. Uma vez que utilizaremos o R a partir do RStudio, não há necessidade de criar um ícone de inicialização do R na área de trabalho, portanto, apenas instale o R em seu computador.
\end{enumerate}

\hypertarget{instalando-o-rstudio}{%
\subsection{Instalando o RStudio}\label{instalando-o-rstudio}}

Uma vez feita a instalação do R, precisamos instalar o RStudio. Também está disponível para todos os sistemas operacionais e sua instalação pode ser feita a partir do link: \url{https://www.rstudio.com/products/rstudio/download/\#download}. Escolha a versão referente ao seu sistema operacional e siga as instruções para baixar a IDE em seu computador.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{imagens/rstudio_download} 

}

\caption{Na página referente ao link acima, vá até a seção ilustrada na figura. Lá encontraremos as versões disponíveis do RStudio, de acordo com o sistema operacional.}\label{fig:unnamed-chunk-2}
\end{figure}

\hypertarget{rstudio}{%
\subsection{Ambiente RStudio}\label{rstudio}}

Agora que temos o R e o RStudio instalados, vamos conhecer mais sobre o ambiente do RStudio.

\hypertarget{janelas}{%
\subsubsection*{Janelas}\label{janelas}}
\addcontentsline{toc}{subsubsection}{Janelas}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{imagens/rstudio_janelas_expl} 

}

\caption{O RStudio apresenta 4 janelas principais, algumas com abas específicas, cada qual apresentando funcionalidades particulares.}\label{fig:rstudio-janelas}
\end{figure}

A figura \ref{fig:rstudio-janelas} ilustra as quatro janelas presentes no RStudio, cada qual com suas particularidades e funções.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \emph{Script}: é a janela na qual escreveremos os códigos e comandos. Para abrir um novo \emph{script}, clique no ícone logo abaixo da aba \emph{file}, no canto esquerdo superior;
\item
  \emph{Console}: é onde o código roda e apresenta as saídas dos códigos redigidos no \emph{script}. Também podemos escrever comandos no \emph{console}, porém, ao contrário do \emph{script}, não há a possibilidade de edição, sendo necessário reescrevê-lo, caso preciso.
\item
  \emph{Environment}: é onde se localiza e armazena os objetos criados. O ícone da vassoura (presente ao lado do ícone \texttt{Import\ Dataset}) exclui os objetos criados. Esta janela contém outras abas, porém a \emph{Environment} é a principal dentre essas.
\item
  \emph{File}, \emph{Plots}, \emph{Packages}, \emph{Help} e \emph{Viewer}: esta janela contém cinco abas.
\end{enumerate}

\begin{itemize}
\item
  \emph{File}: apresenta os arquivos presentes no diretório do seu computador;
\item
  \emph{Plots}: permite a visualização dos gráficos gerados;
\item
  \emph{Packages}: mostra todos os pacotes instalados em seu RStudio;
\item
  \emph{Help}: retorna documentações referentes a funções as quais podemos saber mais detalhes sobre elas;
\item
  \emph{Viewer}: apresenta os resultados gerados a partir do R Markdown, Bookdown, dentre outras extensões relacionadas a execução de relatórios e documentos diversos.
\end{itemize}

\hypertarget{aparuxeancia}{%
\subsubsection*{Aparência}\label{aparuxeancia}}
\addcontentsline{toc}{subsubsection}{Aparência}

Podemos alterar a aparência do RStudio acessando a aba \texttt{Tools}, presente no menu superior, clicar em \texttt{Global\ Options...} e, posteriormente, na aba \texttt{Appearance}. Nela, pode-se alterar o tema de fundo, regular o \emph{zoom} do ambiente como um todo ou somente dos textos e alterar a fonte dos textos. Na figura \ref{fig:rstudio-tema1} esta ilustrado um exemplo de configuração da aparência do RStudio, e na figura \ref{fig:rstudio-tema2}, o resultado dessa alteração.

\begin{figure}

{\centering \includegraphics[width=0.6\linewidth]{imagens/rstudio_tema1} 

}

\caption{Podemos configurar a aparência do RStudio em diversos aspectos. Faça alguns testes e veja qual lhe agrada mais.}\label{fig:rstudio-tema1}
\end{figure}

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/rstudio_tema2} 

}

\caption{Um exemplo de alteração na aparência do RStudio.}\label{fig:rstudio-tema2}
\end{figure}

\hypertarget{etapas-da-ciuxeancia-de-dados}{%
\section{Etapas da Ciência de Dados}\label{etapas-da-ciuxeancia-de-dados}}

Agora que temos uma melhor noção sobre ciência de dados e o software R, vamos explorar as etapas que compõem o seu processo.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{imagens/etapas_cd} 

}

\caption{Etapas do trabalho em ciência de dados. O ato de programar abrange todos os processos do fluxograma.}\label{fig:dc-fluxo}
\end{figure}

O fluxograma da figura \ref{fig:dc-fluxo} representa as etapas que compõem o trabalho de um cientista de dados. A seguir, descreveremos brevemente as etapas, para termos noção sobre a relevância de cada uma delas.

\begin{itemize}
\item
  \textbf{Importar} (\emph{Import}): é a importação dos dados brutos para dentro do R, seja a partir de banco de dados presentes na web ou coletados pelo próprio cientista de dados. Basicamente é a etapa \emph{sine qua non} da ciência de dados, pois sem dados, não há o que analisar;
\item
  \textbf{Limpar/Arrumar} (\emph{Tidy}): limpar ou arrumar os dados significa organizá-los em uma estrutura consistente, que esteja de acordo com a semântica de um conjunto de dados, para que não haja problemas ao realizar as análises. Mais adiante, veremos como estruturar os dados de maneira desejável, designando cada variável a uma coluna e cada observação a uma linha, semalhante a uma planilha Excel;
\item
  \textbf{Transformar} (\emph{Transform}): a transformação consiste em selecionar as observações de interesse no banco de dados. Em outras palavras, reduzir o banco de dados para conter somente as informações necessárias para a análise. Também podemos criar novas variáveis em função das variáveis já existentes, além de gerar descrições estatísticas como média, variância, porcentagens, dentre outras;
\item
  \textbf{Visualizar} (\emph{Visualisation}): a visualização gráfica dos dados permite enxergar as informações com mais clareza, levantar novos questionamentos e até mesmo indicar se a pesquisa está no caminho correto ou não;
\item
  \textbf{Modelar} (\emph{Models}): os modelos são usados para responder as perguntas norteadoras, depois que a pergunta norteadora estiver suficientemente precisa. Entra em cena a matemática, estatística e a computação como ferramentas para sua realização.
\item
  \textbf{Comunicar} (\emph{Communication}): é a parte crítica de um projeto analítico (\emph{Data analysis}), pois é necessário expor os resultados de maneira inteligível para o público, seja ele técnico ou leigo;
\item
  \textbf{Programar} (\emph{Programming}): a programação abrange todas as etapas citadas anteriormente. Em ciência de dados, não precisamos ter um domínio avançado para começarmos um projeto, mas quanto mais se sabe, mais automático ficam as tarefas comuns e mais facilmente se resolve novos problemas.
\end{itemize}

Por último, podemos destacar o termo \emph{Wrangling}, que abrange as etapas de \textbf{Arrumar} e \textbf{Transformar}. Traduzindo o termo, podemos entender que essas etapas do processo são, literalmente, uma \emph{luta} para que se consiga deixar os dados de forma mais natural para serem analisados.

Na seção \ref{pacote}, vamos conhecer mais sobre o pacote \texttt{tidyverse}, o qual contém as principais funções a serem utilizadas ao longo desta apostila. Detalharemos os pacotes específicos para cada uma das etapas descritas anteriormente.

\hypertarget{pacote}{%
\section{\texorpdfstring{Pacote \texttt{tidyverse}}{Pacote tidyverse}}\label{pacote}}

O \texttt{tidyverse} é um ``pacote mestre'' que abrange diversos outros, cada qual apresentando diversas funcionalidades específicas para cada uma das etapas apresentadas no fluxograma do tópico anterior. O esquema a seguir relaciona as etapas que constituem o trabalho do cientista de dados com os respectivos pacotes.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{imagens/pacotes_cd} 

}

\caption{Para cada etapa do fluxograma de trabalho da ciência de dados, existem pacotes específicos no R.}\label{fig:unnamed-chunk-3}
\end{figure}

Nesta apostila, focaremos no pacote \texttt{tidyverse} aplicado às etapas de \textbf{Importar}, \textbf{Arrumar}, \textbf{Transformar} e \textbf{Visualizar}, apresentando as principais ferramentas a serem utilizadas. Apenas os pacotes relacionados às etapas de \textbf{Modelar} e \textbf{Comunicar} não estão presentes no \texttt{tidyverse}.

Assim sendo, vamos instalar o nosso primeiro pacote, o \texttt{tidyverse}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

A função \texttt{install.packages("nome\_do\_pacote")} instala o requerido pacote. Atente-se ao fato que o nome do pacote deve estar entre aspas.

Uma vez instalado, devemos carregar o pacote com a função \texttt{library()}, para que possamos utilizar as suas funcionalidades. Agora, o nome do pacote não precisa estar entre aspas. Esta função deve ser executada a cada nova seção inicializada no R.

Lembrando que, para executar um comando, devemos escrever os respectivos códigos no \emph{script} ou no \emph{console}.

Para rodar estas funções (além das demais outras que rodaremos), devemos selecionar a linha de código que se deseja executar e clicar no ícone `\emph{Run}', presente no canto superior direito da própria janela do \emph{script}, ou utilizar o atalho \texttt{ctrl\ +\ Enter} no teclado. Perceba que temos que rodar linha por linha de código ou selecionar todas as linhas do \emph{script} para então rodar o código de uma vez só.

Para se ter uma visão geral de quais pacotes estão presentes no \texttt{tidyverse}, utilizamos a função \texttt{tidyverse\_packages()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tidyverse\_packages}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "broom"         "cli"           "crayon"        "dbplyr"       
 [5] "dplyr"         "dtplyr"        "forcats"       "googledrive"  
 [9] "googlesheets4" "ggplot2"       "haven"         "hms"          
[13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
[17] "modelr"        "pillar"        "purrr"         "readr"        
[21] "readxl"        "reprex"        "rlang"         "rstudioapi"   
[25] "rvest"         "stringr"       "tibble"        "tidyr"        
[29] "xml2"          "tidyverse"    
\end{verbatim}

Perceba que o pacote \texttt{tidyverse} contém outros 30 pacotes. Dentre estes, utilizamos o \texttt{readr} e o \texttt{readxl} para importarmos os dados; o \texttt{tidyr} e o \texttt{tibble} para arrumar; o \texttt{dplyr}, \texttt{stringr}, \texttt{forcats} e \texttt{lubridate} para transformar; e por último, o \texttt{ggplot2} para visualizar.

Caso o leitor tenha curiosidade em saber mais detalhes sobre o \texttt{tidyverse}, acesse o link da página oficial do pacote: \url{https://www.tidyverse.org/packages/}.

Nos capítulos a seguir, abordaremos as etapas de \textbf{Importar}, \textbf{Arrumar}, \textbf{Transformar} e \textbf{Visualizar}, apresentando as principais utilidades e funções de cada um dos respectivos pacotes presentes no \texttt{tidyverse}. Mas antes, veremos alguns conceitos básicos para programarmos em R.

\hypertarget{nouxe7uxf5es-buxe1sicas-em-r}{%
\chapter{Noções básicas em R}\label{nouxe7uxf5es-buxe1sicas-em-r}}

Para trabalhar com ciência de dados em R, devemos ter algumas noções básicas de programação nessa linguagem. Os conceitos discutidos neste capítulo serão a base para aplicarmos as demais ferramentas ao longo da apostila.

\hypertarget{proj}{%
\section{Projetos}\label{proj}}

Uma funcionalidade importante do RStudio são os projetos. Ao criar um projeto, uma nova pasta é criada em seu computador. Nela, podemos (e devemos) direcionar os arquivos a serem utiilizados para o projeto, além de abrigar os novos arquivos criados para a análise.

Com isso, a criação de projetos nos proporciona uma melhor organização dos arquivos, separando-os de acordo com o projeto realizado no R. Além disso, facilita a importação de dados para dentro do R, como veremos no capítulo \ref{import}, referente à importação de dados.

Para criar um projeto, clique em \texttt{File}, presente no menu superior, depois em \texttt{New\ Project...}. Então, abrirá uma janela como o da imagem a seguir:

\begin{center}\includegraphics[width=0.5\linewidth]{imagens/criar_projeto} \end{center}

Clique em \texttt{New\ Directory}, \texttt{New\ Project} e nomeie seu projeto em \texttt{Directory\ name}. Em \texttt{Create\ project\ as\ subdirectory\ of:} escolha o diretório em seu computador (pasta) no qual seu novo projeto será alocado. Finalize clicando em \texttt{Create\ Project}.

Pronto, seu projeto está criado. No canto superior direito aparecerá o nome do projeto. Além disso, na aba \texttt{Files}, estarão todos os arquivos contidos na pasta referente ao projeto. Portanto, direcione todos os arquivos que você utilizará para a respectiva pasta do projeto em uso.

\begin{center}\includegraphics[width=0.8\linewidth]{imagens/projeto_aberto} \end{center}

Clicando no mesmo ícone o qual aparece o nome do projeto, podemos criar um novo projeto e abrir um projeto já existente. Por tanto, atente-se a qual projeto se encontra ativo.

\hypertarget{ajuda}{%
\section{Ajuda}\label{ajuda}}

Cada ferramenta presente no R contém uma documentação que explica a sua utilização. Para acessarmos tais documentos, podemos prosseguir das seguintes maneiras:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?mean}

\FunctionTok{help}\NormalTok{(mean)}
\end{Highlighting}
\end{Shaded}

Neste exemplo, queremos saber mais sobre a função \texttt{mean}, ou seja, função que calcula a média aritmética. Ao rodar um destes comandos, a documentação referente à função será aberta na aba \texttt{Help}. Nela conterá algumas descrições importantes, como a noção geral de uso da função, os argumentos aceitos e exemplos de utilização.

Portanto, caso tenha dúvidas sobre qualquer outra ferramenta - seja funções, \emph{data frames}, listas ou pacotes -, utilize o \texttt{help(nome\_da\_ferramenta)} ou o \texttt{?nome\_da\_ferramenta}. Ainda, pode-se utilizar o atalho \texttt{F1} do teclado, selecionando uma ferramenta presente no \emph{script} e clicar em \texttt{F1}.

Outra via de auxílio são as \emph{folhas de cola}, ou \textbf{Cheatsheets}. Basicamente, trazem resumos sobre as principais funções contidas em determinados pacotes. Seu acesso pode ser realizado em: \url{https://www.rstudio.com/resources/cheatsheets/} ou clicando na página inicial da aba \emph{Help}.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/rstudio_cheet} 

}

\caption{Cheetsheet do RStudio. Nela podemos verificar, de maneira geral, as principais funcionalidades presentes no ambiente do RStudio.}\label{fig:unnamed-chunk-9}
\end{figure}

Caso ainda tenha dúvidas, não exite em fazer uma busca no Google, encontrar tutoriais explicativos - seja no YouTube ou no próprio site do \href{https://www.rstudio.com/resources/webinars/}{RStudio} -, acessar fóruns de perguntas e respostas - como o \href{https://stackoverflow.com/}{Stack Overflow} e acessar o \href{https://rseek.org/}{Rseek} ou o \href{https://search.r-project.org/}{Search R-project}, que são buscadores específicos para assuntos relacionados ao R.

\hypertarget{comentuxe1rios}{%
\section{Comentários}\label{comentuxe1rios}}

Podemos inserir comentários dentro do \emph{script}, sem que estes interfiram na execução dos códigos. Fazer comentários ao longo do \emph{script} é muito importante para quem está começando, pois assim permite fazer registros para, posteriormente, revisar a utilizadade de certas funcionalidades ou realizar alguma manutenção no código. Além disso é muito relevante para que se possa compartilhar um código inteligível com outras pessoas.

Para inserir um comentário, basta colocar o símbolo \texttt{\#} antes da parte comentada.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{imagens/comentario} 

}

\caption{Perceba que os comentários apresentam uma coloração diferenciada e padronizada no script.}\label{fig:coment}
\end{figure}

Como visto na figura \ref{fig:coment}, além da possibilidade de comentar no início de uma linha, também podemos realizar comentários após um comando, desde que não interfira no fluxo dos códigos.

\hypertarget{operauxe7uxf5es-matemuxe1ticas}{%
\section{Operações matemáticas}\label{operauxe7uxf5es-matemuxe1ticas}}

A seguir, listaremos as principais operações matemáticas presentes no R. Digite os seguintes comandos no \emph{script} e rode-os. Perceba que os resultados aparecem no \emph{console}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adição}
\DecValTok{1} \SpecialCharTok{+} \FloatTok{1.2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Subtração}
\DecValTok{2} \SpecialCharTok{{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multiplicação}
\DecValTok{5} \SpecialCharTok{*} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 25
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Divisão}
\DecValTok{6} \SpecialCharTok{/} \DecValTok{4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Potência (possibilidade 1)}
\DecValTok{2} \SpecialCharTok{\^{}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Potência (possibilidade 2)}
\DecValTok{2} \SpecialCharTok{**} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Raiz quadrada}
\DecValTok{4} \SpecialCharTok{\^{}}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resto da divisão}
\DecValTok{7} \SpecialCharTok{\%\%} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parte inteira de uma divisão}
\DecValTok{7} \SpecialCharTok{\%/\%} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ordem de precedência}
\DecValTok{1} \SpecialCharTok{+} \DecValTok{2} \SpecialCharTok{*} \DecValTok{5} \SpecialCharTok{{-}}\NormalTok{ (}\DecValTok{4} \SpecialCharTok{{-}} \DecValTok{2}\NormalTok{) }\SpecialCharTok{/} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

No caso do exemplo da ordem de precedência, assim como na matemática, o R calcula primeiro a multiplicação e divisão, além dos valores entre parênteses, para, posteriormente, calcular a adição e a subtração.

Outra informação relevante a ser dita quando tratamos de números no R é que os decimais são delimitados por pontos e não por vírgulas, portanto, diferente do padrão adotado no Brasil. Essa informação é importante para que possamos escrever números decimais da maneira a qual o R aceita.

Uma função útil para tratar de números decimais é a \texttt{round()}. Ela arredonda números decimais de acordo com o número de casas decimais informadas no argumento \texttt{digits}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FloatTok{10.456783452}\NormalTok{, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10.457
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(pi, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.14
\end{verbatim}

\hypertarget{obj}{%
\section{Objetos}\label{obj}}

Objetos são nomes que recebem um determinado valor. Para criar um objeto, utilizamos o operador \texttt{\textless{}-}, cujo atalho no teclado é \texttt{Alt} + \texttt{-} (tecla Alt, junto com o sinal de menos).

No exemplo a seguir, salvaremos o valor \texttt{10} dentro do nome \texttt{a}. Ao rodar o objeto \texttt{a}, o R retorna o valor 10.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O número \textquotesingle{}10\textquotesingle{} será armazenado em \textquotesingle{}a\textquotesingle{}}
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{10}

\CommentTok{\# Rodando o objeto \textquotesingle{}a\textquotesingle{}, retorna o valor \textquotesingle{}10\textquotesingle{}}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

Perceba que ao criar um objeto, esse será armazenado na janela \texttt{Enviroment}. Para excluir objetos, selecione os que deseja excluir e clique no ícone da vassoura.

\begin{center}\includegraphics[width=0.8\linewidth]{imagens/objeto} \end{center}

Devemos nos atentar a alguns outros detalhes ao criarmos um objeto. Primeiramente, o R diferencia letras maiúsculas e minúsculas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OtherTok{\textless{}{-}} \DecValTok{10}
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{50}

\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 50
\end{verbatim}

Além disso, não podemos nomear um objeto começando por números, \emph{underline} (\_), ponto (.) e traço (-), sendo esses, \textbf{nomes de sintaxe inválida}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nomes não permitidos!}
\NormalTok{13v }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{\_objeto }\OtherTok{\textless{}{-}} \DecValTok{2}
\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{nomear}\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{.objeto }\OtherTok{\textless{}{-}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

Contudo, podemos utilizar números, \emph{underline} e pontos, desde que não estejam no início do nome.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Permitido}
\NormalTok{x1 }\OtherTok{\textless{}{-}} \DecValTok{7}
\NormalTok{nomear\_objeto }\OtherTok{\textless{}{-}} \DecValTok{25}
\NormalTok{nomear.objeto }\OtherTok{\textless{}{-}} \DecValTok{52}
\end{Highlighting}
\end{Shaded}

Neste primeiro momento, criamos objetos que recebem um único valor. Ao longo da apostila, criaremos objetos mais complexos, cada qual apresentando tipos diferentes, como os vetores, \emph{data frames} e listas.

\hypertarget{funuxe7uxf5es}{%
\section{Funções}\label{funuxe7uxf5es}}

As funções são nomes que guardam um código em R. Portanto, cada função apresenta certas ferramentas específicas que nos trazem alguma resposta.

Dentro dos parênteses de uma função estão os \textbf{argumentos}. Estes argumentos são separados por vírgulas e não há um limite de argumentos que uma função pode receber. Por tanto, uma função executa determinado comando, em resposta aos argumentos especificados dentro dela.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 13
\end{verbatim}

No exemplo, \texttt{1}, \texttt{2} e \texttt{10} são argumentos da função \texttt{sum} (ou seja, função soma). Portanto, a função realizou a operação de soma dos argumentos especificados dentro da função, retornando o resultado da operação, igual a \texttt{13}.

Alguns argumentos de funções possuem nomes, que podemos ou não explicitar em uma função. Utilizaremos como exemplo a função \texttt{seq()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{2}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  2  4  6  8 10
\end{verbatim}

A função \texttt{seq()} cria uma sequência numérica de acordo com os argumentos. O \texttt{from} indica por qual número se inicia a sequência, o \texttt{to}, em qual número termina e o \texttt{by}, de quanto em quanto a sequência será construída. Assim, no exemplo, criamos uma sequência que começa do 2, termina no 10 e que vai de 2 em 2.

Temos a possibilidade de não explicitar os nomes dos argumentos, desde que se respeite a ordem em que os argumentos aparecem.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  2  4  6  8 10
\end{verbatim}

Para saber qual a ordem dos argumentos da função \texttt{seq()}, acessamos a sua documentação com o comando \texttt{?seq}.

Caso seja explicitado o nome dos argumentos, a ordem não interfere no resultado final.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{by =} \DecValTok{2}\NormalTok{, }\AttributeTok{from =} \DecValTok{2}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  2  4  6  8 10
\end{verbatim}

Mas caso os nomes não sejam explicitados, a ordem incorreta acarreta em outro resultado.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

Além de conferir as documentações referentes às funções, podemos utilizar a função \texttt{args(nome\_da\_função)} para verificar todos os argumentos presentes em uma função específica.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{args}\NormalTok{(lm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
function (formula, data, subset, weights, na.action, method = "qr", 
    model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, 
    contrasts = NULL, offset, ...) 
NULL
\end{verbatim}

As funções serão a base para realizarmos cada etapa do fluxograma da ciência de dados, assim, nos depararemos com diversas funções e argumentos específicos, cada qual presente em um pacote ou sendo nativo do R.

\hypertarget{classes}{%
\section{Classes}\label{classes}}

As classes de objetos nos indicam qual o \textbf{tipo} de valor que está armazenado em um determinado objeto. São divididas em quatro principais tipos:

\begin{itemize}
\item
  \emph{numeric}: apresenta valores numéricos, sejam inteiros (\emph{integer}) ou decimais (\emph{double});
\item
  \emph{character}: valores do tipo caractere. Também podemos chamá-los de valores do tipo texto, categóricos ou \emph{string}, nome mais comum no meio da programação;
\item
  \emph{factor}: apresentam variáveis qualitativas possíveis de serem agrupadas em categorias. Veremos com mais detalhes na seção \ref{fator};
\item
  \emph{logical}: valores lógicos do tipo verdadeiro ou falso (TRUE/FALSE). Também são conhecidos como valores booleanos. Abordaremos mais detalhadamente esta classe na seção \ref{logica}.
\end{itemize}

Para verificarmos a classe de um objeto, utilizamos a função \texttt{class()}, tendo como argumento o nome do objeto. Vejamos alguns exemplos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe numérica}
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{10}
\FunctionTok{class}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe caractere}
\NormalTok{b }\OtherTok{\textless{}{-}} \StringTok{"a"}
\FunctionTok{class}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Para criarmos um objeto com a classe do tipo caractere, devemos escrevê-lo entre aspas \texttt{""}. As aspas servem para diferenciar \textbf{nomes} (objetos, funções e pacotes) de \textbf{textos} (letras e palavras). No exemplo anterior, perceba que na classe numérica criamos um \textbf{objeto} de \textbf{nome} \texttt{a} que recebe o valor \texttt{10}, enquanto que na classe caractere, criamos um objeto de nome \texttt{b} que recebe o \textbf{texto} \texttt{"a"}.

Portanto, resumindo: no primeiro caso, criamos um objeto chamado \texttt{a}, enquanto no outro exemplo, criamos um objeto que contém o caractere \texttt{"a"}.

Conhecer a classe de objetos e valores é importante para definirmos os procedimentos e operações possíveis de serem realizadas. Por exemplo, podemos realizar uma operação matemática com números, porém não podemos com caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Números}
\DecValTok{10}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Caracteres}
\StringTok{"a"} \SpecialCharTok{+} \StringTok{"b"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in "a" + "b": argumento não-numérico para operador binário
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"1"} \SpecialCharTok{+} \StringTok{"1"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in "1" + "1": argumento não-numérico para operador binário
\end{verbatim}

No último exemplo, perceba que os números \texttt{1} foram escritos entre aspas, logo deixam de ser um tipo numérico para se apresentar como um tipo caractere. Por este motivo não conseguimos realizar a soma desses.

\hypertarget{dataf}{%
\section{Data frames}\label{dataf}}

O \emph{data frame} é o objeto que armazena os dados importados para dentro do R. São estruturados a partir de linhas e colunas, sendo que cada coluna representa uma variável e cada linha, uma observação, estrutura muito semelhante a uma planilha Excel.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PlantGrowth}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   weight group
1    4.17  ctrl
2    5.58  ctrl
3    5.18  ctrl
4    6.11  ctrl
5    4.50  ctrl
6    4.61  ctrl
7    5.17  ctrl
8    4.53  ctrl
9    5.33  ctrl
10   5.14  ctrl
11   4.81  trt1
12   4.17  trt1
13   4.41  trt1
14   3.59  trt1
15   5.87  trt1
16   3.83  trt1
17   6.03  trt1
18   4.89  trt1
19   4.32  trt1
20   4.69  trt1
21   6.31  trt2
22   5.12  trt2
23   5.54  trt2
24   5.50  trt2
25   5.37  trt2
26   5.29  trt2
27   4.92  trt2
28   6.15  trt2
29   5.80  trt2
30   5.26  trt2
\end{verbatim}

O \emph{data frame} \texttt{PlantGrowth} é nativo do R e contém dados sobre o crescimento de plantas sob 2 tipos diferentes de tratamentos (para mais informações, consulte a documentação do \emph{data frame}, rodando \texttt{?PlantGrowth}). Possui 30 linhas (observações) e 2 colunas (variáveis).

Portanto, podemos dizer que o objeto de nome \texttt{PlantGrowth} guarda um \emph{data frame} com 30 linhas e 2 colunas.

Podemos aplicar algumas funções em \emph{data frames}, a fim de visualizarmos melhor sua estrutura e elementos presentes. A seguir, demonstraremos algumas delas aplicadas no \emph{data frame} \texttt{PlantGrowth}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mostra as 6 primeira linhas}
\FunctionTok{head}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  weight group
1   4.17  ctrl
2   5.58  ctrl
3   5.18  ctrl
4   6.11  ctrl
5   4.50  ctrl
6   4.61  ctrl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mostra as 6 últimas linhas}
\FunctionTok{tail}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   weight group
25   5.37  trt2
26   5.29  trt2
27   4.92  trt2
28   6.15  trt2
29   5.80  trt2
30   5.26  trt2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mostra as dimensões (nº de linhas x nº de coluna)}
\FunctionTok{dim}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 30  2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nomes das colunas (variáveis)}
\FunctionTok{names}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "weight" "group" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Estrutura do data frame com informações como o tipo, dimensão e classes}
\FunctionTok{str}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   30 obs. of  2 variables:
 $ weight: num  4.17 5.58 5.18 6.11 4.5 4.61 5.17 4.53 5.33 5.14 ...
 $ group : Factor w/ 3 levels "ctrl","trt1",..: 1 1 1 1 1 1 1 1 1 1 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Retorna algumas medidas{-}resumo}
\FunctionTok{summary}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     weight       group   
 Min.   :3.590   ctrl:10  
 1st Qu.:4.550   trt1:10  
 Median :5.155   trt2:10  
 Mean   :5.073            
 3rd Qu.:5.530            
 Max.   :6.310            
\end{verbatim}

Os \emph{data frames} serão o nosso principal objeto de estudo para aplicarmos ciência de dados, uma vez que guardam os dados a serem analisados. Estudaremos os \emph{data frames} com mais detalhes na subseção \ref{df}. Mas antes, devemos conhecer alguns outros conceitos importantes, como é o caso dos \textbf{vetores}, assunto do tópico a seguir.

\hypertarget{vetor}{%
\section{Vetores}\label{vetor}}

Os vetores nada mais são do que um conjunto de valores unidos em um só objeto. Em um linguajar mais técnicos, vetor é um conjunto de valores indexados. Para criarmos um vetor, devemos utilizar a função \texttt{c()}, cujos argumentos devem estar separados por vírgulas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor\_numerico }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{6}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{22}\NormalTok{)}
\NormalTok{vetor\_numerico}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]   2   6 -10  14  18  22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(vetor\_numerico)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor\_texto }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"g"}\NormalTok{, }\StringTok{"j"}\NormalTok{, }\StringTok{"y"}\NormalTok{)}
\NormalTok{vetor\_texto}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "g" "j" "y"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(vetor\_texto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Perceba que a função \texttt{class()} nos retorna o tipo de classe que um vetor apresenta. Um vetor só pode guardar um tipo de classe. Caso misturemos um vetor com números e caracteres, os números serão convertidos para texto. Esse comportamento é conhecido como \textbf{coerção}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vetor misto}
\NormalTok{vetor\_misto }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"a"}\NormalTok{)}
\NormalTok{vetor\_misto}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "1" "5" "a"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(vetor\_misto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Os números \texttt{1} e \texttt{5}, dentro de um vetor que contém o caractere \texttt{"a"}, são convertidos para texto, resultando em um vetor com os textos \texttt{"1"}, \texttt{"5"} e \texttt{"a"}, como constatado ao utilizar a função \texttt{class()}, que nos retorna uma classe do tipo caractere.

Portanto, devemos ter em mente que, para vetores com valores de classes diferentes, os caracteres serão dominantes em relação aos números. Para criar um conjunto de valores com classes diferentes, devemos criar uma \textbf{lista}, assunto que veremos mais adiante na seção \ref{list}.

Podemos criar um vetor com uma sequência numérica utilizando o operador \texttt{:}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vetor de 1 a 15}
\NormalTok{sequencia\_numerica }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{sequencia\_numerica}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
\end{verbatim}

Ao criarmos um vetor, cada valor ocupa uma posição dentro do vetor. A posição é dada pela ordem em que estão no vetor. Portanto, podemos encontrar determinados valores de acordo com a posição em que estão localizados no vetor. Essa operação é conhecida como \emph{subsetting}. Para isso, colocamos o número da posição que desejamos acessar dentro de colchetes \texttt{{[}{]}}, associado ao objeto que desejamos analisar.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{posicao\_vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{11}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{33}\NormalTok{, }\DecValTok{44}\NormalTok{)}

\NormalTok{posicao\_vetor[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 11
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{posicao\_vetor[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{posicao\_vetor[}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 33
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{posicao\_vetor[}\DecValTok{4}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 44
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{posicao\_vetor[}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

O objeto de nome \texttt{posicao\_vetor} é um vetor com 4 valores (ou 4 argumentos). Com o comando \texttt{posicao\_vetor{[}1{]}}, temos o valor \texttt{11}, contido na primeira posição do vetor, seguindo a mesma lógica para as demais posições. Perceba que o comando \texttt{posicao\_vetor{[}5{]}} nos retorna o valor \texttt{NA}, pois não existe esta posição dentro do vetor. Mais adiante, na seção \ref{especial}, trataremos sobre o valor \texttt{NA}.

Também podemos inserir um conjunto de posições dentro dos colchetes, o que nos retorna um subconjunto de valores dentro de um vetor. Para isso, utilizamos a função \texttt{c()}, tendo como argumentos as posições que se deseja acessar.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"w"}\NormalTok{, }\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{, }\StringTok{"z"}\NormalTok{)}

\NormalTok{v[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "x" "z"
\end{verbatim}

Ainda, podemos realizar operações matemáticas com vetores de classe numérica:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{8}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{24}\NormalTok{, }\DecValTok{25}\NormalTok{)}

\NormalTok{vetor }\SpecialCharTok{+} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  9 20 25 26
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\SpecialCharTok{{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  7 18 23 24
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\SpecialCharTok{/} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  4.0  9.5 12.0 12.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\SpecialCharTok{*} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 16 38 48 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\SpecialCharTok{\^{}} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  64 361 576 625
\end{verbatim}

Perceba que as operações matemáticas são executadas para cada um dos elementos do vetor.

Também podemos fazer operações entre vetores:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{)}

\NormalTok{vetor1 }\SpecialCharTok{+}\NormalTok{ vetor2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  6  8 10 12
\end{verbatim}

Para realizar a operação, ambos os vetores são alinhados, sendo somados os valores de acordo com a posição correlata entre os elementos dos vetores. Portanto, o elemento que oculpa a primeira posição no \texttt{vetor1} é somado com o primeiro elemento do \texttt{vetor2}, seguindo a mesma lógica para os demais elementos.

No caso de vetores com tamanhos diferentes, ocorre o processo de \textbf{reciclagem}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{vetor4 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{11}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{33}\NormalTok{, }\DecValTok{44}\NormalTok{)}

\NormalTok{vetor3 }\SpecialCharTok{+}\NormalTok{ vetor4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 12 25 34 47
\end{verbatim}

A operação entre vetores de tamanhos diferentes segue a mesma lógica citada anteriormente: ambos os vetores são alinhados, porém, por apresentarem diferentes dimensões, é realizada uma repetição (\emph{reciclagem}) do \texttt{vetor3} para que esse fique com o mesmo tamanho do \texttt{vetor4}, assim, possibilitando a operação matemática. Portanto, é como se o \texttt{vetor3} tivesse a dimensão de \texttt{c(1,\ 3,\ 1,\ 3)}.

Vale destacar que o comportamento de reciclagem foi aplicado quando fizemos as operações matemáticas em um só vetor. Por exemplo, quando somamos \texttt{1} ao vetor de dimensão \texttt{c(8,\ 19,\ 24,\ 25)}, o R reciclou o número \texttt{1} - que nada mais é do que um vetor de tamanho 1, igual a \texttt{c(1)} - formando um vetor \texttt{c(1,\ 1,\ 1,\ 1)} para que fosse possível realizar a soma.

Até então, fizemos operações entre vetores com comprimentos múltiplos entre si. Ao realizar operações entre vetores cujos tamanhos não são múltiplos, a reciclagem atua da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor5 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{vetor6 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{50}\NormalTok{)}

\NormalTok{vetor5 }\SpecialCharTok{+}\NormalTok{ vetor6}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in vetor5 + vetor6: comprimento do objeto maior não é múltiplo do
comprimento do objeto menor
\end{verbatim}

\begin{verbatim}
[1] 11 22 33 41 52
\end{verbatim}

Nessa situação, foi realizada a reciclagem do \texttt{vetor5}, até que ele adquirisse a mesma dimensão do \texttt{vetor6}. Assim, o \texttt{vetor5} se apresenta da seguinte maneira após a reciclagem: \texttt{c(1,\ 2,\ 3,\ 1,\ 2)}. Perceba que o último valor do \texttt{vetor5} não foi reciclado na operação, pois sua presença na reciclagem ultrapassaria a dimensão do \texttt{vetor6}. Normalmente, esse tipo de operação não é desejada, devido a não reciclagem de certos valores de um vetor, o que pode causar problemas nas análises. E, justamente, por ser um processo incomum, o R gera uma mensagem de aviso (\emph{warning}) no \emph{console}, alertando o ocorrido.

Guarde com carinho os conceitos explicados nesta seção, pois os utilizaremos com muita frequência nos próximos capítulos para trabalharmos com os \emph{data frame}, uma vez que cada coluna de um \emph{data frame} é um vetor.

\hypertarget{fator}{%
\section{Fatores}\label{fator}}

As variáveis do tipo \textbf{fator} são um caso especial de classe de objetos que representam variáveis qualitativas possíveis de serem agrupadas em \textbf{categorias}, como, por exemplo, o sexo e grau de escolaridade. As possíveis categorias presentes em um fator são indicadas pelo atributo \texttt{levels}, como os \texttt{levels} masculino e feminino, no caso do sexo, e ensino fundamental, médio e superior, no caso do grau de escolaridade.

Normalmente, este tipo de variável é criada ou importada como texto, sendo necessário transformá-la em fator, utilizando a função \texttt{as.factor()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe do tipo caractere}
\NormalTok{sexo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(sexo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe do tipo fator}
\FunctionTok{as.factor}\NormalTok{(sexo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] F F M F M M
Levels: F M
\end{verbatim}

Criando o objeto \texttt{sexo}, sendo os argumentos \texttt{F} para o sexo feminino e \texttt{M} para o masculino, temos um vetor de classe do tipo caractere. Como o sexo é uma variável possível de ser categorizada, transformamos essa variável para a classe fator, a partir da função \texttt{as.factor()}. Perceba que na classe do tipo fator, o R nos retorna os \texttt{levels}, ou seja, o conjunto de categorias presentes no objeto \texttt{sexo}, no caso, \texttt{F} e \texttt{M}.

Ainda, podemos criar um vetor do tipo fator utilizando a função \texttt{factor()}. A função \texttt{class()} mostra o tipo de classe do objeto \texttt{sexo\_fator} e a \texttt{levels()}, indica quais são as categorias presentes no objeto de classe do tipo fator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sexo\_fator }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{))}
\FunctionTok{class}\NormalTok{(sexo\_fator)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(sexo\_fator)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "F" "M"
\end{verbatim}

Por padrão, os \texttt{levels} são ordenados por ordem alfabética. No exemplo anterior, a categoria \texttt{F} vem antes da \texttt{M}. Para reordená-las, utilizamos o argumento \texttt{levels} na função \texttt{factor()}, ordenando as categorias de acordo com sua posição no vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sexo\_fator }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(sexo\_fator, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{))}
\FunctionTok{levels}\NormalTok{(sexo\_fator)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "M" "F"
\end{verbatim}

\hypertarget{diferenuxe7as-entre-fatores-e-caracteres}{%
\subsection{Diferenças entre fatores e caracteres}\label{diferenuxe7as-entre-fatores-e-caracteres}}

Apesar dos objetos do tipo fator serem representados por letras ou palavras, o R os enxerga como números inteiros, diferentemente dos objetos da classe caractere, que são puramente textos. Podemos notar essas diferenças ao tentar convertê-las em classe numérica.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe caractere}
\NormalTok{sexo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(sexo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(sexo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe fator}
\NormalTok{sexo\_fator }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{))}
\FunctionTok{class}\NormalTok{(sexo\_fator)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(sexo\_fator)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 1 2 1 2 2
\end{verbatim}

Podemos notar que não foi possível converter o vetor do tipo caractere para um vetor numérico, pois o R não consegue atribuir uma classificação numérica para textos. Porém, no caso do vetor tipo fator, foi possível transformá-lo para um tipo numérico, sendo representado como \texttt{1} o nível \texttt{F} e como \texttt{2}, o \texttt{M}.

Portanto, para o R, os \texttt{levels} dos fatores são números inteiros sequenciais, começando do \texttt{1}, atribuídos conforme a ordem alfabética dos argumentos no vetor.

\hypertarget{logica}{%
\section{Operações lógicas}\label{logica}}

As operações lógicas nos retornam valores do tipo verdadeiro ou falso, representados no R por \texttt{TRUE} e \texttt{FALSE} (em letras maiúsculas), respectivamente. Portanto, a classe atribuida a estes tipos de valores é a \texttt{logical} - como vimos na seção \ref{classes} - aceitando somente estes dois valores.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "logical"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "logical"
\end{verbatim}

Para aplicarmos testes lógicos, podemos utilizar o operador \texttt{==} (duas vezes o sinal de igual) para verificar se dois valores são iguais, ou o operador \texttt{!=} (exclamação + igual) para ver se os valores são diferentes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resultados verdadeiros}
\DecValTok{52} \SpecialCharTok{==} \DecValTok{52}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"x"} \SpecialCharTok{==} \StringTok{"x"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"a"} \SpecialCharTok{!=} \StringTok{"b"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{!=} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resultados falsos}
\DecValTok{52} \SpecialCharTok{!=} \DecValTok{52}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"x"} \SpecialCharTok{!=} \StringTok{"x"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"a"} \SpecialCharTok{==} \StringTok{"b"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{==} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

Além disso, podemos utilizar outros operadores lógicos, como por exemplo:

\begin{itemize}
\item
  \texttt{\textless{}} se um valor é \textbf{menor} ao outro;
\item
  \texttt{\textgreater{}} se um valor é \textbf{maior} ao outro;
\item
  \texttt{\textless{}=} se um valor é \textbf{menor ou igual} ao outro;
\item
  \texttt{\textgreater{}=} se um valor é \textbf{maior ou igual} ao outro.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Menor}
\DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Maior}
\DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{4} \SpecialCharTok{\textgreater{}} \DecValTok{7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Menor ou igual}
\DecValTok{3} \SpecialCharTok{\textless{}=} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{\textless{}=} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Maior ou igual}
\DecValTok{10} \SpecialCharTok{\textgreater{}=} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{\textgreater{}=} \DecValTok{6}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

O operador \texttt{\%in\%} verifica se um dado valor pertence a um vetor, ou seja, se um valor está contido dentro de um conjunto de valores.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"a"} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

Ainda tratando dos vetores, observe o seguinte exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vet }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{6}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{9}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{52}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{vet }\SpecialCharTok{\textgreater{}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE FALSE  TRUE FALSE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vet[vet }\SpecialCharTok{\textgreater{}} \DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  6 10 52
\end{verbatim}

Aqui teremos que relembrar alguns conceitos expostos anteriormente. Primeiramente, criamos um vetor de nome \texttt{vet}, que recebe 7 valores. Posteriormente, utilizamos um teste lógico para verificar quais valores de \texttt{vet} são maiores que 3, cuja resposta é dada por \texttt{TRUE} ou \texttt{FALSE}. Nessa situação, ocorre uma \textbf{reciclagem} (conceito visto na seção \ref{vetor}) do valor \texttt{3}, portanto, resultando em um vetor igual a \texttt{c(3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3)}. A partir disso, o R alinha o vetor \texttt{c(1,\ 0,\ 6,\ -9,\ 10,\ 52,\ 3)} com o vetor \texttt{c(3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3)} e testa a lógica proposta elemento por elemento (\texttt{1\ \textgreater{}\ 3}, \texttt{0\ \textgreater{}\ 3}, \texttt{6\ \textgreater{}\ 3}, \texttt{-9\ \textgreater{}\ 3}, \texttt{10\ \textgreater{}\ 3}, \texttt{52\ \textgreater{}\ 3} e \texttt{3\ \textgreater{}\ 3}), formando um vetor de verdadeiros e falsos.

Toda essa explicação embasa a operação lógica \texttt{vet{[}vet\ \textgreater{}\ 3{]}}, que nos retorna apenas os valores do vetor que são maiores que 3, ou seja, todos os valores iguais a \texttt{TRUE}. Esse tipo de operação será muito utilizada nos capítulos seguintes, mais especificamente no capítulo \ref{trans} ao utilizarmos a função \texttt{filter}, essa muito mais simples de operar do que em relação ao apresentado anteriormente, porém seguindo a mesma lógica.

\hypertarget{especial}{%
\section{Valores especiais}\label{especial}}

Nesta seção, explicaremos alguns valores particulares presentes no R.

\hypertarget{na}{%
\subsection{NA}\label{na}}

O \texttt{NA} representa a \textbf{ausência de informação}, ou seja, a informação existe, porém não se sabe qual é. Em bases de dados, é comum que algumas informações não tenham registro, sendo assim, representados pelo valor \texttt{NA}. Com isso, devemos saber interpretar e tratar estes valores.

Reforçando o significado de \texttt{NA}, podemos exemplificar com uma coleta de dados em que certos indivíduos não informaram suas idades. Isso não significa que os entrevistados não possuem idade, mas simplesmente que o registro de algumas idades é uma informação ausente na pesquisa.

Sabendo do significado de \texttt{NA}, podemos aprofundar sua utilização em testes lógicos, como representa o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idade\_jose }\OtherTok{\textless{}{-}} \DecValTok{24}
\NormalTok{idade\_joao }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{idade\_maria }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\NormalTok{idade\_jose }\SpecialCharTok{==}\NormalTok{ idade\_joao}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idade\_joao }\SpecialCharTok{==}\NormalTok{ idade\_maria}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

Conhecemos apenas a idade do José, mas não sabemos a idade do João e da Maria, logo, a idade dos dois últimos são representados pelo valor \texttt{NA}. Ao aplicar o teste lógico \texttt{idade\_jose\ ==\ idade\_joao}, o retorno é o valor \texttt{NA}, ou seja, o R não sabe responder se a idade do José é a mesma de João, uma vez que a idade do João não foi informada. No teste \texttt{idade\_joao\ ==\ idade\_maria}, também nos é retornado o valor \texttt{NA}, pois ambas as idades não foram informadas, logo tanto a idade do João pode ser a mesma da Maria, como pode ser distinta. Portanto, o R não ``chutará'' uma resposta e simplesmente responderá: \texttt{NA} (\emph{não sei}).

Dito isso, temos que nos atentar aos valores \texttt{NA} presentes nos nossos \emph{data frames}, pois em algumas operações, como a média (\texttt{mean()}), não conseguimos executá-la na presença desses valores. No caso da função \texttt{mean()}, ela possui o argumento \texttt{na.rm\ =\ TRUE} para excluir os \texttt{NA} da operação matemática. Todavia, algumas outras funções não possuem um argumento semelhante, sendo necessário realizar outras manipulações de dados, as quais veremos nos capítulos mais adiantes.

\hypertarget{nan}{%
\subsection{NaN}\label{nan}}

O \texttt{NaN} (\emph{not a number}) representa indeterminações matemáticas.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{0}\SpecialCharTok{/}\DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NaN
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{log}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NaN
\end{verbatim}

Também podemos utilizar testes lógicos com a função \texttt{is.nan()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nao\_numero }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{/}\DecValTok{0}
\FunctionTok{is.nan}\NormalTok{(nao\_numero)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{inf}{%
\subsection{Inf}\label{inf}}

O \texttt{Inf} (infinito) representa um valor muito grande, o qual o R não consegue retratar. Também pode representar um limite matemático.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Valor grande}
\DecValTok{100} \SpecialCharTok{\^{}} \DecValTok{200}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] Inf
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Limite matemático}
\DecValTok{1} \SpecialCharTok{/} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] Inf
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{{-}}\DecValTok{1} \SpecialCharTok{/} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -Inf
\end{verbatim}

Novamente, podemos utilizar testes lógicos para identificar se um objeto apresenta valor infinito. Para isso, utilizamos a função \texttt{is.infinite()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{valor\_infinito }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{/} \DecValTok{0}
\FunctionTok{is.infinite}\NormalTok{(valor\_infinito)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{null}{%
\subsection{NULL}\label{null}}

O \texttt{NULL} representa a ausência de um objeto. Seu significado está mais atrelado a lógica de programação, quando não queremos atribuir valor à um objeto. Portanto, diferentemente do \texttt{NA}, o \texttt{NULL} indica a inexistência de um parâmetro qualquer.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{valor\_nulo }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{valor\_nulo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

Para utilizar teste lógico à valores nulos, utilizamos a função \texttt{is.null()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.null}\NormalTok{(valor\_nulo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

\hypertarget{list}{%
\section{Listas}\label{list}}

As listas são objetos semelhantes a um vetor, porém, com algumas diferenças. Como citado na seção \ref{vetor}, não podemos misturar objetos de classes distintas em um único vetor, contudo, nas \textbf{listas} podemos realizar essa mescla de classes.

Para criarmos uma lista, utilizamos a função \texttt{list()}, tendo como argumentos os valores desejados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{5}\NormalTok{, }\StringTok{"x"}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{lista}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] 5

[[2]]
[1] "x"

[[3]]
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(lista)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

Nesse caso, criamos uma lista com elementos de classes numérica, caractere e lógica, sem que ocorresse coerção, ou seja, não houve a conversão do objeto para uma única classe, como vimos ocorrer com os vetores (seção \ref{vetor}). Assim, as listas nos permite unir classes distintas em um mesmo objeto.

Outro diferencial é o fato de que \textbf{cada elemento de uma lista também é uma lista}. Portanto, para acessarmos um elemento de uma lista, devemos utilizar dois colchetes \texttt{{[}{[}{]}{]}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{5}\NormalTok{, }\StringTok{"x"}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Utilizando 1 colchete, nos retorna uma classe do tipo lista}
\NormalTok{lista[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] "x"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(lista[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "list"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Utilizando 2 colchetes, nos retorna a classe do elemento}
\NormalTok{lista[[}\DecValTok{2}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "x"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(lista[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Assim, utilizando um colchete, é retornado a classe da lista que contém um único elemento. Já com dois colchetes, nos é retornado a classe do elemento que está na lista, no caso do exemplo, a classe do \texttt{x}.

O fato de cada elemento ser uma lista dentro de uma lista é importante para podermos colocar vetores de tamanhos diferentes em cada posição. Isso faz das listas objetos muito flexíveis para armazenar dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{listas\_sao\_flexiveis }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{))}

\NormalTok{listas\_sao\_flexiveis[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{listas\_sao\_flexiveis[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1] "a" "b" "c"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{listas\_sao\_flexiveis[}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[[1]]
[1]  TRUE FALSE  TRUE FALSE
\end{verbatim}

Podemos nomear cada posição de uma lista. Para isso, colocamos dentro da função \texttt{list()} os argumentos com as respectivas denominações e valores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_estudantes }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{nome =} \FunctionTok{c}\NormalTok{(}\StringTok{"José"}\NormalTok{, }\StringTok{"Joao"}\NormalTok{, }\StringTok{"Maria"}\NormalTok{),}
                         \AttributeTok{sexo =} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{),}
                         \AttributeTok{idade =} \FunctionTok{c}\NormalTok{(}\DecValTok{26}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{20}\NormalTok{))}

\NormalTok{dados\_estudantes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$nome
[1] "José"  "Joao"  "Maria"

$sexo
[1] "M" "M" "F"

$idade
[1] 26 19 20
\end{verbatim}

Quando a posição de uma lista possui um nome, podemos acessar seus valores com o operador \texttt{\$}. Esse operador é equivalente a \texttt{dados\_alunos{[}{[}{]}{]}}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalente a dados\_estudantes[[1]]}
\NormalTok{dados\_estudantes}\SpecialCharTok{$}\NormalTok{nome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "José"  "Joao"  "Maria"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalente a dados\_estudantes[[2]]}
\NormalTok{dados\_estudantes}\SpecialCharTok{$}\NormalTok{sexo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "M" "M" "F"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalente a dados\_estudantes[[3]]}
\NormalTok{dados\_estudantes}\SpecialCharTok{$}\NormalTok{idade}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 26 19 20
\end{verbatim}

\hypertarget{df}{%
\subsection{Data frames e listas}\label{df}}

Depois de apresentarmos o que são listas (além dos demais conceitos presentes nas seções anteriores), vamos aprofundar os nossos conhecimentos sobre os \emph{data frames}.

A relação entre listas e \emph{data frames} é que, basicamente, os \emph{data frames} são um tipo de lista. Assim, as propriedades expostas sobre as listas se aplicam aos \emph{data frames}.

No capítulo \ref{dataf}, apresentamos o básico sobre os \emph{data frames}, exemplificado com o \texttt{PlantGrowth}. Assim, para entendermos a equivalência entre listas e \emph{data frames}, converteremos o \texttt{PlantGrowth} em uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Data frame}
\FunctionTok{head}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  weight group
1   4.17  ctrl
2   5.58  ctrl
3   5.18  ctrl
4   6.11  ctrl
5   4.50  ctrl
6   4.61  ctrl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Lista}
\FunctionTok{as.list}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$weight
 [1] 4.17 5.58 5.18 6.11 4.50 4.61 5.17 4.53 5.33 5.14 4.81 4.17 4.41 3.59 5.87
[16] 3.83 6.03 4.89 4.32 4.69 6.31 5.12 5.54 5.50 5.37 5.29 4.92 6.15 5.80 5.26

$group
 [1] ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl trt1 trt1 trt1 trt1 trt1
[16] trt1 trt1 trt1 trt1 trt1 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2
Levels: ctrl trt1 trt2
\end{verbatim}

Perceba que os nomes das colunas do \emph{data frame} se tornam o nome das posições de uma lista (\texttt{\$weight} e \texttt{\$group}) e cada valor das colunas são convertidos em elementos da respectiva lista.

Portanto, podemos dizer que cada coluna de um \emph{data frame} também é um \emph{data frame}, assim como no caso das listas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe do data frame PlantGrowth}
\FunctionTok{class}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Classe da primeira coluna (weight)}
\FunctionTok{class}\NormalTok{(PlantGrowth[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

Além disso, podemos utilizar o operador \texttt{\$} para acessar os elementos de uma coluna (ou lista).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PlantGrowth}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 4.17 5.58 5.18 6.11 4.50 4.61 5.17 4.53 5.33 5.14 4.81 4.17 4.41 3.59 5.87
[16] 3.83 6.03 4.89 4.32 4.69 6.31 5.12 5.54 5.50 5.37 5.29 4.92 6.15 5.80 5.26
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PlantGrowth}\SpecialCharTok{$}\NormalTok{group}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl trt1 trt1 trt1 trt1 trt1
[16] trt1 trt1 trt1 trt1 trt1 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2
Levels: ctrl trt1 trt2
\end{verbatim}

Contudo, temos de destacar que todo \emph{data frame} é um tipo de lista, porém nem toda lista é um \emph{data frame}. Assim, o \emph{data frame} possui algumas propriedades particulares que o torna um tipo de lista especial:

\begin{itemize}
\item
  Todas as colunas precisam ter a mesma dimensão, ou seja, ter o mesmo número de linhas;
\item
  Todas as colunas precisam ser nomeadas;
\item
  Possuir 2 dimensões.
\end{itemize}

Essas propriedades nos indicam que um \emph{data frame} tem que receber uma base de dados em formato retangular (análoga a uma planilha Excel), com o mesmo número de linhas (observações) em cada coluna (variável), sendo necessário a presença um nome específico para cada uma das colunas.

Um exemplo da propriedade \emph{Todas as colunas precisam ter a mesma dimensão} é a tentativa (falha) de converter uma lista com vetores de comprimentos diferentes em um \emph{data frame}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{listas }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{))}
\FunctionTok{as.data.frame}\NormalTok{(listas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 5, 3, 4
\end{verbatim}

A propriedade \emph{Todas as colunas precisam ser nomeadas} não é um impeditivo para se criar um \emph{data frame}, porém, não se obtém um bom resultado ao ignorar esta propriedade, pois é necessário ter um nome para cada coluna e o R trata de criá-los de uma maneira pouco agradável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_estudantes }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"José"}\NormalTok{, }\StringTok{"Joao"}\NormalTok{, }\StringTok{"Maria"}\NormalTok{),}
                         \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{),}
                         \FunctionTok{c}\NormalTok{(}\DecValTok{45}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{26}\NormalTok{))}

\FunctionTok{as.data.frame}\NormalTok{(dados\_estudantes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  c..José....Joao....Maria.. c..M....M....F.. c.45..19..26.
1                       José                M            45
2                       Joao                M            19
3                      Maria                F            26
\end{verbatim}

Já a propriedade \emph{Possuir 2 dimensões} indica que o \emph{data frame} possui linhas e colunas, o que os diferencia das listas, uma vez que essas não possuem dimensão. A função \texttt{dim()} retorna as dimensões de um objeto e comprova que as listas não possuem dimensão.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Data frame}
\FunctionTok{dim}\NormalTok{(PlantGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 30  2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Lista}
\FunctionTok{dim}\NormalTok{(}\FunctionTok{as.list}\NormalTok{(PlantGrowth))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
NULL
\end{verbatim}

Assim, a função \texttt{dim()} nos indica que o \emph{data frame} \texttt{PlantGrowth} apresenta 30 linhas e 2 colunas. Por outro lado, ao convertermos o \emph{data frame} \texttt{PlantGrowth} em uma lista, a mesma função nos diz que o objeto é ausente de dimensão (\texttt{NULL}).

Além disso, caso haja valores faltantes na base de dados (como, por exemplo, células vazias no Excel), esses serão representados por \texttt{NA}, sendo preservada a estrutura do \emph{data frame}.

Por possuir duas dimensões, para acessarmos valores em um \emph{data frame}, devemos especificar as linhas e colunas dentro de colchetes, na seguinte ordem: \texttt{{[}numero\_linha,\ numero\_coluna{]}}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Acessa o elemento posicionado na 10ª linha da 1ª coluna}
\NormalTok{PlantGrowth[}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5.14
\end{verbatim}

Podemos pegar todas as linhas de uma coluna ou todas as colunas de uma linha deixando um dos argumentos vazios:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Todas as linhas da 2ª coluna}
\NormalTok{PlantGrowth[,}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl ctrl trt1 trt1 trt1 trt1 trt1
[16] trt1 trt1 trt1 trt1 trt1 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2 trt2
Levels: ctrl trt1 trt2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Todas as colunas da 2ª linhas}
\NormalTok{PlantGrowth[}\DecValTok{2}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  weight group
2   5.58  ctrl
\end{verbatim}

E, devido ao fato de que cada coluna do \emph{data frame} é um vetor, podemos aplicar testes lógicos para filtrar linhas, assim como fizemos na seção \ref{logica}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PlantGrowth[PlantGrowth}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{\textgreater{}} \FloatTok{5.5}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   weight group
2    5.58  ctrl
4    6.11  ctrl
15   5.87  trt1
17   6.03  trt1
21   6.31  trt2
23   5.54  trt2
28   6.15  trt2
29   5.80  trt2
\end{verbatim}

Neste caso, a condição lógica imposta à coluna \texttt{weight} nos retorna todas as linhas que apresentem plantas com peso seco maior que 5,5.

Com as listas, finalizamos as noções básicas em R. Para aqueles que entraram em contato pela primeira vez com conceitos teóricos de programação, seja na linguagem que for, a teoria pode parecer complicada e maçante. Mas a não compreensão de alguns conceitos expostos neste capítulo não será um impeditivo para continuar os estudos em ciência de dados em R. Sinta-se livre em replicar os códigos dos próximos capítulos, mesmo que não compreenda 100\% do que está sendo feito. Em algumas ocasiões, você compreenderá melhor um conceito ao aplicá-lo na prática. Além disso, recomendo que você revisite este capítulo caso tenha alguma dúvida conceitual, ou senão, quando estiver mais familiarizado na programação em R.

Portanto, nos próximos capítulos, começaremos a aplicar ciência de dados na prática, começando pela importação de dados ao R.

\hypertarget{import}{%
\chapter{Importação}\label{import}}

Neste capítulo, iniciaremos a primeira etapa para começarmos a aplicar ciência de dados: a importação dos dados para o R. Deve-se ter em mente que um conjunto de dados pode estar em diversos formatos, seja em arquivo de texto, planilha Excel ou extensões de outros programas. Assim, para cada formato, haverá uma maneira específica de importá-los ao R. Nesta apostila, trataremos dos formatos mais usuais a serem importados: os arquivos texto e as planilhas Excel.

Como citado na seção \ref{proj}, referente à criação de projetos no RStudio, devemos criar um projeto para cada trabalho realizado, logo, direcionar os arquivos a serem importados para o respectivo diretório, a fim de manter uma organização e facilitar o nosso acesso aos documentos necessários. Portanto, caso ainda não tenha criado um projeto, confira a seção referente ao tema.

A seguir, mostraremos como importar os dados em formato texto e planilha Excel. Para os exemplos, utilizaremos a base de dados referente a produção de cereais, extraída da FAOSTAT. Faça o \emph{download} da pasta \href{https://github.com/gustavojy/ApostilaCD-R/blob/main/dados_zip/dados_importar.zip?raw=true}{clicando aqui}. Nela, estão presentes as mesmas bases de dados em diversos formatos de arquivos para que você possa acompanhar os exemplos a seguir.

\hypertarget{pacote-readr}{%
\section{\texorpdfstring{Pacote \texttt{readr}}{Pacote readr}}\label{pacote-readr}}

Com o pacote \texttt{readr}, podemos ler arquivos em formato de texto, como os \texttt{.txt} e os \texttt{.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

O \texttt{readr} importa os arquivos no formato de \texttt{tibbles}, análogo aos \emph{data frames} (seção \ref{dataf}). No capítulo \ref{org} veremos mais detalhes sobre as \texttt{tibbles}. Neste momento, focaremos em como importar os dados para o R, para então, entendermos os diferentes formatos de dados. A seguir, estão apresentadas as funções a serem utilizadas de acordo com o formato do arquivo:

\begin{itemize}
\item
  \texttt{read\_csv()}: arquivos separados por vírgula;
\item
  \texttt{read\_csv2()}: arquivos separados por ponto-e-vírgula;
\item
  \texttt{read\_tsv()}: arquivos separados por tabulação;
\item
  \texttt{read\_delim()}: arquivos separados por um delimitador genérico. Requer o argumento \texttt{delim\ =} para indicar qual o caractere que separa as colunas do arquivo texto;
\item
  \texttt{read\_table()}: arquivos com colunas separadas por espaço.
\end{itemize}

Para entendermos melhor o que são separadores, basicamente, em um arquivo texto, as colunas do Excel são delimitadas por um operador, ou seja, um separador de colunas, podendo ser vírgulas, ponto-e-vírgulas, espaços, TAB ou um delimitador genérico. Para isso, o \texttt{readr} apresenta diferentes funções para conseguir importar estes arquivos no formato correto, de acordo com o tipo de arquivo e delimitador utilizado.

\hypertarget{ler-arquivos-texto}{%
\subsection{Ler arquivos texto}\label{ler-arquivos-texto}}

Importaremos arquivos texto nos formatos \texttt{.csv} e \texttt{.txt}.

Para ler um arquivo em \texttt{.csv}, cujo separador de colunas são as vírgulas, utilizamos a função \texttt{read\_csv()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Rows: 6179 Columns: 14
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (8): Domain Code, Domain, Area, Element, Item, Unit, Flag, Flag Description
dbl (6): Area Code, Element Code, Item Code, Year Code, Year, Value

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

Ao importar o arquivo \texttt{.csv}, a função nos informa as dimensões do banco de dados (\texttt{Rows} e \texttt{Columns}), o delimitador considerado (\texttt{Delimiter:}) e a classe atribuída para cada variável (coluna). Podemos perceber que das 14 variáveis, em 8 foi atribuída a classe do tipo caractere (\texttt{chr\ (8)}) e em 6, a classe numérica (\texttt{dbl\ (6)}).

Devemos nos atentar a este passo, pois em algumas situações, a classificação das variáveis pode estar errada ou imprópria para o uso correto nas análises. Na subseção \ref{readrgs}, apresentaremos o argumento \texttt{col\_types\ =} para reclassificar as variáveis.

O argumento \texttt{file\ =} representa o caminho até o arquivo. Perceba que não foi preciso indicar o diretório do arquivo, pois esse se localiza na mesma pasta do projeto em uso. Caso o arquivo esteja em uma outra pasta presente no diretório do projeto em uso, devemos especificá-la dentro do caminho até o arquivo. Exemplificaremos o processo com a pasta de nome \texttt{dados\_importar}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"dados\_importar/cereais.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Em algumas situações, as colunas dos arquivos \texttt{.csv} são separadas por ponto-e-vírgula. Esse tipo de arquivo costuma ser utilizado quando os separadores decimais são as vírgulas, como é o caso da sintaxe utilizada no Brasil. Nesse caso, deve-se utilizar a função \texttt{read\_csv2()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv2 }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais2.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Já os arquivos \texttt{.txt} são lidos a partir da função \texttt{read\_delim()}, sendo necessário indicar qual caractere é utilizado para separar as colunas do arquivo a ser importado.

No exemplo a seguir, importaremos um arquivo \texttt{.txt}, separado por tabulação, sendo que o código \texttt{\textbackslash{}t} representa a tecla TAB.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_txt }\OtherTok{\textless{}{-}} \FunctionTok{read\_delim}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.txt"}\NormalTok{, }\AttributeTok{delim =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Também podemos importar o arquivo anterior a partir da função \texttt{read\_tsv()}, pois considera a tabulação como separador. Assim, não precisamos utilizar o argumento \texttt{delim\ =}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais2\_tab }\OtherTok{\textless{}{-}} \FunctionTok{read\_tsv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.txt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{readrgs}{%
\subsection{Outros argumentos}\label{readrgs}}

Alguns outros argumento estão presentes na maioria das funções de importação de arquivos do pacote \texttt{readr}. Essas funções auxiliam na organização do banco de dados, pois visam arrumar alguns detalhes antes mesmo de importá-los ao R. A seguir, citaremos alguns desses:

\hypertarget{skip}{%
\subsubsection*{\texorpdfstring{\texttt{skip\ =}}{skip =}}\label{skip}}
\addcontentsline{toc}{subsubsection}{\texttt{skip\ =}}

Pula linhas do começo do arquivo antes da importação. Muito útil para evitar possíveis textos presentes no início do arquivo. Indique no argumento a quantidade de linhas a serem puladas;

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Exemplo: pular as duas primeiras linhas do banco de dados}
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{skip =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{comment}{%
\subsubsection*{\texorpdfstring{\texttt{comment\ =}}{comment =}}\label{comment}}
\addcontentsline{toc}{subsubsection}{\texttt{comment\ =}}

No caso de arquivos que possuem algum caractere padrão que precede os comentários, usamos esse argumento para indicar qual o caractere utilizado. Por exemplo, caso o caractere \texttt{\#} venha antes de todos os comentários presentes em um arquivo, utilizamos o \texttt{comment\ =\ "\#"} para que o arquivo importado venha sem a parte comentada;

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{comment =} \StringTok{"\#"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{na-1}{%
\subsubsection*{\texorpdfstring{\texttt{na\ =}}{na =}}\label{na-1}}
\addcontentsline{toc}{subsubsection}{\texttt{na\ =}}

Atribui valor \texttt{NA} a determinado caractere especificado no argumento. Aceita um vetor como objeto do argumento. Como exemplo, atribuiremos valor \texttt{NA} ao texto \texttt{Brazil}, presente na coluna \texttt{Area}, a fim de ilustrar o argumento.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{na =} \StringTok{"Brazil"}\NormalTok{)}

\FunctionTok{head}\NormalTok{(cereais\_csv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 14
  `Domain Code` Domain `Area Code` Area  `Element Code` Element      `Item Code`
  <chr>         <chr>        <dbl> <chr>          <dbl> <chr>              <dbl>
1 QC            Crops           21 <NA>            5312 Area harves~          44
2 QC            Crops           21 <NA>            5312 Area harves~          44
3 QC            Crops           21 <NA>            5312 Area harves~          44
4 QC            Crops           21 <NA>            5312 Area harves~          44
5 QC            Crops           21 <NA>            5312 Area harves~          44
6 QC            Crops           21 <NA>            5312 Area harves~          44
# ... with 7 more variables: Item <chr>, `Year Code` <dbl>, Year <dbl>,
#   Unit <chr>, Value <dbl>, Flag <chr>, `Flag Description` <chr>
\end{verbatim}

\hypertarget{col_names}{%
\subsubsection*{\texorpdfstring{\texttt{col\_names\ =}}{col\_names =}}\label{col_names}}
\addcontentsline{toc}{subsubsection}{\texttt{col\_names\ =}}

Por padrão, a função assume que a primeira linha da base de dados é o nome das colunas. Caso a base de dados não venha com os nomes das colunas, utilizamos o argumento \texttt{col\_names\ =\ FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{col\_names =}\NormalTok{ F,}
                        \AttributeTok{skip =} \DecValTok{1}\NormalTok{)}

\FunctionTok{head}\NormalTok{(cereais\_csv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 14
  X1    X2       X3 X4        X5 X6       X7 X8       X9   X10 X11     X12 X13  
  <chr> <chr> <dbl> <chr>  <dbl> <chr> <dbl> <chr> <dbl> <dbl> <chr> <dbl> <chr>
1 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1961  1961 ha    31511 <NA> 
2 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1962  1962 ha    28454 <NA> 
3 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1963  1963 ha    30443 <NA> 
4 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1964  1964 ha    31164 <NA> 
5 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1965  1965 ha    33550 <NA> 
6 QC    Crops    21 Brazil  5312 Area~    44 Barl~  1966  1966 ha    41175 <NA> 
# ... with 1 more variable: X14 <chr>
\end{verbatim}

Perceba que a função atribui nomes genéricos para as colunas, o que dificulta a identificação das variáveis presentes no banco de dados. Para isso, com o mesmo argumento \texttt{col\_names\ =}, podemos (re)nomear as colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{col\_names =} \FunctionTok{c}\NormalTok{(}\StringTok{"cd"}\NormalTok{, }\StringTok{"cod"}\NormalTok{,}\StringTok{"ac"}\NormalTok{, }\StringTok{"pais"}\NormalTok{, }\StringTok{"ec"}\NormalTok{,}
                                      \StringTok{"elemento"}\NormalTok{, }\StringTok{"ic"}\NormalTok{, }\StringTok{"cultura"}\NormalTok{, }\StringTok{"yc"}\NormalTok{,}
                                      \StringTok{"ano"}\NormalTok{, }\StringTok{"unidade"}\NormalTok{, }\StringTok{"valor"}\NormalTok{, }\StringTok{"flag"}\NormalTok{,}
                                      \StringTok{"descricao"}\NormalTok{),}
                        \AttributeTok{skip =} \DecValTok{1}\NormalTok{)}

\FunctionTok{head}\NormalTok{(cereais\_csv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 14
  cd    cod      ac pais     ec elemento    ic cultura    yc   ano unidade valor
  <chr> <chr> <dbl> <chr> <dbl> <chr>    <dbl> <chr>   <dbl> <dbl> <chr>   <dbl>
1 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1961  1961 ha      31511
2 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1962  1962 ha      28454
3 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1963  1963 ha      30443
4 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1964  1964 ha      31164
5 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1965  1965 ha      33550
6 QC    Crops    21 Braz~  5312 Area ha~    44 Barley   1966  1966 ha      41175
# ... with 2 more variables: flag <chr>, descricao <chr>
\end{verbatim}

Como exemplo, renomeamos as colunas com o argumento \texttt{col\_names\ =\ c()}, sendo que cada coluna deve ser, obrigatoriamente, renomeada ou conter o mesmo nome anterior, porém reescrito dentro do vetor, na ordem correta. Perceba que temos que pular a primeira linha (\texttt{skip\ =\ 1}), pois após a renomeação, a primeira linha do \emph{data frame} será o antigo nome das colunas. Por outro lado, caso a base da dados tenha vindo sem nome, o argumento \texttt{skip} não precisa estar presente.

\hypertarget{col_types}{%
\subsubsection*{\texorpdfstring{\texttt{col\_types\ =}}{col\_types =}}\label{col_types}}
\addcontentsline{toc}{subsubsection}{\texttt{col\_types\ =}}

No caso de alguma coluna ser importada com a classe errada ou imprópria, utiliza-se tal argumento para alterar a classe. Será exemplificada a transformação da variável \texttt{Element} em fator e da variável \texttt{Year} em números inteiros.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cereais\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"cereais.csv"}\NormalTok{,}
                        \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{(}
                          \AttributeTok{Element =} \FunctionTok{col\_factor}\NormalTok{(),}
                          \AttributeTok{Year =} \FunctionTok{col\_integer}\NormalTok{()))}

\FunctionTok{class}\NormalTok{(cereais\_csv}\SpecialCharTok{$}\NormalTok{Element)}
\FunctionTok{class}\NormalTok{(cereais\_csv}\SpecialCharTok{$}\NormalTok{Year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{verbatim}
[1] "integer"
\end{verbatim}

\hypertarget{locale}{%
\subsubsection*{\texorpdfstring{\texttt{locale\ =}}{locale =}}\label{locale}}
\addcontentsline{toc}{subsubsection}{\texttt{locale\ =}}

Esse argumento define opções de formatações de certas localidades, como o idioma, formato de datas e horas, separador decimal e \emph{encoding}. É utilizada dentro da função \texttt{read\_}, tendo como objeto a função de mesmo nome, \texttt{locale()}. A seguir, veremos alguns exemplos de aplicações desse argumento.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Função locale() {-} verifica quais padrões estão sendo utilizados}
\FunctionTok{locale}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<locale>
Numbers:  123,456.78
Formats:  %AD / %AT
Timezone: UTC
Encoding: UTF-8
<date_names>
Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed), Thursday
        (Thu), Friday (Fri), Saturday (Sat)
Months: January (Jan), February (Feb), March (Mar), April (Apr), May (May),
        June (Jun), July (Jul), August (Aug), September (Sep), October
        (Oct), November (Nov), December (Dec)
AM/PM:  AM/PM
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Troca os dias e meses para o padrão português}
\FunctionTok{locale}\NormalTok{(}\AttributeTok{date\_names =} \StringTok{"pt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<locale>
Numbers:  123,456.78
Formats:  %AD / %AT
Timezone: UTC
Encoding: UTF-8
<date_names>
Days:   domingo (dom), segunda-feira (seg), terça-feira (ter), quarta-feira
        (qua), quinta-feira (qui), sexta-feira (sex), sábado (sáb)
Months: janeiro (jan), fevereiro (fev), março (mar), abril (abr), maio (mai),
        junho (jun), julho (jul), agosto (ago), setembro (set), outubro
        (out), novembro (nov), dezembro (dez)
AM/PM:  AM/PM
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Troca o separador decimal de ponto para vírgula}
\FunctionTok{locale}\NormalTok{(}\AttributeTok{decimal\_mark =} \StringTok{","}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<locale>
Numbers:  123.456,78
Formats:  %AD / %AT
Timezone: UTC
Encoding: UTF-8
<date_names>
Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed), Thursday
        (Thu), Friday (Fri), Saturday (Sat)
Months: January (Jan), February (Feb), March (Mar), April (Apr), May (May),
        June (Jun), July (Jul), August (Aug), September (Sep), October
        (Oct), November (Nov), December (Dec)
AM/PM:  AM/PM
\end{verbatim}

Outro problema que podemos resolver com o argumento é o \emph{encoding} de arquivos. \emph{Encoding} é a forma como o computador traduz os caracteres replicados no R para valores binários. Há diversos tipos de \emph{encoding}, sendo que o Windows utiliza um diferente em relação ao Linux e Mac. Com isso, é comum termos problemas de \emph{encoding} no Windows quando um arquivo é criado em um desses sistemas operacionais, havendo a desconfiguração de letras com acentos e outros caracteres especiais após a importação para o R. A seguir, demonstraremos o que são os problemas de \emph{encoding} no Windows.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poema\_drummond }\OtherTok{\textless{}{-}} \StringTok{"E agora, José? A festa acabou, a luz apagou, o povo sumiu, a noite esfriou, e agora, José? (...)"}

\CommentTok{\# Verificando encoding no Windows}
\FunctionTok{Encoding}\NormalTok{(poema\_drummond)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "latin1"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Forçando problema de encoding no Windows}
\FunctionTok{Encoding}\NormalTok{(poema\_drummond) }\OtherTok{\textless{}{-}} \StringTok{"UTF{-}8"}
\NormalTok{poema\_drummond}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "E agora, Jos<e9>? A festa acabou, a luz apagou, o povo sumiu, a noite esfriou, e agora, Jos<e9>? (...)"
\end{verbatim}

Para corrigir o \emph{encoding} no Windows, devemos atribuir o \emph{encoding} \texttt{latin1}.

Assim, dependendo de qual sistema operacional um arquivo foi executado, devemos converter para diferentes \emph{encoding}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Dados via Windows: usuário de Windows, converter para "latin1"}
\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_via\_Windows.csv"}\NormalTok{, }\AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{encoding =} \StringTok{"latin1"}\NormalTok{))}

\CommentTok{\# Dados via Linux/Mac: usuário de Windows, converter para "UFT{-}8"}
\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_via\_linux\_mac.csv"}\NormalTok{, }\AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{encoding =} \StringTok{"UFT{-}8"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Outra funcionalidade do argumento \texttt{locale\ =} é o de \emph{parsear} valores. Esse termo, comum no meio da programação, significa arrumar ou formatar um ``valor A'' para um ``valor B'', a partir das similaridades entre ambos.

Como exemplo, podemos converter números que estão em formato de caractere para o formato de números, efetivamente:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{parse\_number}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"5"}\NormalTok{, }\StringTok{"5.0"}\NormalTok{, }\StringTok{"5,0"}\NormalTok{, }\StringTok{"R$5.00"}\NormalTok{, }\StringTok{"5 a"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  5  5 50  5  5
\end{verbatim}

Podemos realizar o mesmo procedimento especificando o \emph{parseamento}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{parse\_number}\NormalTok{(}\StringTok{"5,0"}\NormalTok{, }\AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{decimal\_mark =} \StringTok{","}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5
\end{verbatim}

Ainda, podemos \emph{parsear} datas, de acordo com o idioma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inglês}
\FunctionTok{parse\_date}\NormalTok{(}\StringTok{"08/July/2021"}\NormalTok{,}
           \AttributeTok{format =} \StringTok{"\%d/\%B/\%Y"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2021-07-08"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Português}
\FunctionTok{parse\_date}\NormalTok{(}\StringTok{"08/Julho/2021"}\NormalTok{,}
           \AttributeTok{format =} \StringTok{"\%d/\%B/\%Y"}\NormalTok{,}
           \AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{date\_names =} \StringTok{"pt"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2021-07-08"
\end{verbatim}

Para conferir todos os argumentos presentes nas funções do pacote \texttt{readr}, podemos utilizar a função \texttt{args(nome\_da\_função)}. Exemplificaremos com a função \texttt{read\_csv()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{args}\NormalTok{(read\_csv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
function (file, col_names = TRUE, col_types = NULL, col_select = NULL, 
    id = NULL, locale = default_locale(), na = c("", "NA"), quoted_na = TRUE, 
    quote = "\"", comment = "", trim_ws = TRUE, skip = 0, n_max = Inf, 
    guess_max = min(1000, n_max), name_repair = "unique", num_threads = readr_threads(), 
    progress = show_progress(), show_col_types = should_show_types(), 
    skip_empty_rows = TRUE, lazy = should_read_lazy()) 
NULL
\end{verbatim}

\hypertarget{escrever-arquivos-texto}{%
\subsection{Escrever arquivos texto}\label{escrever-arquivos-texto}}

Também temos a opção de salvar uma base de dados contida no R para um formato específico de arquivo. Para tanto, utilizamos a função \texttt{write\_}, acompanhada dos argumentos \texttt{x\ =} e \texttt{file\ =}, referentes, respectivamente, ao objeto a ser escrito e ao nome do arquivo a ser criado.

Nos exemplos a seguir, escreveremos dados para os formatos \texttt{.csv} e \texttt{.txt}. Utilizaremos os dados do \texttt{mtcars}, presente no banco de dados nativo do R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Arquivo .csv separado por vírgula}
\FunctionTok{write\_csv}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"mtcars.csv"}\NormalTok{)}

\CommentTok{\# Arquivo .csv separado por ponto{-}e{-}vírgula}
\FunctionTok{write\_csv2}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"mtcars.csv"}\NormalTok{)}

\CommentTok{\# Arquivo .txt, separado por tabulação}
\FunctionTok{write\_delim}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"mtcars.txt"}\NormalTok{, }\AttributeTok{delim =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O arquivo escrito estará localizado no diretório referente ao projeto em atividade. Caso queira definir outro local para armazenar o arquivo, especifique-o no argumento \texttt{file\ =}. Por exemplo, caso deseje salvar o arquivo em uma pasta chamada \texttt{banco\_de\_dados}, localizada no diretório do projeto em uso, devemos prosseguir da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Arquivo .csv separado por vírgula}
\FunctionTok{write\_csv}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"banco\_de\_dados/mtcars.csv"}\NormalTok{)}

\CommentTok{\# Arquivo .csv separado por ponto{-}e{-}vírgula}
\FunctionTok{write\_csv2}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"banco\_de\_dados/mtcars.csv"}\NormalTok{)}

\CommentTok{\# Arquivo .txt, separado por tabulação}
\FunctionTok{write\_delim}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{file =} \StringTok{"banco\_de\_dados/mtcars.txt"}\NormalTok{, }\AttributeTok{delim =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pacote-readxl}{%
\section{\texorpdfstring{Pacote \texttt{readxl}}{Pacote readxl}}\label{pacote-readxl}}

\hypertarget{ler-arquivos-excel}{%
\subsection{Ler arquivos Excel}\label{ler-arquivos-excel}}

O pacote \texttt{readxl} lê e importa planilhas Excel em formato \texttt{.xlsx} e \texttt{.xls}. Para tanto, utilizamos a função \texttt{read\_excel()}. Esta função identifica automaticamente qual a extensão do arquivo, seja \texttt{.xlsx} ou \texttt{.xls}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}

\NormalTok{cereais\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"cereais.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Neste mesmo pacote, estão presentes alguns exemplos de arquivos nos formatos \texttt{.xlsx} e \texttt{.xls}. Para conferi-los, utilizamos a função \texttt{readxl\_example()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{readxl\_example}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"
 [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"
 [9] "type-me.xls"   "type-me.xlsx" 
\end{verbatim}

Para utilizar um destes dados, devemos verificar em qual diretório estão localizados. Vamos exemplificar com o arquivo \texttt{"deaths.xlsx"}, salvando sua localização no objeto \texttt{local\_arquivo}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{local\_arquivo }\OtherTok{\textless{}{-}} \FunctionTok{readxl\_example}\NormalTok{(}\StringTok{"deaths.xlsx"}\NormalTok{)}
\NormalTok{local\_arquivo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "C:/Users/Gustavo Jun/Documents/R/win-library/4.1/readxl/extdata/deaths.xlsx"
\end{verbatim}

Em alguns casos, um arquivo Excel pode conter diversas planilhas. Para verificar quais planilhas estão presentes, utilizamos a função \texttt{excel\_sheets()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{excel\_sheets}\NormalTok{(local\_arquivo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "arts"  "other"
\end{verbatim}

Perceba que o arquivo Excel \texttt{deaths} apresenta duas planilhas: ``arts'' e ``other''. Para selecionar a planilha desejada, devemos utilizar o argumento \texttt{sheet\ =} dentro da função \texttt{read\_excel()}. Caso não seja utilizado o argumento, por padrão, será selecionada a primeira planilha contida no arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Primeira planilha}
\FunctionTok{read\_excel}\NormalTok{(local\_arquivo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 18 x 6
   `Lots of people`             ...2                     ...3  ...4  ...5  ...6 
   <chr>                        <chr>                    <chr> <chr> <chr> <chr>
 1 simply cannot resist writing <NA>                     <NA>  <NA>  <NA>  some~
 2 at                           the                      top   <NA>  of    thei~
 3 or                           merging                  <NA>  <NA>  <NA>  cells
 4 Name                         Profession               Age   Has ~ Date~ Date~
 5 David Bowie                  musician                 69    TRUE  17175 42379
 6 Carrie Fisher                actor                    60    TRUE  20749 42731
 7 Chuck Berry                  musician                 90    TRUE  9788  42812
 8 Bill Paxton                  actor                    61    TRUE  20226 42791
 9 Prince                       musician                 57    TRUE  21343 42481
10 Alan Rickman                 actor                    69    FALSE 16854 42383
11 Florence Henderson           actor                    82    TRUE  12464 42698
12 Harper Lee                   author                   89    FALSE 9615  42419
13 Zsa Zsa Gábor                actor                    99    TRUE  6247  42722
14 George Michael               musician                 53    FALSE 23187 42729
15 Some                         <NA>                     <NA>  <NA>  <NA>  <NA> 
16 <NA>                         also like to write stuff <NA>  <NA>  <NA>  <NA> 
17 <NA>                         <NA>                     at t~ bott~ <NA>  <NA> 
18 <NA>                         <NA>                     <NA>  <NA>  <NA>  too! 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Segunda planilha}
\FunctionTok{read\_excel}\NormalTok{(local\_arquivo, }\AttributeTok{sheet =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 18 x 6
   `For the sake`  ...2                     ...3  ...4     ...5          ...6   
   <chr>           <chr>                    <chr> <chr>    <chr>         <chr>  
 1 <NA>            of consistency           <NA>  <NA>     in the        data l~
 2 which is really <NA>                     <NA>  <NA>     a             beauti~
 3 I will          keep making notes        <NA>  <NA>     <NA>          up her~
 4 Name            Profession               Age   Has kids Date of birth Date o~
 5 Vera Rubin      scientist                88    TRUE     10432         42729  
 6 Mohamed Ali     athlete                  74    TRUE     15358         42524  
 7 Morley Safer    journalist               84    TRUE     11635         42509  
 8 Fidel Castro    politician               90    TRUE     9722          42699  
 9 Antonin Scalia  lawyer                   79    TRUE     13220         42413  
10 Jo Cox          politician               41    TRUE     27202         42537  
11 Janet Reno      lawyer                   78    FALSE    14082         42681  
12 Gwen Ifill      journalist               61    FALSE    20361         42688  
13 John Glenn      astronaut                95    TRUE     7880          42712  
14 Pat Summit      coach                    64    TRUE     19159         42549  
15 This            <NA>                     <NA>  <NA>     <NA>          <NA>   
16 <NA>            has been really fun, but <NA>  <NA>     <NA>          <NA>   
17 we're signing   <NA>                     <NA>  <NA>     <NA>          <NA>   
18 <NA>            <NA>                     off   <NA>     now!          <NA>   
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Seleciona a segunda planilha, agora pelo seu nome}
\FunctionTok{read\_excel}\NormalTok{(local\_arquivo, }\AttributeTok{sheet =} \StringTok{"other"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 18 x 6
   `For the sake`  ...2                     ...3  ...4     ...5          ...6   
   <chr>           <chr>                    <chr> <chr>    <chr>         <chr>  
 1 <NA>            of consistency           <NA>  <NA>     in the        data l~
 2 which is really <NA>                     <NA>  <NA>     a             beauti~
 3 I will          keep making notes        <NA>  <NA>     <NA>          up her~
 4 Name            Profession               Age   Has kids Date of birth Date o~
 5 Vera Rubin      scientist                88    TRUE     10432         42729  
 6 Mohamed Ali     athlete                  74    TRUE     15358         42524  
 7 Morley Safer    journalist               84    TRUE     11635         42509  
 8 Fidel Castro    politician               90    TRUE     9722          42699  
 9 Antonin Scalia  lawyer                   79    TRUE     13220         42413  
10 Jo Cox          politician               41    TRUE     27202         42537  
11 Janet Reno      lawyer                   78    FALSE    14082         42681  
12 Gwen Ifill      journalist               61    FALSE    20361         42688  
13 John Glenn      astronaut                95    TRUE     7880          42712  
14 Pat Summit      coach                    64    TRUE     19159         42549  
15 This            <NA>                     <NA>  <NA>     <NA>          <NA>   
16 <NA>            has been really fun, but <NA>  <NA>     <NA>          <NA>   
17 we're signing   <NA>                     <NA>  <NA>     <NA>          <NA>   
18 <NA>            <NA>                     off   <NA>     now!          <NA>   
\end{verbatim}

Podemos verificar outros argumentos presentes nas funções do pacote \texttt{readxl} com a função \texttt{args(nome\_da\_função)}. Exemplificaremos com a função \texttt{read\_excel()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{args}\NormalTok{(read\_excel)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
function (path, sheet = NULL, range = NULL, col_names = TRUE, 
    col_types = NULL, na = "", trim_ws = TRUE, skip = 0, n_max = Inf, 
    guess_max = min(1000, n_max), progress = readxl_progress(), 
    .name_repair = "unique") 
NULL
\end{verbatim}

Como se pode notar, há diversos argumentos idênticos aos demonstrados na subseção \ref{readrgs}, referente ao pacote \texttt{readr}. Contudo, na função \texttt{read\_excel()} não temos o argumento \texttt{locale}, sendo uma falta relevante para que possamos resolver problemas relacionados à temática. Como alternativa, podemos priorizar a importação de arquivos texto ao R, ao invés de planilhas Excel, sendo facilmente resolvido salvando o Excel em formato texto, seja em \texttt{.csv} ou \texttt{.txt}.

\hypertarget{escrever-arquivos-excel}{%
\subsection{Escrever arquivos Excel}\label{escrever-arquivos-excel}}

Também podemos escrever um arquivo Excel em formato \texttt{.xlsx} utilizando a função \texttt{write\_xlsx}, contida no pacote \texttt{writexl}. Utilizaremos novamente os dados \texttt{mtcars} para demonstração.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"writexl"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(writexl)}

\FunctionTok{write\_xlsx}\NormalTok{(mtcars, }\StringTok{"mtcars.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{importauxe7uxe3o-via-url}{%
\section{Importação via URL}\label{importauxe7uxe3o-via-url}}

Uma opção prática para importar dados presentes na internet, diretamente do ambiente do RStudio, se dá via URL, ou seja, a partir do endereço \emph{web} em que se localiza o banco de dados para \emph{download}. Esse método permite a importação direta do banco de dados para o R, sem a necessidade de realizar o \emph{download} de um arquivo para o seu computador.

Como exemplo, importaremos os dados sobre preços praticados por revendedores de combustíveis automotivos e de gás liquefeito de petróleo, no 2º semestre de 2021, coletados do \href{https://dados.gov.br/dataset/serie-historica-de-precos-de-combustiveis-por-revenda/resource/baf0fa4d-488a-45b4-8ba4-d0c9f447f843}{Portal Brasileiro de Dados Abertos}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url }\OtherTok{\textless{}{-}} \StringTok{"https://www.gov.br/anp/pt{-}br/centrais{-}de{-}conteudo/dados{-}abertos/arquivos/shpc/dsas/ca/ca{-}2021{-}02.csv"}

\NormalTok{dados\_comb }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =}\NormalTok{ url)}

\FunctionTok{head}\NormalTok{(dados\_comb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 16
  `Regiao - Sigla` `Estado - Sigla` Municipio Revenda           `CNPJ da Reven~`
  <chr>            <chr>            <chr>     <chr>             <chr>           
1 NE               CE               MARACANAU "BEZERRA & MENDE~ 05.397.086/0001~
2 NE               CE               MARACANAU "BEZERRA & MENDE~ 05.397.086/0001~
3 NE               CE               MARACANAU "BEZERRA & MENDE~ 05.397.086/0001~
4 NE               CE               MARACANAU "BEZERRA & MENDE~ 05.397.086/0001~
5 NE               CE               MARACANAU "LUIZA GLAURIA R~ 03.602.329/0001~
6 NE               CE               MARACANAU "LUIZA GLAURIA R~ 03.602.329/0001~
# ... with 11 more variables: `Nome da Rua` <chr>, `Numero Rua` <chr>,
#   Complemento <chr>, Bairro <chr>, Cep <chr>, Produto <chr>,
#   `Data da Coleta` <chr>, `Valor de Venda` <dbl>, `Valor de Compra` <lgl>,
#   `Unidade de Medida` <chr>, Bandeira <chr>
\end{verbatim}

Para isso, o primeiro passo é salvar a URL em um objeto; no caso, denominamos o objeto de \texttt{url}. Por se tratar de um arquivo \texttt{.csv}, delimitado por \texttt{;}, utilizamos a função \texttt{read\_csv2()} para importar o arquivo, tendo como argumento \texttt{file\ =} a URL salva no objeto \texttt{url}.

\hypertarget{banco-de-dados}{%
\section{Banco de dados}\label{banco-de-dados}}

A seguir, listaremos alguns sites que fornecem uma grande variedade de base de dados públicas. Confira algum que apresente dados de seu interesse, para que você possa aplicá-los futuramente no R.

\begin{itemize}
\item
  FAOSTAT: \url{https://www.fao.org/faostat/en/\#data}
\item
  IBGE: \url{https://sidra.ibge.gov.br/acervo\#/A/Q}
\item
  USDA: \url{https://apps.fas.usda.gov/psdonline/app/index.html\#/app/advQuery}
\item
  DataBank: \url{https://databank.worldbank.org/home.aspx}
\item
  Kaggle: \url{https://www.kaggle.com/datasets};
\item
  Dados do Agro: \url{https://dados.agr.br/fonte-de-dados/}
\end{itemize}

Como pudemos perceber, a importação de dados para o R não é uma tarefa difícil. Devemos nos atentar ao formato em que o arquivo está, a fim de utilizarmos a função de importação correta. Dependendo da fonte dos dados, esses podem vir com algumas configurações indesejadas, o que pode ser resolvido antes mesmo de importarmos os dados, utilizando funções e argumentos específicos para cada necessidade. Por fim, também conhecemos funções que escrevem os dados do R para diversos formatos, seja arquivos texto ou planilhas Excel.

No próximo capítulo, trataremos da etapa de \textbf{arrumar} os dados. Serão apresentadas as \texttt{tibbles}, um tipo de \emph{data frame} que utilizaremos muito, além de explorarmos as funcionalidades presentes no pacote \texttt{tidyr}, a fim de obtermos uma base de dados organizada e fácil de se trabalhar.

\hypertarget{org}{%
\chapter{Organização}\label{org}}

Neste capítulo, trataremos sobre a manipulação dos dados. Esse processo tem como base o conceito de \emph{tidy data}, no qual devemos ajustar os nossos dados em uma estrutura consistente e padronizada. Isso nos permite visualizar, analisar e modelar os dados de maneira mais fácil e rápida. Normalmente, costuma ser trabalhoso o processo de organizar a base de dados, mas, com o auxílio das ferramentas presentes no \texttt{tidyverse}, conseguimos obter bons resultados que, em longo prazo, faz o esforço valer a pena.

Como o próprio nome do pacote sugere, o \texttt{tidyverse} é baseado nos princípios de uma \emph{tidy data}. Por isso, seus pacotes foram desenvolvidos para funcionarem seguindo tal princípio e serem complementares entre si.

No capítulo \ref{import}, demos início ao processo de manipulação dos dados quando alteramos a classe das variáveis, renomeamos as colunas, corrigimos problemas de \emph{encoding}, além de outras ações demonstradas a partir das diversas funções e argumentos.

Neste capítulo, veremos como começar a arrumar uma base de dados já importada para o R e, posteriormente, transformar variáveis de acordo com os interesses de uma análise (capítulo \ref{trans}) e visualizar os dados de forma gráfica (capítulo \ref{graf}).

Para mais detalhes sobre \emph{tidy data}, recomendo dois documentos que abordam o tema. Ambos são da autoria de Hadley Wickham, o idealizador do pacote \texttt{tidyverse}. O primeiro é o \href{https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html}{\emph{The tidy tools manifesto}}, que aborda os princípios que norteiam o \emph{tidyverse}. O outro documento é o artigo \href{https://www.jstatsoft.org/article/view/v059i10}{\emph{Tidy Data}}, que trata de maneira teórica os conceitos de dados arrumados.

Assim sendo, vamos começar a organizar os nossos dados. A seguir, apresentaremos os pacotes \texttt{tibble} e \texttt{tidyr}.

\hypertarget{tibbles}{%
\section{Tibbles}\label{tibbles}}

Nesta seção, veremos o que são as \emph{tibbles} e suas funcionalidades. No capítulo \ref{import} vimos que o pacote \texttt{readr} apresenta funções que convertem diretamente os arquivos importados para o formato \emph{tibble}. Isso se deve ao fato de que os pacotes presentes no \texttt{tidyverse} utilizam como padrão esse formato, ao invés do formato tradicional de \emph{data frame}. Porém, a maioria dos outros pacotes que não estão no \texttt{tidyverse} ainda utilizam o formato de \emph{data frame}.

\emph{Tibbles} nada mais são do que uma versão mais atualizada dos \emph{data frames}, apresentando ajustes importantes que facilitam o trabalho do cientista de dados. Dessa forma, os conceitos que vimos nas seções \ref{dataf} e \ref{df} são válidos para as \emph{tibbles}. Elas fazem parte do pacote \texttt{tibble}, assim, devemos carregar o seu pacote.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tibble)}
\end{Highlighting}
\end{Shaded}

\hypertarget{criando-tibbles}{%
\subsection{\texorpdfstring{Criando \emph{Tibbles}}{Criando Tibbles}}\label{criando-tibbles}}

Para converter \emph{data frames} em \emph{tibbles}, utilizamos a função \texttt{as\_tibble()}. Como exemplo, transformaremos a base de dados nativa do R \texttt{iris} para o formato \emph{tibble}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as\_tibble}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 150 x 5
   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
          <dbl>       <dbl>        <dbl>       <dbl> <fct>  
 1          5.1         3.5          1.4         0.2 setosa 
 2          4.9         3            1.4         0.2 setosa 
 3          4.7         3.2          1.3         0.2 setosa 
 4          4.6         3.1          1.5         0.2 setosa 
 5          5           3.6          1.4         0.2 setosa 
 6          5.4         3.9          1.7         0.4 setosa 
 7          4.6         3.4          1.4         0.3 setosa 
 8          5           3.4          1.5         0.2 setosa 
 9          4.4         2.9          1.4         0.2 setosa 
10          4.9         3.1          1.5         0.1 setosa 
# ... with 140 more rows
\end{verbatim}

Perceba que, por padrão, apenas as 10 primeiras linhas são apresentadas. Caso o número de colunas não couber na largura da tela, essas serão ocultadas da apresentação. Além disso, as \emph{tibbles} mostram as dimensões da tabela (no caso, \texttt{150\ x\ 5}) e a classe de todas as colunas (entre \texttt{\textless{}\ \textgreater{}}).

Já os \emph{data frames}, não apresentam as dimensões da tabela e nem as respectivas classes das colunas. Além disso, sua saída não é a muito boa quando trabalhamos com bases de dados extensas, como podemos ver e comparar a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
1            5.1         3.5          1.4         0.2     setosa
2            4.9         3.0          1.4         0.2     setosa
3            4.7         3.2          1.3         0.2     setosa
4            4.6         3.1          1.5         0.2     setosa
5            5.0         3.6          1.4         0.2     setosa
6            5.4         3.9          1.7         0.4     setosa
7            4.6         3.4          1.4         0.3     setosa
8            5.0         3.4          1.5         0.2     setosa
9            4.4         2.9          1.4         0.2     setosa
10           4.9         3.1          1.5         0.1     setosa
11           5.4         3.7          1.5         0.2     setosa
12           4.8         3.4          1.6         0.2     setosa
13           4.8         3.0          1.4         0.1     setosa
14           4.3         3.0          1.1         0.1     setosa
15           5.8         4.0          1.2         0.2     setosa
16           5.7         4.4          1.5         0.4     setosa
17           5.4         3.9          1.3         0.4     setosa
18           5.1         3.5          1.4         0.3     setosa
19           5.7         3.8          1.7         0.3     setosa
20           5.1         3.8          1.5         0.3     setosa
21           5.4         3.4          1.7         0.2     setosa
22           5.1         3.7          1.5         0.4     setosa
23           4.6         3.6          1.0         0.2     setosa
24           5.1         3.3          1.7         0.5     setosa
25           4.8         3.4          1.9         0.2     setosa
26           5.0         3.0          1.6         0.2     setosa
27           5.0         3.4          1.6         0.4     setosa
28           5.2         3.5          1.5         0.2     setosa
29           5.2         3.4          1.4         0.2     setosa
30           4.7         3.2          1.6         0.2     setosa
31           4.8         3.1          1.6         0.2     setosa
32           5.4         3.4          1.5         0.4     setosa
33           5.2         4.1          1.5         0.1     setosa
34           5.5         4.2          1.4         0.2     setosa
35           4.9         3.1          1.5         0.2     setosa
36           5.0         3.2          1.2         0.2     setosa
37           5.5         3.5          1.3         0.2     setosa
38           4.9         3.6          1.4         0.1     setosa
39           4.4         3.0          1.3         0.2     setosa
40           5.1         3.4          1.5         0.2     setosa
41           5.0         3.5          1.3         0.3     setosa
42           4.5         2.3          1.3         0.3     setosa
43           4.4         3.2          1.3         0.2     setosa
44           5.0         3.5          1.6         0.6     setosa
45           5.1         3.8          1.9         0.4     setosa
46           4.8         3.0          1.4         0.3     setosa
47           5.1         3.8          1.6         0.2     setosa
48           4.6         3.2          1.4         0.2     setosa
49           5.3         3.7          1.5         0.2     setosa
50           5.0         3.3          1.4         0.2     setosa
51           7.0         3.2          4.7         1.4 versicolor
52           6.4         3.2          4.5         1.5 versicolor
53           6.9         3.1          4.9         1.5 versicolor
54           5.5         2.3          4.0         1.3 versicolor
55           6.5         2.8          4.6         1.5 versicolor
56           5.7         2.8          4.5         1.3 versicolor
57           6.3         3.3          4.7         1.6 versicolor
58           4.9         2.4          3.3         1.0 versicolor
59           6.6         2.9          4.6         1.3 versicolor
60           5.2         2.7          3.9         1.4 versicolor
61           5.0         2.0          3.5         1.0 versicolor
62           5.9         3.0          4.2         1.5 versicolor
63           6.0         2.2          4.0         1.0 versicolor
64           6.1         2.9          4.7         1.4 versicolor
65           5.6         2.9          3.6         1.3 versicolor
66           6.7         3.1          4.4         1.4 versicolor
67           5.6         3.0          4.5         1.5 versicolor
68           5.8         2.7          4.1         1.0 versicolor
69           6.2         2.2          4.5         1.5 versicolor
70           5.6         2.5          3.9         1.1 versicolor
71           5.9         3.2          4.8         1.8 versicolor
72           6.1         2.8          4.0         1.3 versicolor
73           6.3         2.5          4.9         1.5 versicolor
74           6.1         2.8          4.7         1.2 versicolor
75           6.4         2.9          4.3         1.3 versicolor
76           6.6         3.0          4.4         1.4 versicolor
77           6.8         2.8          4.8         1.4 versicolor
78           6.7         3.0          5.0         1.7 versicolor
79           6.0         2.9          4.5         1.5 versicolor
80           5.7         2.6          3.5         1.0 versicolor
81           5.5         2.4          3.8         1.1 versicolor
82           5.5         2.4          3.7         1.0 versicolor
83           5.8         2.7          3.9         1.2 versicolor
84           6.0         2.7          5.1         1.6 versicolor
85           5.4         3.0          4.5         1.5 versicolor
86           6.0         3.4          4.5         1.6 versicolor
87           6.7         3.1          4.7         1.5 versicolor
88           6.3         2.3          4.4         1.3 versicolor
89           5.6         3.0          4.1         1.3 versicolor
90           5.5         2.5          4.0         1.3 versicolor
91           5.5         2.6          4.4         1.2 versicolor
92           6.1         3.0          4.6         1.4 versicolor
93           5.8         2.6          4.0         1.2 versicolor
94           5.0         2.3          3.3         1.0 versicolor
95           5.6         2.7          4.2         1.3 versicolor
96           5.7         3.0          4.2         1.2 versicolor
97           5.7         2.9          4.2         1.3 versicolor
98           6.2         2.9          4.3         1.3 versicolor
99           5.1         2.5          3.0         1.1 versicolor
100          5.7         2.8          4.1         1.3 versicolor
101          6.3         3.3          6.0         2.5  virginica
102          5.8         2.7          5.1         1.9  virginica
103          7.1         3.0          5.9         2.1  virginica
104          6.3         2.9          5.6         1.8  virginica
105          6.5         3.0          5.8         2.2  virginica
106          7.6         3.0          6.6         2.1  virginica
107          4.9         2.5          4.5         1.7  virginica
108          7.3         2.9          6.3         1.8  virginica
109          6.7         2.5          5.8         1.8  virginica
110          7.2         3.6          6.1         2.5  virginica
111          6.5         3.2          5.1         2.0  virginica
112          6.4         2.7          5.3         1.9  virginica
113          6.8         3.0          5.5         2.1  virginica
114          5.7         2.5          5.0         2.0  virginica
115          5.8         2.8          5.1         2.4  virginica
116          6.4         3.2          5.3         2.3  virginica
117          6.5         3.0          5.5         1.8  virginica
118          7.7         3.8          6.7         2.2  virginica
119          7.7         2.6          6.9         2.3  virginica
120          6.0         2.2          5.0         1.5  virginica
121          6.9         3.2          5.7         2.3  virginica
122          5.6         2.8          4.9         2.0  virginica
123          7.7         2.8          6.7         2.0  virginica
124          6.3         2.7          4.9         1.8  virginica
125          6.7         3.3          5.7         2.1  virginica
126          7.2         3.2          6.0         1.8  virginica
127          6.2         2.8          4.8         1.8  virginica
128          6.1         3.0          4.9         1.8  virginica
129          6.4         2.8          5.6         2.1  virginica
130          7.2         3.0          5.8         1.6  virginica
131          7.4         2.8          6.1         1.9  virginica
132          7.9         3.8          6.4         2.0  virginica
133          6.4         2.8          5.6         2.2  virginica
134          6.3         2.8          5.1         1.5  virginica
135          6.1         2.6          5.6         1.4  virginica
136          7.7         3.0          6.1         2.3  virginica
137          6.3         3.4          5.6         2.4  virginica
138          6.4         3.1          5.5         1.8  virginica
139          6.0         3.0          4.8         1.8  virginica
140          6.9         3.1          5.4         2.1  virginica
141          6.7         3.1          5.6         2.4  virginica
142          6.9         3.1          5.1         2.3  virginica
143          5.8         2.7          5.1         1.9  virginica
144          6.8         3.2          5.9         2.3  virginica
145          6.7         3.3          5.7         2.5  virginica
146          6.7         3.0          5.2         2.3  virginica
147          6.3         2.5          5.0         1.9  virginica
148          6.5         3.0          5.2         2.0  virginica
149          6.2         3.4          5.4         2.3  virginica
150          5.9         3.0          5.1         1.8  virginica
\end{verbatim}

Caso queira ter uma visão completa dos dados, a melhor forma de fazê-la é utilizando a função \texttt{view()}. Teste o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{View}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

Também podemos criar uma \emph{tibble} do zero, a partir de vetores individuais, com a função \texttt{tibble()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{nomes =} \FunctionTok{c}\NormalTok{(}\StringTok{"José"}\NormalTok{, }\StringTok{"João"}\NormalTok{, }\StringTok{"Maria"}\NormalTok{, }\StringTok{"Ana"}\NormalTok{),}
  \AttributeTok{sexo =} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{),}
  \AttributeTok{idade =} \DecValTok{21}\SpecialCharTok{:}\DecValTok{24}\NormalTok{,}
  \AttributeTok{idade\_ao\_quadrado =}\NormalTok{ idade }\SpecialCharTok{\^{}} \DecValTok{2}\NormalTok{,}
  \AttributeTok{filhos =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 5
  nomes sexo  idade idade_ao_quadrado filhos
  <chr> <chr> <int>             <dbl>  <dbl>
1 José  M        21               441      0
2 João  M        22               484      0
3 Maria F        23               529      0
4 Ana   F        24               576      0
\end{verbatim}

No exemplo acima, veja que foi possível criar a coluna \texttt{idade\_ao\_quadrado} em função de outra coluna, a \texttt{idade}. Na coluna \texttt{filhos}, passamos um vetor de tamanho 1, ocorrendo o processo de reciclagem do vetor (tema tratado na seção \ref{vetor}), ou seja, foi atribuído o valor \texttt{0} para todas as demais observações até que se igualasse o número de linhas da \emph{tibble}.

É possível colocar nomes de colunas com caracteres de sintaxe inválida (tema tratado na seção \ref{obj}), desde que os nomes estejam entre acentos graves (`). No caso dos \emph{data frames}, teríamos dificuldades em trabalhar com esse tipo de sintaxe, pois os nomes seriam convertidos para um formato que se enquadre na sintaxe válida, portanto, ocorreria uma alteração dos nomes designados originalmente.

A seguir, criaremos um exemplo de \emph{tibble} (puramente a título de demonstração) com nomes que contêm espaços, começam com números e possuem caracteres especiais.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{nomes dos estudantes}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"José"}\NormalTok{, }\StringTok{"João"}\NormalTok{, }\StringTok{"Maria"}\NormalTok{, }\StringTok{"Ana"}\NormalTok{),}
  \StringTok{\textasciigrave{}}\AttributeTok{2sexo}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{),}
  \StringTok{\textasciigrave{}}\AttributeTok{:)idade}\StringTok{\textasciigrave{}} \OtherTok{=} \DecValTok{21}\SpecialCharTok{:}\DecValTok{24}\NormalTok{,}
  \StringTok{\textasciigrave{}}\AttributeTok{idade²}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{:)idade}\StringTok{\textasciigrave{}} \SpecialCharTok{\^{}} \DecValTok{2}\NormalTok{,}
  \StringTok{\textasciigrave{}}\AttributeTok{nº filhos}\StringTok{\textasciigrave{}} \OtherTok{=} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 5
  `nomes dos estudantes` `2sexo` `:)idade` idade² `nº filhos`
  <chr>                  <chr>       <int>  <dbl>       <dbl>
1 José                   M              21    441           0
2 João                   M              22    484           0
3 Maria                  F              23    529           0
4 Ana                    F              24    576           0
\end{verbatim}

Por consequência, quando trabalharmos com as variáveis nomeadas dessa forma, precisaremos colocá-las sempre entre acentos graves, como foi o caso da construção da coluna \texttt{idade²}, em que tivemos que colocar a coluna \texttt{:)idade} entre acentos graves para que conseguíssemos elevar seus valores ao quadrado.

Por último, podemos criar \emph{tibbles} com a função \texttt{tribble()}. A \texttt{tribble()} é construída definindo os nomes das colunas por fórmulas (começando com \texttt{\textasciitilde{}}), cujos valores são separados por vírgulas, sendo uma forma mais visual e intuitiva para construir pequenas \emph{tibbles}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{nome, }\SpecialCharTok{\textasciitilde{}}\NormalTok{id, }\SpecialCharTok{\textasciitilde{}}\NormalTok{sexo,}
  \CommentTok{\#{-}{-}{-}{-}{-}|{-}{-}{-}|{-}{-}{-}{-}{-}{-}}
  \StringTok{"João"}\NormalTok{, }\DecValTok{25}\NormalTok{, }\StringTok{"M"}\NormalTok{,}
  \StringTok{"José"}\NormalTok{, }\DecValTok{30}\NormalTok{, }\StringTok{"M"}\NormalTok{,}
  \StringTok{"Ana"}\NormalTok{, }\DecValTok{23}\NormalTok{, }\StringTok{"F"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 3
  nome     id sexo 
  <chr> <dbl> <chr>
1 João     25 M    
2 José     30 M    
3 Ana      23 F    
\end{verbatim}

Veja que é possível até mesmo adicionar um comentário (\texttt{\#}) para criar uma delimitação entre o cabeçalho e os valores, tornando o código ainda mais visual.

\hypertarget{outras-funuxe7uxf5es}{%
\subsection{Outras funções}\label{outras-funuxe7uxf5es}}

Podemos adicionar novas linhas e colunas à \emph{tibble} com as funções \texttt{add\_row()} e \texttt{add\_column()}, respectivamente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tib }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{nomes =} \FunctionTok{c}\NormalTok{(}\StringTok{"José"}\NormalTok{, }\StringTok{"João"}\NormalTok{, }\StringTok{"Maria"}\NormalTok{),}
  \AttributeTok{sexo =} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{)}
\NormalTok{)}

\NormalTok{tib\_col }\OtherTok{\textless{}{-}} \FunctionTok{add\_column}\NormalTok{(tib, }\AttributeTok{idade =} \FunctionTok{c}\NormalTok{(}\DecValTok{26}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{19}\NormalTok{))}

\NormalTok{tib\_col}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 3
  nomes sexo  idade
  <chr> <chr> <dbl>
1 José  M        26
2 João  M        30
3 Maria F        19
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tib\_row }\OtherTok{\textless{}{-}} \FunctionTok{add\_row}\NormalTok{(tib\_col,}
                   \AttributeTok{nomes =} \FunctionTok{c}\NormalTok{(}\StringTok{"Ana"}\NormalTok{, }\StringTok{"Beatriz"}\NormalTok{),}
                   \AttributeTok{sexo =} \StringTok{"F"}\NormalTok{,}
                   \AttributeTok{idade =} \FunctionTok{c}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{23}\NormalTok{))}

\NormalTok{tib\_row}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5 x 3
  nomes   sexo  idade
  <chr>   <chr> <dbl>
1 José    M        26
2 João    M        30
3 Maria   F        19
4 Ana     F        20
5 Beatriz F        23
\end{verbatim}

\hypertarget{pacote-tidyr}{%
\section{\texorpdfstring{Pacote \texttt{tidyr}}{Pacote tidyr}}\label{pacote-tidyr}}

Nesta seção, abordaremos as principais ferramentas de organização de dados presentes no pacote \texttt{tidyr}. Portanto, precisamos rodá-lo no R.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}
\end{Highlighting}
\end{Shaded}

A seguir, aplicaremos as ferramentas do \texttt{tidyr} em uma mesma base de dados, porém em diversas versões desarrumadas \footnote{O termo \emph{desarrumada} não é o mais apropriado para nos referirmos aos demais formatos de dados, pois o formato \emph{tidy} é um dos possíveis para se trabalhar com dados - principalmente quando trabalhamos com dados retangulares - utilizando o pacote \texttt{tidyverse}. Portanto, quando nos referirmos a dados \emph{desarrumados}, entenda como dados fora do padrão \emph{tidy data} ou \emph{não-tidy}. Para entender mais sobre os dados \emph{não-tidy}, recomendo o post do \href{https://simplystatistics.org/posts/2016-02-17-non-tidy-data/}{Jeff Leek} sobre o assunto.} . Os dados são referentes a produção (em toneladas) e a área colhida (em hectares) da cultura do milho, no Brasil, China e Índia, nos anos de 2000 e 2019. Para fazer o \emph{download} da pasta contendo as bases de dados, \href{https://github.com/gustavojy/ApostilaCD-R/blob/main/dados_zip/dados_tidy.zip}{clique aqui}.

\hypertarget{base-de-dados-tidy}{%
\subsection{\texorpdfstring{Base de dados \emph{tidy}}{Base de dados tidy}}\label{base-de-dados-tidy}}

Antes de abordarmos as bases desarrumadas, vamos tratar da base de dados arrumadas.

Para alcançarmos a tão desejada base de dados arrumada, devemos ter em mente as três principais propriedades de uma \emph{tidy data}:

\begin{itemize}
\item
  Cada variável possui sua própria coluna;
\item
  Cada observação possui sua própria linha;
\item
  Cada célula contém somente um único valor.
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{imagens/tidy_data} 

}

\caption{Seguindo os princípios da tidy data, cada variável possui uma coluna, cada observação está em uma linha e cada célula contém somente um valor.}\label{fig:unnamed-chunk-115}
\end{figure}

Como citamos em capítulos anteriores, cada coluna de um \emph{data frame} (ou \emph{tibble}) é um vetor. Ao designar uma variável à uma única coluna, podemos trabalhar com as informações a partir de vetores individualizados. Portanto, os conceitos vistos na seção \ref{vetor}, referente aos vetores, são aplicáveis a cada uma das colunas de uma base de dados organizada. E é dessa maneira que os pacotes do \texttt{tidyverse} trabalham.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidy }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_tidy/tidy.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais     ano colheita  producao
  <chr>  <dbl>    <dbl>     <dbl>
1 Brasil  2000 11890376  32321000
2 Brasil  2019 17518054 101138617
3 China   2000 23086228 106178315
4 China   2019 41309740 260957662
5 India   2000  6611300  12043200
6 India   2019  9027130  27715100
\end{verbatim}

Portanto, esse é um exemplo de uma base de dados organizada. Cada coluna é uma variável, cada observação está em uma linha e cada célula contém um único valor. Assim, sempre que se deparar com uma nova base de dados, observe primeiro quais elementos são variáveis e quais são observações, e se uma célula contém um ou mais valores.

Nos próximos capítulos, veremos como utilizar uma \emph{tidy data} para realizar transformações e gráficos. Mas antes, temos que tratar dos dados desarrumados.

\hypertarget{pivotagem}{%
\subsection{Pivotagem}\label{pivotagem}}

Uma forma de organizarmos os nossos dados é realizando a pivotagem. Este método converte as observações que estão como nome de colunas, para linhas; e variáveis que estão em linhas, para as colunas.

\hypertarget{pivot-longer}{%
\subsubsection*{Pivot longer}\label{pivot-longer}}
\addcontentsline{toc}{subsubsection}{Pivot longer}

A função \texttt{pivot\_longer()} converte as observações que estão como nome das colunas, para linhas. Aplicaremos sua função no arquivo \texttt{tidy1a\_prod.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plonger1 }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_tidy/tidy1a\_prod.csv"}\NormalTok{)}

\NormalTok{plonger1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 3
  pais      `2000`    `2019`
  <chr>      <dbl>     <dbl>
1 Brasil  32321000 101138617
2 China  106178315 260957662
3 India   12043200  27715100
\end{verbatim}

Veja que as observações referentes aos anos (\texttt{2000} e \texttt{2019}) estão como nome das colunas, cada qual com os valores referentes a produção de milho nos respectivos anos. Para arrumá-las, devemos criar duas novas colunas, uma para alocar os anos e outra, para os valores de produção de milho.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plonger1\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{data =}\NormalTok{ plonger1,}
                              \AttributeTok{col =} \FunctionTok{c}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{2000}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{2019}\StringTok{\textasciigrave{}}\NormalTok{),}
                              \AttributeTok{names\_to =} \StringTok{"ano"}\NormalTok{, }
                              \AttributeTok{values\_to =} \StringTok{"producao"}\NormalTok{)}
\NormalTok{plonger1\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 3
  pais   ano    producao
  <chr>  <chr>     <dbl>
1 Brasil 2000   32321000
2 Brasil 2019  101138617
3 China  2000  106178315
4 China  2019  260957662
5 India  2000   12043200
6 India  2019   27715100
\end{verbatim}

Assim, na função \texttt{pivot\_longer()}, utilizamos o argumento \texttt{data\ =} para indicar qual a base de dados desejamos arrumar - no caso o objeto \texttt{plonger1}. Em seguida, utilizamos o argumento \texttt{col} para selecionar as colunas que desejamos pivotar. Já no argumento \texttt{names\_to} devemos dizer para qual coluna os nomes selecionados devem ir (no caso, os nomes \texttt{2000} e \texttt{2019}), portanto, são direcionados para a nova coluna \texttt{ano}. Por fim, no argumento \texttt{values\_to}, dizemos que os valores contidos nas colunas \texttt{2000} e \texttt{2019} devem ir para uma única coluna, denominada \texttt{producao}.

Perceba que os valores se mantém associados às antigas colunas \texttt{2000} e \texttt{2019}, agora como valores de uma observação.

Podemos fazer o mesmo com os dados referentes à área colhida - presente no arquivo \texttt{tidy1b\_col.csv} - somente alterando o atributo do argumento \texttt{values\_to} para \texttt{colheita}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plonger2 }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_tidy/tidy1b\_col.csv"}\NormalTok{)}

\NormalTok{plonger2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 3
  pais     `2000`   `2019`
  <chr>     <dbl>    <dbl>
1 Brasil 11890376 17518054
2 China  23086228 41309740
3 India   6611300  9027130
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plonger2\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{data =}\NormalTok{ plonger2,}
                              \AttributeTok{col =} \FunctionTok{c}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{2000}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{2019}\StringTok{\textasciigrave{}}\NormalTok{),}
                              \AttributeTok{names\_to =} \StringTok{"ano"}\NormalTok{, }
                              \AttributeTok{values\_to =} \StringTok{"colheita"}\NormalTok{)}
\NormalTok{plonger2\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 3
  pais   ano   colheita
  <chr>  <chr>    <dbl>
1 Brasil 2000  11890376
2 Brasil 2019  17518054
3 China  2000  23086228
4 China  2019  41309740
5 India  2000   6611300
6 India  2019   9027130
\end{verbatim}

Para juntar ambas as tabelas, utilizamos a \texttt{dplyr::full\_join()}, presente no pacote \texttt{dplyr}, a qual veremos com mais detalhes no capítulo \ref{trans}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plonger }\OtherTok{\textless{}{-}} \FunctionTok{full\_join}\NormalTok{(plonger1\_tidy, plonger2\_tidy)}

\NormalTok{plonger}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais   ano    producao colheita
  <chr>  <chr>     <dbl>    <dbl>
1 Brasil 2000   32321000 11890376
2 Brasil 2019  101138617 17518054
3 China  2000  106178315 23086228
4 China  2019  260957662 41309740
5 India  2000   12043200  6611300
6 India  2019   27715100  9027130
\end{verbatim}

\hypertarget{pivot-wider}{%
\subsubsection*{Pivot wider}\label{pivot-wider}}
\addcontentsline{toc}{subsubsection}{Pivot wider}

A função \texttt{pivot\_wider()} é a oposta da \texttt{pivot\_longer()}. Ela é usada para converter as variáveis que estão nas linhas, para o nome das colunas. Como exemplo, utilizaremos o arquivo \texttt{tidy2.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pwider }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"dados\_tidy/tidy2.csv"}\NormalTok{)}

\NormalTok{pwider}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 12 x 4
   pais     ano tipo         valor
   <chr>  <dbl> <chr>        <dbl>
 1 Brasil  2000 colheita  11890376
 2 Brasil  2019 colheita  17518054
 3 Brasil  2000 producao  32321000
 4 Brasil  2019 producao 101138617
 5 China   2000 colheita  23086228
 6 China   2019 colheita  41309740
 7 China   2000 producao 106178315
 8 China   2019 producao 260957662
 9 India   2000 colheita   6611300
10 India   2019 colheita   9027130
11 India   2000 producao  12043200
12 India   2019 producao  27715100
\end{verbatim}

Como podemos observar, as variáveis \texttt{colheita} e \texttt{producao} estão como valores de observações. Portanto, devemos transformá-las em nomes de colunas, recebendo os respectivos valores associados à coluna \texttt{valor}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pwider\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{data =}\NormalTok{ pwider,}
                           \AttributeTok{names\_from =}\NormalTok{ tipo,}
                           \AttributeTok{values\_from =}\NormalTok{ valor)}
\NormalTok{pwider\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais     ano colheita  producao
  <chr>  <dbl>    <dbl>     <dbl>
1 Brasil  2000 11890376  32321000
2 Brasil  2019 17518054 101138617
3 China   2000 23086228 106178315
4 China   2019 41309740 260957662
5 India   2000  6611300  12043200
6 India   2019  9027130  27715100
\end{verbatim}

Assim, na função \texttt{pivot\_wider()}, utilizamos o argumento \texttt{names\_from} para dizer em qual coluna (\texttt{tipo}) estão os nomes das novas variáveis (\texttt{producao} e \texttt{colheita}) e o \texttt{values\_from} para indicar em qual coluna estão localizados os respectivos valores das novas colunas criadas.

Portanto, podemos dizer que a \texttt{pivot\_longer()} torna a base de dados mais longa (reduz o número de colunas e aumenta o número de linhas) e a \texttt{pivot\_wider()}, deixa mais larga (aumenta o número de colunas e diminui o número de linhas).

Para conferir todos os argumentos das funções \texttt{pivot\_longer()} e \texttt{pivot\_wider()}, utilize as funções \texttt{args(pivot\_longer)} e \texttt{args(pivot\_wider)}, respectivamente.

\hypertarget{separar-e-unir}{%
\subsection{Separar e Unir}\label{separar-e-unir}}

Para tratar das funções de separar e unir, exemplificaremos com os dados do arquivo \texttt{tidy3.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sep\_unir }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"dados\_tidy/tidy3.csv"}\NormalTok{)}

\NormalTok{sep\_unir}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 3
  pais     ano produtividade     
  <chr>  <dbl> <chr>             
1 Brasil  2000 32321000/11890376 
2 Brasil  2019 101138617/17518054
3 China   2000 106178315/23086228
4 China   2019 260957662/41309740
5 India   2000 12043200/6611300  
6 India   2019 27715100/9027130  
\end{verbatim}

\hypertarget{separar}{%
\subsubsection*{Separar}\label{separar}}
\addcontentsline{toc}{subsubsection}{Separar}

O banco de dados apresentado acima apresenta a coluna \texttt{produtividade}, cujos valores são representados como \texttt{produção/área\ colhida}. Portanto, precisamos separá-los em duas colunas, pois temos duas variáveis em uma mesma coluna e dois valores em uma mesma célula. Para isso utilizaremos a função \texttt{separate()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sep\_unir\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{separate}\NormalTok{(}\AttributeTok{data =}\NormalTok{ sep\_unir,}
                          \AttributeTok{col =}\NormalTok{ produtividade,}
                          \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"producao"}\NormalTok{, }\StringTok{"colheita"}\NormalTok{))}
\NormalTok{sep\_unir\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais     ano producao  colheita
  <chr>  <dbl> <chr>     <chr>   
1 Brasil  2000 32321000  11890376
2 Brasil  2019 101138617 17518054
3 China   2000 106178315 23086228
4 China   2019 260957662 41309740
5 India   2000 12043200  6611300 
6 India   2019 27715100  9027130 
\end{verbatim}

Na função \texttt{separate()}, indicamos a base de dados a ser processada no argumento \texttt{data\ =}; posteriormente, declaramos no argumento \texttt{col\ =} o nome da coluna a ser separada - no caso, a \texttt{produtividade} -, e com o argumento \texttt{into\ =}, dizemos o nome das novas colunas que direcionaremos os valores da coluna separada (\texttt{producao} e \texttt{"colheita}).

Por padrão, a função \texttt{separate()} irá quebrar os valores quando perceber que entre eles há um operador não numérico ou não textual, como foi o caso do exemplo acima, que apresentava uma \texttt{/} separando os valores. Caso for necessário especificar qual o separador utilizado, devemos utilizar o argumento \texttt{sep}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sep\_unir\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{separate}\NormalTok{(}\AttributeTok{data =}\NormalTok{ sep\_unir,}
                          \AttributeTok{col =}\NormalTok{ produtividade,}
                          \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"producao"}\NormalTok{, }\StringTok{"colheita"}\NormalTok{),}
                          \AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}
\NormalTok{sep\_unir\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais     ano producao  colheita
  <chr>  <dbl> <chr>     <chr>   
1 Brasil  2000 32321000  11890376
2 Brasil  2019 101138617 17518054
3 China   2000 106178315 23086228
4 China   2019 260957662 41309740
5 India   2000 12043200  6611300 
6 India   2019 27715100  9027130 
\end{verbatim}

Perceba que a classe das novas colunas vieram como tipo caractere. Por padrão, a função \texttt{separate()} sempre adotará essa classe. Para corrigirmos a classe, podemos utilizar o argumento \texttt{convert\ =\ TRUE}, ou seja, pedir para função adotar uma classe mais apropriada aos valores contidos nas colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sep\_unir\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{separate}\NormalTok{(}\AttributeTok{data =}\NormalTok{ sep\_unir,}
                          \AttributeTok{col =}\NormalTok{ produtividade,}
                          \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"producao"}\NormalTok{, }\StringTok{"colheita"}\NormalTok{),}
                          \AttributeTok{sep =} \StringTok{"/"}\NormalTok{,}
                          \AttributeTok{convert =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{sep\_unir\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais     ano  producao colheita
  <chr>  <dbl>     <int>    <int>
1 Brasil  2000  32321000 11890376
2 Brasil  2019 101138617 17518054
3 China   2000 106178315 23086228
4 China   2019 260957662 41309740
5 India   2000  12043200  6611300
6 India   2019  27715100  9027130
\end{verbatim}

Feito isso, temos a classe \texttt{int} (números inteiros) para as colunas \texttt{producao} e \texttt{colheita}.

Também podemos separar valores informando uma quantidade de caracteres a serem considerados na separação. Para isso, informamos no argumento \texttt{sep} a quantidade dos primeiros caracteres que desejamos quebrar. Por exemplo, para separar os valores da coluna \texttt{ano} em \texttt{seculo} e \texttt{decada}, podemos passar o argumento \texttt{sep\ =\ 2}, ou seja, o argumento selecionará os dois primeiros caracteres dos valores contidos na coluna \texttt{ano} e os separará dos demais, formando as novas colunas \texttt{seculo} e \texttt{decada}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{separar }\OtherTok{\textless{}{-}}\FunctionTok{separate}\NormalTok{(}\AttributeTok{data =}\NormalTok{ sep\_unir\_tidy,}
                   \AttributeTok{col =}\NormalTok{ ano,}
                   \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"seculo"}\NormalTok{, }\StringTok{"decada"}\NormalTok{),}
                   \AttributeTok{sep =} \DecValTok{2}\NormalTok{)}

\NormalTok{separar}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 5
  pais   seculo decada  producao colheita
  <chr>  <chr>  <chr>      <int>    <int>
1 Brasil 20     00      32321000 11890376
2 Brasil 20     19     101138617 17518054
3 China  20     00     106178315 23086228
4 China  20     19     260957662 41309740
5 India  20     00      12043200  6611300
6 India  20     19      27715100  9027130
\end{verbatim}

Nesse caso, o argumento \texttt{sep\ =\ 2} pegou os dois primneiros número e os separou dos demais. Caso houver um número negativo, o argumento considera o sinal de negativo como o primeiro caractere informado no argumento.

\hypertarget{unir}{%
\subsubsection*{Unir}\label{unir}}
\addcontentsline{toc}{subsubsection}{Unir}

A função \texttt{unite()} é a inversa de \texttt{separate()}. Portanto, combina múltiplas colunas em uma única. Usaremos a \texttt{unite()} para juntar novamente as colunas \texttt{seculo} e \texttt{decada} para apenas a coluna \texttt{novamente\_ano}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{unir }\OtherTok{\textless{}{-}} \FunctionTok{unite}\NormalTok{(}\AttributeTok{data =}\NormalTok{ separar,}
              \AttributeTok{col =} \StringTok{"novamente\_ano"}\NormalTok{,}
\NormalTok{              seculo, decada,}
              \AttributeTok{sep =} \StringTok{""}\NormalTok{)}

\NormalTok{unir}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  pais   novamente_ano  producao colheita
  <chr>  <chr>             <int>    <int>
1 Brasil 2000           32321000 11890376
2 Brasil 2019          101138617 17518054
3 China  2000          106178315 23086228
4 China  2019          260957662 41309740
5 India  2000           12043200  6611300
6 India  2019           27715100  9027130
\end{verbatim}

No argumento \texttt{col\ =} dizemos qual o nome da nova coluna, em seguida, as colunas a serem juntadas (\texttt{seculo} e \texttt{decada}), e o \texttt{sep\ =}, para informar qual o separador utilizado. Nesse caso, precisavamos juntar os valores sem qualquer caractere ou espaço, portanto, nosso argumento recebe apenas duas aspas \texttt{""}. Caso não fosse informado o argumento \texttt{sep}, por padrão, a função adota o \emph{underline} (\texttt{\_}) como separador.

Para conferir todos os argumentos das funções \texttt{separate()} e \texttt{unite()}, utilize as funções \texttt{args(separate)} e \texttt{args(unite)}, respectivamente.

De maneira geral, essas são as principais ferramentas quando o tema é arrumar os dados. A seguir, agora com os dados arrumados, iremos transformar as nossas bases de dados para que contenha apenas as variáveis de nosso interesse e também criar novas variáveis, de acordo com as existentes.

\hypertarget{trans}{%
\chapter{Transformação}\label{trans}}

A etapa de transformação dos dados consiste em selecionar as variáveis e observações de interesse no nosso banco de dados, a fim de gerar medidas úteis para a análise. Podemos realizar operações entre colunas de acordo com determinada variável, calcular a média, mediana, contagem e porcentagens, além de selecionar, filtrar e criar novas variáveis.

Os principais pacotes relacionados ao tema, presentes no \texttt{tidyverse}, são o \texttt{dplyr}, \texttt{stringr}, \texttt{forcats} e \texttt{lubridate}, cada qual apresentando funções particulares e específicas para trabalhar com os dados. Nesta apostila, abordaremos apenas o pacote \texttt{dplyr}, cujas funções conseguem resolver a maioria dos problemas relacionados a essa etapa.

Os demais pacotes tratam de assuntos específicos na transformação de dados. Caso você precise tratar de algum problema que o \texttt{dplyr} não consiga resolver, descreveremos, brevemente, as características desses pacotes para facilitar suas pesquisas.

\begin{itemize}
\item
  \texttt{stringr}: manipula as variáveis categóricas a partir de \textbf{expressões regulares (REGEX)};
\item
  \texttt{forcats}: apresenta funções que lidam com variáveis do tipo fator (\emph{factor}). Caso queira entender melhor sobre esse tipo de classe, confira a seção \ref{fator};
\item
  \texttt{lubridate}: pacote específico para trabalhar com variáveis do tipo data e tempo.
\end{itemize}

A seguir, trataremos com detalhes as funcionalidades presentes no pacote \texttt{dplyr}. Para tanto, precisamos rodar o pacote.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

Para verificar todas as funcionalidades presentes no pacote, rode o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ls}\NormalTok{(}\StringTok{"package:dplyr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pacote-dplyr}{%
\section{\texorpdfstring{Pacote \texttt{dplyr}}{Pacote dplyr}}\label{pacote-dplyr}}

O pacote \texttt{dplyr} possui ferramentas simples, porém muito importantes para realizar as devidas transformações na base de dados. A seguir, apresentaremos as principais funções do pacote, que nos permitem resolver a maioria dos problemas relacionados à etapa de transformação dos dados.

A base de dados utilizada para os exemplos é referente à produção de milho, soja, trigo e arroz, nos países da América do Sul, entre 1961 e 2019, obtidos da FAOSTAT. Para fazer o \emph{download} dos dados, \href{https://github.com/gustavojy/ApostilaCD-R/blob/main/dados_zip/dados_transf.zip?raw=true}{clique aqui}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_transf/prod\_graos.csv"}\NormalTok{)}

\NormalTok{graos}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 14
   `Domain Code` Domain            `Area Code (FA~` Area  `Element Code` Element
   <chr>         <chr>                        <dbl> <chr>          <dbl> <chr>  
 1 QCL           Crops and livest~                9 Arge~           5312 Area h~
 2 QCL           Crops and livest~                9 Arge~           5312 Area h~
 3 QCL           Crops and livest~                9 Arge~           5312 Area h~
 4 QCL           Crops and livest~                9 Arge~           5312 Area h~
 5 QCL           Crops and livest~                9 Arge~           5312 Area h~
 6 QCL           Crops and livest~                9 Arge~           5312 Area h~
 7 QCL           Crops and livest~                9 Arge~           5312 Area h~
 8 QCL           Crops and livest~                9 Arge~           5312 Area h~
 9 QCL           Crops and livest~                9 Arge~           5312 Area h~
10 QCL           Crops and livest~                9 Arge~           5312 Area h~
# ... with 5,500 more rows, and 8 more variables: `Item Code (FAO)` <dbl>,
#   Item <chr>, `Year Code` <dbl>, Year <dbl>, Unit <chr>, Value <dbl>,
#   Flag <chr>, `Flag Description` <chr>
\end{verbatim}

O banco de dados possui 5510 observações e 14 variáveis. Como podemos observar, muitas das variáveis são referentes à códigos de identificação, os quais não nos interessam para a realização das análises. Assim, a seguir, veremos como selecionar somente as variáveis de interesse.

\hypertarget{selecionar}{%
\subsection{Selecionar}\label{selecionar}}

Para selecionar colunas, utilizamos a função \texttt{select()}, tendo como primeiro argumento a base de dados utilizada, sendo os demais argumentos referentes aos nomes das colunas que se deseja selecionar.

Nos dois exemplos a seguir, perceba que podemos selecionar uma ou mais de uma coluna.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando somente a coluna "Item"}
\FunctionTok{select}\NormalTok{(graos,}
\NormalTok{       Item)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 1
   Item 
   <chr>
 1 Maize
 2 Maize
 3 Maize
 4 Maize
 5 Maize
 6 Maize
 7 Maize
 8 Maize
 9 Maize
10 Maize
# ... with 5,500 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando mais de uma coluna}
\FunctionTok{select}\NormalTok{(graos,}
\NormalTok{       Area, Item, Value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 3
   Area      Item    Value
   <chr>     <chr>   <dbl>
 1 Argentina Maize 2744400
 2 Argentina Maize 2756670
 3 Argentina Maize 2645400
 4 Argentina Maize 2970500
 5 Argentina Maize 3062300
 6 Argentina Maize 3274500
 7 Argentina Maize 3450500
 8 Argentina Maize 3377700
 9 Argentina Maize 3556000
10 Argentina Maize 4017330
# ... with 5,500 more rows
\end{verbatim}

Podemos selecionar várias colunas consecutivas com o operador \texttt{:}. Basta informar os nomes ou as posições da primeira e da última coluna que se deseja selecionar.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando colunas consecutivas a partir dos nomes}
\FunctionTok{select}\NormalTok{(graos,}
\NormalTok{       Area}\SpecialCharTok{:}\NormalTok{Year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 7
   Area      `Element Code` Element     `Item Code (FA~` Item  `Year Code`  Year
   <chr>              <dbl> <chr>                  <dbl> <chr>       <dbl> <dbl>
 1 Argentina           5312 Area harve~               56 Maize        1961  1961
 2 Argentina           5312 Area harve~               56 Maize        1962  1962
 3 Argentina           5312 Area harve~               56 Maize        1963  1963
 4 Argentina           5312 Area harve~               56 Maize        1964  1964
 5 Argentina           5312 Area harve~               56 Maize        1965  1965
 6 Argentina           5312 Area harve~               56 Maize        1966  1966
 7 Argentina           5312 Area harve~               56 Maize        1967  1967
 8 Argentina           5312 Area harve~               56 Maize        1968  1968
 9 Argentina           5312 Area harve~               56 Maize        1969  1969
10 Argentina           5312 Area harve~               56 Maize        1970  1970
# ... with 5,500 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando colunas consecutivas a partir das posições}
\FunctionTok{select}\NormalTok{(graos, }\DecValTok{4}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 7
   Area      `Element Code` Element     `Item Code (FA~` Item  `Year Code`  Year
   <chr>              <dbl> <chr>                  <dbl> <chr>       <dbl> <dbl>
 1 Argentina           5312 Area harve~               56 Maize        1961  1961
 2 Argentina           5312 Area harve~               56 Maize        1962  1962
 3 Argentina           5312 Area harve~               56 Maize        1963  1963
 4 Argentina           5312 Area harve~               56 Maize        1964  1964
 5 Argentina           5312 Area harve~               56 Maize        1965  1965
 6 Argentina           5312 Area harve~               56 Maize        1966  1966
 7 Argentina           5312 Area harve~               56 Maize        1967  1967
 8 Argentina           5312 Area harve~               56 Maize        1968  1968
 9 Argentina           5312 Area harve~               56 Maize        1969  1969
10 Argentina           5312 Area harve~               56 Maize        1970  1970
# ... with 5,500 more rows
\end{verbatim}

A função \texttt{select()} possui outras funções que auxiliam na seleção de colunas, sendo elas:

\begin{itemize}
\item
  \texttt{starts\_with()}: seleciona colunas que começam com um texto padrão;
\item
  \texttt{ends\_with()}: seleciona colunas que terminam com um texto padrão;
\item
  \texttt{contains()}: seleciona colunas que possuem um texto padrão.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# starts\_with() {-} Começa com tal palavra}
\FunctionTok{select}\NormalTok{(graos, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"Year"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 2
   `Year Code`  Year
         <dbl> <dbl>
 1        1961  1961
 2        1962  1962
 3        1963  1963
 4        1964  1964
 5        1965  1965
 6        1966  1966
 7        1967  1967
 8        1968  1968
 9        1969  1969
10        1970  1970
# ... with 5,500 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ends\_with() {-} Termina com tal palavra}
\FunctionTok{select}\NormalTok{(graos, }\FunctionTok{ends\_with}\NormalTok{(}\StringTok{"Code"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 3
   `Domain Code` `Element Code` `Year Code`
   <chr>                  <dbl>       <dbl>
 1 QCL                     5312        1961
 2 QCL                     5312        1962
 3 QCL                     5312        1963
 4 QCL                     5312        1964
 5 QCL                     5312        1965
 6 QCL                     5312        1966
 7 QCL                     5312        1967
 8 QCL                     5312        1968
 9 QCL                     5312        1969
10 QCL                     5312        1970
# ... with 5,500 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# contains() {-} Contém tal palavra}
\FunctionTok{select}\NormalTok{(graos, }\FunctionTok{contains}\NormalTok{(}\StringTok{"FAO"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 2
   `Area Code (FAO)` `Item Code (FAO)`
               <dbl>             <dbl>
 1                 9                56
 2                 9                56
 3                 9                56
 4                 9                56
 5                 9                56
 6                 9                56
 7                 9                56
 8                 9                56
 9                 9                56
10                 9                56
# ... with 5,500 more rows
\end{verbatim}

Também podemos retirar uma coluna inserindo um sinal de menos (\texttt{-}) antes do nome da variável ou das funções auxiliares.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nome das colunas do banco de dados bruto:}
\FunctionTok{names}\NormalTok{(graos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "Domain Code"      "Domain"           "Area Code (FAO)"  "Area"            
 [5] "Element Code"     "Element"          "Item Code (FAO)"  "Item"            
 [9] "Year Code"        "Year"             "Unit"             "Value"           
[13] "Flag"             "Flag Description"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Dados sem as respectivas colunas:}
\FunctionTok{select}\NormalTok{(graos,}
       \SpecialCharTok{{-}}\FunctionTok{contains}\NormalTok{(}\StringTok{"Code"}\NormalTok{), }\SpecialCharTok{{-}}\FunctionTok{contains}\NormalTok{(}\StringTok{"Flag"}\NormalTok{), }\SpecialCharTok{{-}}\NormalTok{Domain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 6
   Area      Element        Item   Year Unit    Value
   <chr>     <chr>          <chr> <dbl> <chr>   <dbl>
 1 Argentina Area harvested Maize  1961 ha    2744400
 2 Argentina Area harvested Maize  1962 ha    2756670
 3 Argentina Area harvested Maize  1963 ha    2645400
 4 Argentina Area harvested Maize  1964 ha    2970500
 5 Argentina Area harvested Maize  1965 ha    3062300
 6 Argentina Area harvested Maize  1966 ha    3274500
 7 Argentina Area harvested Maize  1967 ha    3450500
 8 Argentina Area harvested Maize  1968 ha    3377700
 9 Argentina Area harvested Maize  1969 ha    3556000
10 Argentina Area harvested Maize  1970 ha    4017330
# ... with 5,500 more rows
\end{verbatim}

Por último, temos a função \texttt{everything()}, utilizada na função \texttt{select()} para arrastar determinadas colunas para o início da base de dados.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(graos, }
\NormalTok{       Value, Unit, }\FunctionTok{everything}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 14
     Value Unit  `Domain Code` Domain      `Area Code (FA~` Area  `Element Code`
     <dbl> <chr> <chr>         <chr>                  <dbl> <chr>          <dbl>
 1 2744400 ha    QCL           Crops and ~                9 Arge~           5312
 2 2756670 ha    QCL           Crops and ~                9 Arge~           5312
 3 2645400 ha    QCL           Crops and ~                9 Arge~           5312
 4 2970500 ha    QCL           Crops and ~                9 Arge~           5312
 5 3062300 ha    QCL           Crops and ~                9 Arge~           5312
 6 3274500 ha    QCL           Crops and ~                9 Arge~           5312
 7 3450500 ha    QCL           Crops and ~                9 Arge~           5312
 8 3377700 ha    QCL           Crops and ~                9 Arge~           5312
 9 3556000 ha    QCL           Crops and ~                9 Arge~           5312
10 4017330 ha    QCL           Crops and ~                9 Arge~           5312
# ... with 5,500 more rows, and 7 more variables: Element <chr>,
#   `Item Code (FAO)` <dbl>, Item <chr>, `Year Code` <dbl>, Year <dbl>,
#   Flag <chr>, `Flag Description` <chr>
\end{verbatim}

\hypertarget{operador-pipe}{%
\subsection{\texorpdfstring{Operador \emph{pipe} (\%\textgreater\%)}{Operador pipe (\%\textgreater\%)}}\label{operador-pipe}}

Na maior parte dos casos, utilizaremos mais de uma função para manipular os nossos dados. Com isso, entra em cena o \emph{pipe} (\texttt{\%\textgreater{}\%}). O \emph{pipe} está presente no pacote \texttt{magrittr}, que está contido no \texttt{tidyverse}. Portanto, antes de aprofundarmos na ideia central do \emph{pipe}, devemos carregar o pacote \texttt{magrittr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(magrittr)}
\end{Highlighting}
\end{Shaded}

A principal função do \emph{pipe} é conectar linhas de códigos que se relacionam, executando-as em sequência, de uma só vez. A essa estrutura de código chamamos de \emph{pipelines}. Como exemplo hipotético, calcularemos a média final de um aluno na disciplina de cálculo II, arredondando-a com uma casa decimal.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notas }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{8.88}\NormalTok{, }\FloatTok{6.84}\NormalTok{, }\FloatTok{7.51}\NormalTok{)}

\CommentTok{\# Sem pipe}
\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(notas),}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7.7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Com pipe}
\NormalTok{notas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mean}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7.7
\end{verbatim}

Utilizando o \emph{pipe}, evitamos de escrever funções dentro de funções, ordenando-as de acordo com a ordem em que desejamos realizar as operações. No exemplo, calculamos primeiro a média das notas e, posteriormente, arrendondamos.

Quando utilizamos o \emph{pipe}, obtemos um código mais legível, claro e compacto, principalmente quando trabalhamos com diversas funções. Isso facilita não somente a leitura, mas também na manutenção do código, caso seja preciso realizar alterações ou consertar possíveis problemas.

Tendo essa noção básica do que é o \emph{pipe}, começaremos a aplicá-lo na manipulação dos dados. Caso queira saber mais sobre o \emph{pipe}, confira o capítulo 18 do livro \href{https://r4ds.had.co.nz/pipes.html}{\emph{R for Data Science}}.

\hypertarget{filtrar}{%
\subsection{Filtrar}\label{filtrar}}

Podemos filtrar determinados valores que estão contidos nas linhas de cada coluna, sejam eles quantitativos ou categóricos. Para isso, utilizamos testes lógicos dentro da função \texttt{filter()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(graos,}
\NormalTok{       Area }\SpecialCharTok{==} \StringTok{"Chile"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 459 x 14
   `Domain Code` Domain            `Area Code (FA~` Area  `Element Code` Element
   <chr>         <chr>                        <dbl> <chr>          <dbl> <chr>  
 1 QCL           Crops and livest~               40 Chile           5312 Area h~
 2 QCL           Crops and livest~               40 Chile           5312 Area h~
 3 QCL           Crops and livest~               40 Chile           5312 Area h~
 4 QCL           Crops and livest~               40 Chile           5312 Area h~
 5 QCL           Crops and livest~               40 Chile           5312 Area h~
 6 QCL           Crops and livest~               40 Chile           5312 Area h~
 7 QCL           Crops and livest~               40 Chile           5312 Area h~
 8 QCL           Crops and livest~               40 Chile           5312 Area h~
 9 QCL           Crops and livest~               40 Chile           5312 Area h~
10 QCL           Crops and livest~               40 Chile           5312 Area h~
# ... with 449 more rows, and 8 more variables: `Item Code (FAO)` <dbl>,
#   Item <chr>, `Year Code` <dbl>, Year <dbl>, Unit <chr>, Value <dbl>,
#   Flag <chr>, `Flag Description` <chr>
\end{verbatim}

No exemplo anterior, filtramos a coluna \texttt{Area} para que nos retornasse somente as observações referentes ao país \texttt{Chile}. Para isso, utilizamos o teste lógico \texttt{==}, ou seja, pedimos para que nos retornasse somente as observações que apresentem o valor igual a \texttt{Chile} na coluna \texttt{Area}.

Lembre que a função \texttt{filter()} segue a lógica demontrada na seção \ref{logica}. Mas perceba que, diferentemente do que fora exposto na referente seção, a \texttt{filter()} é muito mais simples e intuitiva de ser utilizada.

Também podemos selecionar um conjunto de valores contidos em uma coluna. Para isso, criamos um vetor com os valores desejados e aplicamos o teste \texttt{\%in\%}, ou seja, dentro da coluna \texttt{Area}, pedimos para que nos retorne somente os valores que estão contidos no vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{conjunto\_paises }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(graos,}
\NormalTok{                          Area }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Brazil"}\NormalTok{, }\StringTok{"Argentina"}\NormalTok{, }\StringTok{"Chile"}\NormalTok{))}

\FunctionTok{unique}\NormalTok{(conjunto\_paises}\SpecialCharTok{$}\NormalTok{Area)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Argentina" "Brazil"    "Chile"    
\end{verbatim}

A função \texttt{unique()} comprova a seleção dos respectivos países filtrados, nos retornando todos os valores únicos contidos na coluna \texttt{Area} após a utilização do filtro.

Por outro lado, podemos retirar valores com o operador \texttt{!}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{retirando\_paises }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(graos,}
                           \SpecialCharTok{!}\NormalTok{(Area }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Brazil"}\NormalTok{, }\StringTok{"Argentina"}\NormalTok{, }\StringTok{"Chile"}\NormalTok{)))}

\FunctionTok{unique}\NormalTok{(retirando\_paises}\SpecialCharTok{$}\NormalTok{Area)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "Bolivia (Plurinational State of)"   "Colombia"                          
 [3] "Ecuador"                            "French Guyana"                     
 [5] "Guyana"                             "Paraguay"                          
 [7] "Peru"                               "Suriname"                          
 [9] "Uruguay"                            "Venezuela (Bolivarian Republic of)"
\end{verbatim}

Da mesma forma, podemos aplicar os filtros para variáveis quantitativas. Note no exemplo a seguir que aplicamos 3 filtros. O primeiro referente à variável categórica \texttt{Element}, sendo os outros dois, às variáveis quantitativas \texttt{Year} e \texttt{Value}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(graos,}
\NormalTok{       Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{       Year }\SpecialCharTok{\textgreater{}} \DecValTok{2010}\NormalTok{,}
\NormalTok{       Value }\SpecialCharTok{\textgreater{}} \DecValTok{10}\SpecialCharTok{\^{}}\DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 54 x 14
   `Domain Code` Domain            `Area Code (FA~` Area  `Element Code` Element
   <chr>         <chr>                        <dbl> <chr>          <dbl> <chr>  
 1 QCL           Crops and livest~                9 Arge~           5510 Produc~
 2 QCL           Crops and livest~                9 Arge~           5510 Produc~
 3 QCL           Crops and livest~                9 Arge~           5510 Produc~
 4 QCL           Crops and livest~                9 Arge~           5510 Produc~
 5 QCL           Crops and livest~                9 Arge~           5510 Produc~
 6 QCL           Crops and livest~                9 Arge~           5510 Produc~
 7 QCL           Crops and livest~                9 Arge~           5510 Produc~
 8 QCL           Crops and livest~                9 Arge~           5510 Produc~
 9 QCL           Crops and livest~                9 Arge~           5510 Produc~
10 QCL           Crops and livest~                9 Arge~           5510 Produc~
# ... with 44 more rows, and 8 more variables: `Item Code (FAO)` <dbl>,
#   Item <chr>, `Year Code` <dbl>, Year <dbl>, Unit <chr>, Value <dbl>,
#   Flag <chr>, `Flag Description` <chr>
\end{verbatim}

Para melhorar a organização e a apresentação da base de dados, podemos aplicar as funções \texttt{filter()} e \texttt{select()} juntas. Para tanto, utilizaremos o \emph{pipe} para mesclar ambas as funções em uma \emph{pipeline}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Area }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Brazil"}\NormalTok{, }\StringTok{"Argentina"}\NormalTok{),}
\NormalTok{         Year }\SpecialCharTok{\textgreater{}} \DecValTok{2010}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Element, Item, Year, Unit, Value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 72 x 6
   Area      Element    Item         Year Unit      Value
   <chr>     <chr>      <chr>       <dbl> <chr>     <dbl>
 1 Argentina Production Maize        2011 tonnes 23799830
 2 Argentina Production Maize        2012 tonnes 21196637
 3 Argentina Production Maize        2013 tonnes 32119211
 4 Argentina Production Maize        2014 tonnes 33087165
 5 Argentina Production Maize        2015 tonnes 33817744
 6 Argentina Production Maize        2016 tonnes 39792854
 7 Argentina Production Maize        2017 tonnes 49475895
 8 Argentina Production Maize        2018 tonnes 43462323
 9 Argentina Production Maize        2019 tonnes 56860704
10 Argentina Production Rice, paddy  2011 tonnes  1748075
# ... with 62 more rows
\end{verbatim}

Perceba que a aplicação do \emph{pipe} é bem simples e intuitiva. Primeiramente, indicamos a base de dados a ser utilizada para realizar a filtragem e seleção - no caso, a base \texttt{graos}. Em seguida, escrevemos o \texttt{\%\textgreater{}\%} para conectar o banco de dados com a função \texttt{filter()}; nesse caso, filtramos apenas os valores iguais a \texttt{"Production"} na coluna \texttt{Element}, os países \texttt{Brazil} e \texttt{Argentina} na variável \texttt{Area} e os anos maiores que 2010. Novamente, escrevemos o \texttt{\%\textgreater{}\%} para aplicar a \texttt{select()} e selecionar as variáveis desejadas.

Note que não foi preciso indicar, como primeiro argumento das funções, qual a base de dados utilizada, pois essa foi especificada na primeira parte da \emph{pipeline}. Além disso, a execução do código é realizada na ordem em que são escritos os comandos. Assim, caso desejarmos filtrar uma coluna e, posteriomente, retirá-la da seleção, devemos nos atentar à ordem dos comandos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Area }\SpecialCharTok{==} \StringTok{"Brazil"}\NormalTok{,}
\NormalTok{         Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Year }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{2015}\SpecialCharTok{:}\DecValTok{2019}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Item, Year, Value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 20 x 3
   Item         Year     Value
   <chr>       <dbl>     <dbl>
 1 Maize        2015  85283074
 2 Maize        2016  64188314
 3 Maize        2017  97910658
 4 Maize        2018  82366531
 5 Maize        2019 101138617
 6 Rice, paddy  2015  12301201
 7 Rice, paddy  2016  10622189
 8 Rice, paddy  2017  12464766
 9 Rice, paddy  2018  11808412
10 Rice, paddy  2019  10368611
11 Soybeans     2015  97464936
12 Soybeans     2016  96394820
13 Soybeans     2017 114732101
14 Soybeans     2018 117912450
15 Soybeans     2019 114269392
16 Wheat        2015   5508451
17 Wheat        2016   6834421
18 Wheat        2017   4342812
19 Wheat        2018   5469236
20 Wheat        2019   5604158
\end{verbatim}

No exemplo acima, perceba que filtramos as colunas \texttt{Area} e \texttt{Element}, mas não às selecionamos posteriormente. Caso fosse realizada a seleção antes da filtragem, não seria possível filtrar as devidas variáveis, uma vez que não selecionamos suas colunas para, posteriormente, serem filtradas.

\hypertarget{modificar-e-criar-colunas}{%
\subsection{Modificar e criar colunas}\label{modificar-e-criar-colunas}}

Para modificar ou criar novas colunas, utilizamos a função \texttt{mutate()}. No exemplo a seguir, transformaremos os valores de produção, em toneladas, para quilogramas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Element, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Value =}\NormalTok{ Value}\SpecialCharTok{*}\DecValTok{1000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,756 x 5
   Area      Element    Item   Year      Value
   <chr>     <chr>      <chr> <dbl>      <dbl>
 1 Argentina Production Maize  1961 4850000000
 2 Argentina Production Maize  1962 5220000000
 3 Argentina Production Maize  1963 4360000000
 4 Argentina Production Maize  1964 5350000000
 5 Argentina Production Maize  1965 5140000000
 6 Argentina Production Maize  1966 7040000000
 7 Argentina Production Maize  1967 8510000000
 8 Argentina Production Maize  1968 6560000000
 9 Argentina Production Maize  1969 6860000000
10 Argentina Production Maize  1970 9360000000
# ... with 2,746 more rows
\end{verbatim}

No código acima, transformamos os valores da coluna \texttt{Value}. Contudo, também podemos manter a coluna original e criar uma nova coluna com a variável calculada. Basta designar um novo nome à coluna, nesse caso, criamos a \texttt{Value(kg)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Element, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Value\_kg =}\NormalTok{ Value}\SpecialCharTok{*}\DecValTok{1000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,756 x 6
   Area      Element    Item   Year   Value   Value_kg
   <chr>     <chr>      <chr> <dbl>   <dbl>      <dbl>
 1 Argentina Production Maize  1961 4850000 4850000000
 2 Argentina Production Maize  1962 5220000 5220000000
 3 Argentina Production Maize  1963 4360000 4360000000
 4 Argentina Production Maize  1964 5350000 5350000000
 5 Argentina Production Maize  1965 5140000 5140000000
 6 Argentina Production Maize  1966 7040000 7040000000
 7 Argentina Production Maize  1967 8510000 8510000000
 8 Argentina Production Maize  1968 6560000 6560000000
 9 Argentina Production Maize  1969 6860000 6860000000
10 Argentina Production Maize  1970 9360000 9360000000
# ... with 2,746 more rows
\end{verbatim}

Podemos realizar qualquer operação com a quantidade de colunas que desejarmos. Porém, deve ser retornado um vetor com comprimento igual à quantidade de linhas da base de dados ou com comprimento igual a 1, sendo assim realizado o processo de reciclagem do valor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Element, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Value =}\NormalTok{ Value}\SpecialCharTok{*}\DecValTok{1000}\NormalTok{,}
         \AttributeTok{Unit =} \StringTok{"kg"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,756 x 6
   Area      Element    Item   Year      Value Unit 
   <chr>     <chr>      <chr> <dbl>      <dbl> <chr>
 1 Argentina Production Maize  1961 4850000000 kg   
 2 Argentina Production Maize  1962 5220000000 kg   
 3 Argentina Production Maize  1963 4360000000 kg   
 4 Argentina Production Maize  1964 5350000000 kg   
 5 Argentina Production Maize  1965 5140000000 kg   
 6 Argentina Production Maize  1966 7040000000 kg   
 7 Argentina Production Maize  1967 8510000000 kg   
 8 Argentina Production Maize  1968 6560000000 kg   
 9 Argentina Production Maize  1969 6860000000 kg   
10 Argentina Production Maize  1970 9360000000 kg   
# ... with 2,746 more rows
\end{verbatim}

\hypertarget{resumo-de-valores}{%
\subsection{Resumo de valores}\label{resumo-de-valores}}

O processo de sumarizar consiste em resumir um conjunto de dados a partir de uma medida de interesse. Como exemplo, podemos tirar a média, mediana, frequência e proporção dos valores desejados. Para isso, utilizamos a função \texttt{summarise()}. A seguir, faremos a média da produção de milho no Brasil.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Area }\SpecialCharTok{==} \StringTok{"Brazil"}\NormalTok{,}
\NormalTok{         Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Item }\SpecialCharTok{==} \StringTok{"Maize"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(Value, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1 x 1
      media
      <dbl>
1 33776948.
\end{verbatim}

Podemos calcular várias medidas diferentes na função \texttt{summarise()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Area }\SpecialCharTok{==} \StringTok{"Brazil"}\NormalTok{,}
\NormalTok{         Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Item }\SpecialCharTok{==} \StringTok{"Maize"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(Value),}
            \AttributeTok{mediana =} \FunctionTok{median}\NormalTok{(Value),}
            \AttributeTok{variancia =} \FunctionTok{var}\NormalTok{(Value))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1 x 3
      media  mediana variancia
      <dbl>    <dbl>     <dbl>
1 33776948. 26589870   5.61e14
\end{verbatim}

Há casos em que queremos sumarizar uma coluna de acordo com alguma variável categórica de uma outra coluna. Para isso, utilizamos a função \texttt{group\_by()} para indicar qual coluna desejamos agrupar para realizar a \texttt{summarise()}. No exemplo a seguir, agruparemos a variável \texttt{Element} para calcular a média da produção (\texttt{Production}) e da área colhida (\texttt{Area\ harvested}) de soja, na América do Sul.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Item }\SpecialCharTok{==} \StringTok{"Soybeans"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(Element) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(Value, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 2
  Element           media
  <chr>             <dbl>
1 Area harvested 2132705.
2 Production     5335899.
\end{verbatim}

Podemos agrupar mais de duas variáveis para sumarizar. A seguir, agruparemos as colunas \texttt{Area} e \texttt{Element} para calcular, novamente, a média da produção e da área colhida, mas agora, por país sul-americano.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Item }\SpecialCharTok{==} \StringTok{"Soybeans"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Area, Element) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(Value, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 26 x 3
# Groups:   Area [13]
   Area                             Element            media
   <chr>                            <chr>              <dbl>
 1 Argentina                        Area harvested  6967484.
 2 Argentina                        Production     17941231.
 3 Bolivia (Plurinational State of) Area harvested   472537.
 4 Bolivia (Plurinational State of) Production       922200.
 5 Brazil                           Area harvested 12772243.
 6 Brazil                           Production     32075459.
 7 Chile                            Area harvested      984 
 8 Chile                            Production         1043.
 9 Colombia                         Area harvested    45942.
10 Colombia                         Production        93380.
# ... with 16 more rows
\end{verbatim}

\hypertarget{ordenar}{%
\subsection{Ordenar}\label{ordenar}}

Podemos ordenar as linhas da base de dados de acordo com algum parâmetro referente aos valores de uma ou mais colunas. Para tanto, utilizamos a função \texttt{arrange()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(Value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,756 x 4
   Area          Item      Year Value
   <chr>         <chr>    <dbl> <dbl>
 1 Chile         Soybeans  1988     0
 2 Chile         Soybeans  1990     0
 3 Chile         Soybeans  1991     0
 4 Chile         Soybeans  1992     0
 5 French Guyana Maize     1990     0
 6 French Guyana Soybeans  1990     0
 7 French Guyana Soybeans  1991     0
 8 French Guyana Soybeans  1992     0
 9 Guyana        Soybeans  1990     0
10 Guyana        Soybeans  1991     0
# ... with 2,746 more rows
\end{verbatim}

Por padrão, a função \texttt{arrange()} ordena os valores em ordem crescente. Para ordená-las em ordem decrescente, utilizamos a função \texttt{desc()} dentro da própria \texttt{arrange()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Item, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Value))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,756 x 4
   Area   Item      Year     Value
   <chr>  <chr>    <dbl>     <dbl>
 1 Brazil Soybeans  2018 117912450
 2 Brazil Soybeans  2017 114732101
 3 Brazil Soybeans  2019 114269392
 4 Brazil Maize     2019 101138617
 5 Brazil Maize     2017  97910658
 6 Brazil Soybeans  2015  97464936
 7 Brazil Soybeans  2016  96394820
 8 Brazil Soybeans  2014  86760520
 9 Brazil Maize     2015  85283074
10 Brazil Maize     2018  82366531
# ... with 2,746 more rows
\end{verbatim}

Além disso, podemos ordenar a base de dados de acordo com duas variáveis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Item }\SpecialCharTok{==} \StringTok{"Rice, paddy"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(Year, }\FunctionTok{desc}\NormalTok{(Value))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 754 x 3
   Area                                Year   Value
   <chr>                              <dbl>   <dbl>
 1 Brazil                              1961 5392477
 2 Colombia                            1961  473600
 3 Peru                                1961  331877
 4 Guyana                              1961  215103
 5 Ecuador                             1961  203000
 6 Argentina                           1961  149000
 7 Chile                               1961  104720
 8 Venezuela (Bolivarian Republic of)  1961   80658
 9 Suriname                            1961   71562
10 Uruguay                             1961   60866
# ... with 744 more rows
\end{verbatim}

Perceba que a ordem da declaração das variáveis na função \texttt{arrange()} altera a prioridade da ordenação.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Element }\SpecialCharTok{==} \StringTok{"Production"}\NormalTok{,}
\NormalTok{         Item }\SpecialCharTok{==} \StringTok{"Rice, paddy"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Year, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Value), Year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 754 x 3
   Area    Year    Value
   <chr>  <dbl>    <dbl>
 1 Brazil  2011 13476994
 2 Brazil  2004 13277008
 3 Brazil  2005 13192863
 4 Brazil  2009 12651144
 5 Brazil  2017 12464766
 6 Brazil  2015 12301201
 7 Brazil  2014 12175602
 8 Brazil  2008 12061465
 9 Brazil  2018 11808412
10 Brazil  1988 11806450
# ... with 744 more rows
\end{verbatim}

Nesse último exemplo, priorizamos a ordenação pelos valores de produção, em quanto que no outro, ordenamos a base a partir dos anos e, posteriormente, dos valores de produção.

\hypertarget{mudar-nomes-de-colunas}{%
\subsection{Mudar nomes de colunas}\label{mudar-nomes-de-colunas}}

Podemos alterar os nomes das colunas com a função \texttt{rename()}. Basta inserir o nome desejado e indicar, após o sinal de \texttt{=}, qual coluna da base de dados se deseja alterar o nome.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{graos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Area, Element, Item, Year, Unit, Value) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rename}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{país}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ Area, }\AttributeTok{tipo =}\NormalTok{ Element, }\AttributeTok{cultura =}\NormalTok{ Item, }\AttributeTok{ano =}\NormalTok{ Year, }
         \AttributeTok{unidade =}\NormalTok{ Unit, }\AttributeTok{valor =}\NormalTok{ Value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 5,510 x 6
   país      tipo           cultura   ano unidade   valor
   <chr>     <chr>          <chr>   <dbl> <chr>     <dbl>
 1 Argentina Area harvested Maize    1961 ha      2744400
 2 Argentina Area harvested Maize    1962 ha      2756670
 3 Argentina Area harvested Maize    1963 ha      2645400
 4 Argentina Area harvested Maize    1964 ha      2970500
 5 Argentina Area harvested Maize    1965 ha      3062300
 6 Argentina Area harvested Maize    1966 ha      3274500
 7 Argentina Area harvested Maize    1967 ha      3450500
 8 Argentina Area harvested Maize    1968 ha      3377700
 9 Argentina Area harvested Maize    1969 ha      3556000
10 Argentina Area harvested Maize    1970 ha      4017330
# ... with 5,500 more rows
\end{verbatim}

\hypertarget{juntar-bases-de-dados}{%
\subsection{Juntar bases de dados}\label{juntar-bases-de-dados}}

Em alguns casos, precisamos utilizar informações presentes em diferentes bases de dados, como por exemplo em planilhas Excel distintas ou em diferentes abas de uma mesma planilha. Nesse caso, é necessário juntar todas as informações em um único \emph{data frame}.

Para isso, podemos utilizar algumas funções presentes no pacote \texttt{dplyr}. A seguir, apresentaremos as funções do tipo \texttt{bind\_} e \texttt{\_join}, usando como exemplo a planilha \texttt{dados\_juntar.xlsx}, presente no mesmo \emph{link} para \emph{download} apresentado no início desse capítulo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{excel\_sheets}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "dados1" "dados2" "dados3" "dados4" "dados5"
\end{verbatim}

Com a função \texttt{readxl::excel\_sheets()}, verificamos que a planilha contém 5 abas. Essas abas tratam de um mesmo tema, as quais precisaremos juntar em um único \emph{data frame}. Assim, devemos salvar cada aba da planilha em um objeto.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d1 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"dados1"}\NormalTok{)}

\NormalTok{d2 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"dados2"}\NormalTok{)}

\NormalTok{d3 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"dados3"}\NormalTok{)}

\NormalTok{d4 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"dados4"}\NormalTok{)}

\NormalTok{d5 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_transf/dados\_juntar.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"dados5"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{funuxe7uxf5es-bind_}{%
\subsubsection*{\texorpdfstring{Funções \texttt{bind\_}}{Funções bind\_}}\label{funuxe7uxf5es-bind_}}
\addcontentsline{toc}{subsubsection}{Funções \texttt{bind\_}}

As funções do tipo \texttt{bind\_} são as mais simples para juntarmos os bancos de dados. A função \texttt{bind\_rows()} junta as observações (linhas) de dois ou mais bancos de dados com base nas colunas. Com essa função, podemos realizar a união dos \emph{data frames} \texttt{d1}, \texttt{d2}, \texttt{d3} e \texttt{d4}, que possuem as mesmas variáveis (colunas), porém tratando de diferentes observações.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 4
  nome   sexo  idade  peso
  <chr>  <chr> <dbl> <dbl>
1 Amanda F        25    63
2 Maria  F        30    65
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Vitor   M        24    73
2 Leticia F        23    52
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 4
  sexo  nome     peso idade
  <chr> <chr>   <dbl> <dbl>
1 F     Vitoria    51    21
2 M     Marcos     68    18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 4
  nomes sexo  idade  peso
  <chr> <chr> <dbl> <dbl>
1 Julio M        25    72
2 Fabio M        35    81
\end{verbatim}

Primeiramente, uniremos as bases \texttt{d1} e \texttt{d2}. Dentro da função \texttt{bind\_rows()} declaramos os \emph{data frames} que desejamos juntar, separados por vírgula.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.linhas.d1.d2 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(d1, d2)}
\NormalTok{juntar.linhas.d1.d2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Vitor   M        24    73
4 Leticia F        23    52
\end{verbatim}

Uma vez unidos os dados de \texttt{d1} e \texttt{d2}, juntaremos com o \texttt{d3}. Porém, note que as colunas da base \texttt{d3} apresentam uma ordem diferente em relação ao \texttt{d1} e ao \texttt{d2}. Mesmo com a ordem diferente, a função consegue combinar as linhas de maneira adequada, desde que os nomes das colunas dos bancos de dados sejam iguais.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.linhas.d1.d2.d3 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(juntar.linhas.d1.d2, d3)}
\NormalTok{juntar.linhas.d1.d2.d3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Vitor   M        24    73
4 Leticia F        23    52
5 Vitoria F        21    51
6 Marcos  M        18    68
\end{verbatim}

A função \texttt{bind\_rows()} consegue juntar mais de dois bancos de dados em um só comando. Basta declararmos as bases que desejamos juntar.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Juntando d1, d2 e d3 em um só comando}
\NormalTok{juntar.linhas.direto }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(d1, d2, d3)}
\NormalTok{juntar.linhas.direto}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Vitor   M        24    73
4 Leticia F        23    52
5 Vitoria F        21    51
6 Marcos  M        18    68
\end{verbatim}

Por último, precisamos unir o \texttt{d4} aos demais dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.linhas.d1.d2.d3.d4 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(d1, d2, d3, d4)}
\NormalTok{juntar.linhas.d1.d2.d3.d4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 5
  nome    sexo  idade  peso nomes
  <chr>   <chr> <dbl> <dbl> <chr>
1 Amanda  F        25    63 <NA> 
2 Maria   F        30    65 <NA> 
3 Vitor   M        24    73 <NA> 
4 Leticia F        23    52 <NA> 
5 Vitoria F        21    51 <NA> 
6 Marcos  M        18    68 <NA> 
7 <NA>    M        25    72 Julio
8 <NA>    M        35    81 Fabio
\end{verbatim}

Juntando a base de dados \texttt{d4} ao \texttt{d1}, \texttt{d2} e \texttt{d3}, percebemos que foi criada uma nova coluna. Isso ocorre, pois a nomenclatura atribuída à variável \texttt{nome} no \texttt{d4} está no plural, sendo assim, precisamos padronizar o nome dessa variável antes de juntá-la às demais bases.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d4\_corrigido }\OtherTok{\textless{}{-}}\NormalTok{ d4 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rename}\NormalTok{(}\StringTok{"nome"} \OtherTok{=}\NormalTok{ nomes)}

\FunctionTok{names}\NormalTok{(d4\_corrigido)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "nome"  "sexo"  "idade" "peso" 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.linhas }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(d1, d2, d3, d4\_corrigido)}
\NormalTok{juntar.linhas}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Vitor   M        24    73
4 Leticia F        23    52
5 Vitoria F        21    51
6 Marcos  M        18    68
7 Julio   M        25    72
8 Fabio   M        35    81
\end{verbatim}

Com a função \texttt{rename()}, renomeamos a coluna \texttt{nomes} para o singular (\texttt{nome}). Assim, ao realizar a junção dos quatro bancos de dados, os nomes são alocados em uma única coluna (\texttt{nome}).

Já a função \texttt{bind\_cols()} une colunas de dois ou mais bancos de dados. A seguir, juntaremos as colunas das bases \texttt{juntar.linhas} e \texttt{d5}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.linhas}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Vitor   M        24    73
4 Leticia F        23    52
5 Vitoria F        21    51
6 Marcos  M        18    68
7 Julio   M        25    72
8 Fabio   M        35    81
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 2
  nome      profissao  
  <chr>     <chr>      
1 Fabio     Medico     
2 Gabriel   Estudante  
3 Guilherme Cozinheiro 
4 Jose      Biologo    
5 Julio     Zootecnista
6 Marcos    Professor  
7 Vitor     Agronomo   
8 Getulio   Musico     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{juntar.colunas }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(juntar.linhas, d5)}
\NormalTok{juntar.colunas}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 6
  nome...1 sexo  idade  peso nome...5  profissao  
  <chr>    <chr> <dbl> <dbl> <chr>     <chr>      
1 Amanda   F        25    63 Fabio     Medico     
2 Maria    F        30    65 Gabriel   Estudante  
3 Vitor    M        24    73 Guilherme Cozinheiro 
4 Leticia  F        23    52 Jose      Biologo    
5 Vitoria  F        21    51 Julio     Zootecnista
6 Marcos   M        18    68 Marcos    Professor  
7 Julio    M        25    72 Vitor     Agronomo   
8 Fabio    M        35    81 Getulio   Musico     
\end{verbatim}

Note que a função juntou as colunas, preservando todas as variáveis, bem como a ordem original das linhas das bases de dados. Porém, nesse caso, seria conveniente unir as colunas com base na variável em comum entre os conjuntos, no caso, a variável \texttt{nome}. Para isso, utilizamos um outro conjunto de funções, as do tipo \texttt{\_join}.

\hypertarget{funuxe7uxf5es-_join}{%
\subsubsection*{\texorpdfstring{Funções \texttt{\_join}}{Funções \_join}}\label{funuxe7uxf5es-_join}}
\addcontentsline{toc}{subsubsection}{Funções \texttt{\_join}}

Para juntar dois conjuntos de dados com base em uma ou mais colunas em comum, utilizamos as funções do tipo \texttt{\_join} (conhecidas também por \emph{merge}). Você deve ter notado que a base \texttt{d5} possui indivíduos em comum com a base \texttt{juntar.linhas}; mas também, diferentes.

Nesse caso, de acordo com o que se deseja para a análise, podemos selecionar todas as observações dos conjuntos; apenas as observações exclusivas de um dos conjuntos de dados; ou aquelas que estão presentes em ambas as bases de dados. A figura \ref{fig:join} ilustra tais possibilidades e as respectivas funções.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/join-venn} 

}

\caption{Diagrama de Venn com os tipos de joins. Fonte: R for Data Science, 2017.}\label{fig:join}
\end{figure}

A função \texttt{inner\_join()} retorna as observações em comum entre os dois conjuntos, de acordo com certa variável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{inner.join }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(juntar.linhas, d5,}
                         \AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{inner.join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 5
  nome   sexo  idade  peso profissao  
  <chr>  <chr> <dbl> <dbl> <chr>      
1 Vitor  M        24    73 Agronomo   
2 Marcos M        18    68 Professor  
3 Julio  M        25    72 Zootecnista
4 Fabio  M        35    81 Medico     
\end{verbatim}

Na função acima, declaramos as duas bases de dados a serem unidas, junto ao argumento \texttt{by\ =\ "nome"}, sendo essa a variável em comum. Como resultado, a \texttt{inner\_join()} nos retornou apenas a observações em comum entre o conjunto.

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/join-inner} 

}

\caption{Esquematização da função $inner_join$. Fonte: R for Data Science, 2017.}\label{fig:unnamed-chunk-173}
\end{figure}

Caso haja mais de uma variável em comum, bastaria declarar um vetor com as variáveis no argumento \texttt{by\ =} (\texttt{by\ =\ c("var\_1",\ "var\_2",\ ...,\ "var\_n")}). Atente-se ao fato que as variáveis devem estar entre aspas.

A função \texttt{full\_join()} nos retorna todas as observações de ambos os conjuntos, atribuindo valor \texttt{NA} para os valores ausentes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{full.join }\OtherTok{\textless{}{-}} \FunctionTok{full\_join}\NormalTok{(juntar.linhas, d5, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{full.join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 12 x 5
   nome      sexo  idade  peso profissao  
   <chr>     <chr> <dbl> <dbl> <chr>      
 1 Amanda    F        25    63 <NA>       
 2 Maria     F        30    65 <NA>       
 3 Vitor     M        24    73 Agronomo   
 4 Leticia   F        23    52 <NA>       
 5 Vitoria   F        21    51 <NA>       
 6 Marcos    M        18    68 Professor  
 7 Julio     M        25    72 Zootecnista
 8 Fabio     M        35    81 Medico     
 9 Gabriel   <NA>     NA    NA Estudante  
10 Guilherme <NA>     NA    NA Cozinheiro 
11 Jose      <NA>     NA    NA Biologo    
12 Getulio   <NA>     NA    NA Musico     
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/join-full} 

}

\caption{Esquematização da função $full_join$. Fonte: R for Data Science, 2017.}\label{fig:unnamed-chunk-175}
\end{figure}

A função \texttt{left\_join()} retorna todas as observações presentes no primeiro conjunto declarado, além dos valores em comum do segundo conjunto em relação ao primeiro. Por outro lado, a \texttt{right\_join()} retorna todas as observações do segundo conjunto declarado e os valores em comum do primeiro conjunto em relação ao segundo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{left.join }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(juntar.linhas, d5, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{left.join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 5
  nome    sexo  idade  peso profissao  
  <chr>   <chr> <dbl> <dbl> <chr>      
1 Amanda  F        25    63 <NA>       
2 Maria   F        30    65 <NA>       
3 Vitor   M        24    73 Agronomo   
4 Leticia F        23    52 <NA>       
5 Vitoria F        21    51 <NA>       
6 Marcos  M        18    68 Professor  
7 Julio   M        25    72 Zootecnista
8 Fabio   M        35    81 Medico     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{right.join }\OtherTok{\textless{}{-}} \FunctionTok{right\_join}\NormalTok{(juntar.linhas, d5, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{right.join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 5
  nome      sexo  idade  peso profissao  
  <chr>     <chr> <dbl> <dbl> <chr>      
1 Vitor     M        24    73 Agronomo   
2 Marcos    M        18    68 Professor  
3 Julio     M        25    72 Zootecnista
4 Fabio     M        35    81 Medico     
5 Gabriel   <NA>     NA    NA Estudante  
6 Guilherme <NA>     NA    NA Cozinheiro 
7 Jose      <NA>     NA    NA Biologo    
8 Getulio   <NA>     NA    NA Musico     
\end{verbatim}

Note que em ambas as funções, o primeiro conjunto declarado é o \texttt{juntar.linhas}, sendo o segundo, o \texttt{d5}.

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/join-rl} 

}

\caption{Esquematização das funções $left_join$ e $right_join$. Fonte: R for Data Science, 2017.}\label{fig:unnamed-chunk-177}
\end{figure}

Por fim, temos o \texttt{semi\_join()} e o \texttt{anti\_join()}.

O \texttt{semi\_join()} nos retorna todas as observações do primeiro conjunto que também estão presentes no segundo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tendo como primeiro conjunto o \textasciigrave{}juntar.linhas\textasciigrave{}}
\NormalTok{semi.join1 }\OtherTok{\textless{}{-}} \FunctionTok{semi\_join}\NormalTok{(juntar.linhas, d5, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{semi.join1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 4
  nome   sexo  idade  peso
  <chr>  <chr> <dbl> <dbl>
1 Vitor  M        24    73
2 Marcos M        18    68
3 Julio  M        25    72
4 Fabio  M        35    81
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tendo como primeiro conjunto o \textasciigrave{}d5\textasciigrave{}}
\NormalTok{semi.join2 }\OtherTok{\textless{}{-}} \FunctionTok{semi\_join}\NormalTok{(d5, juntar.linhas, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{semi.join2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 2
  nome   profissao  
  <chr>  <chr>      
1 Fabio  Medico     
2 Julio  Zootecnista
3 Marcos Professor  
4 Vitor  Agronomo   
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/join-semi} 

}

\caption{Esquematização da função $semi_join$. Fonte: R for Data Science, 2017.}\label{fig:unnamed-chunk-179}
\end{figure}

Já o \texttt{anti\_join()}, retorna as observações do primeiro conjunto que não estão presentes no segundo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tendo como primeiro conjunto o \textasciigrave{}juntar.linhas\textasciigrave{}}
\NormalTok{anti.join1 }\OtherTok{\textless{}{-}} \FunctionTok{anti\_join}\NormalTok{(juntar.linhas, d5, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{anti.join1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 4
  nome    sexo  idade  peso
  <chr>   <chr> <dbl> <dbl>
1 Amanda  F        25    63
2 Maria   F        30    65
3 Leticia F        23    52
4 Vitoria F        21    51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tendo como primeiro conjunto o \textasciigrave{}d5\textasciigrave{}}
\NormalTok{anti.join2 }\OtherTok{\textless{}{-}} \FunctionTok{anti\_join}\NormalTok{(d5, juntar.linhas, }\AttributeTok{by =} \StringTok{"nome"}\NormalTok{)}
\NormalTok{anti.join2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 4 x 2
  nome      profissao 
  <chr>     <chr>     
1 Gabriel   Estudante 
2 Guilherme Cozinheiro
3 Jose      Biologo   
4 Getulio   Musico    
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/join-anti} 

}

\caption{Esquematização da função $anti_join$. Fonte: R for Data Science, 2017.}\label{fig:unnamed-chunk-181}
\end{figure}

Tanto no \texttt{semi\_join()}, como no \texttt{anti\_join()}, mantêm-se apenas as colunas presentes no primeiro conjunto.

Pode-se notar que o \texttt{inner\_join()}, \texttt{full\_join()}, \texttt{left\_join()} e \texttt{right\_join()} adicionam novas variáveis a um conjunto de dados a partir de observações correspondentes em outro, ou seja, são \emph{mutating joins} (atuam de maneira semelhante à função \texttt{mutate()}). Já o \texttt{semi\_join()} e o \texttt{anti\_join()}, filtram observações de um conjunto de dados com base na correspondência - ou não - a uma observação no outro conjunto, ou seja, são \emph{filtering joins} (atuam de maneira semelhante à função \texttt{filter()}).

Partindo de uma base de dados cujas medidas de interesse foram selecionadas, filtradas, criadas, calculadas e unidas, podemos representá-las em gráficos, de acordo com o tipo de dado a ser representado. Com isso, no próximo capítulo, veremos como fazer gráficos a partir do pacote \texttt{ggplot2}, com o intuito de enxergarmos os nossos dados a partir de uma outra perspectiva.

\hypertarget{graf}{%
\chapter{Visualização}\label{graf}}

Nesta seção, focaremos na \textbf{Visualização de dados} (\emph{Data Visualization}). A visualização consiste em uma etapa importante tanto para enxergar informações relevantes em nossas análises, como para apresentar os resultados obtidos. Para tanto, utilizaremos os recursos disponíveis no pacote \texttt{ggplot2}.

O \texttt{ggplot2} foi idealizado por Hadley Wickham em sua tese de doutorado, em 2010, intitulada \href{http://vita.had.co.nz/papers/layered-grammar.pdf}{\emph{A Layered Grammar of Graphics}}. Desde então, tornou-se um dos pacotes mais populares para a confecção de gráficos elegantes e versáteis, tendo como base a \emph{gramática de gráficos}.

O conceito de \emph{gramática de gráficos} foi proposto originalmente no livro \href{https://www.springer.com/gp/book/9780387245447}{\emph{The Grammar of Graphics}}, por Leland Wilkinson, em 2005. Sua lógica se assemelha à gramática linguística na qual, para formularmos uma frase inteligível, devemos seguir uma ordem coerente de palavras. De modo semelhante, para construirmos gráficos a partir do \texttt{ggplot2}, devemos ter em mente quais são os seus fundamentos gramaticais.

Basicamente, a \emph{gramática de gráficos} está dividida em 7 camadas, podendo, ou não, estarem juntas, simultaneamente, em um só gráfico. A sua construção variará de acordo com o tipo de gráfico, além da necessidade e subjetividade do cientista de dados. As camadas podem ser classificadas como:

\begin{itemize}
\item
  \textbf{Dados} (\emph{Data}): se refere ao \emph{data frame} a ser utilizado para a confecção gráfica. É relevante ter noção sobre os tipos de variáveis que o compõe (qualitativas ou quantitativas), a fim de utilizá-las de maneira correta;
\item
  \textbf{Estéticas} (\emph{Aesthetics}): caracterizada pelo mapeamento em formas visuais, como a disposição das variáveis no plano cartesiano e a designação de cores, formas e tamanhos às variáveis;
\item
  \textbf{Geometrias} (\emph{Geometries}): representação geométrica do gráfico, seja em pontos, linhas, barras, caixas etc.;
\item
  \textbf{Facetas} (\emph{Facets}): é a forma de exibição dos gráficos de acordo com uma variável de interesse, podendo ser divididos em duas grades, em múltiplas grades ou simplesmente de forma individualizada;
\item
  \textbf{Estatísticas} (\emph{Statistics}): são os elementos de estatística calculados e presentes no gráfico, podendo ser a média, uma linha de tendência etc.;
\item
  \textbf{Coordenadas} (\emph{Coordinates}): definição das dimensões das coordenadas de acordo com o interesse;
\item
  \textbf{Tema} (\emph{Theme}): Cores, fonte do texto, tamanhos, formatações, legendas.
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/gglayers} 

}

\caption{Representação das 7 camadas presentes na gramática de gráficos, as quais utilizamos no ggplot2. Fonte: The Grammar of Graphics, 2005.}\label{fig:unnamed-chunk-182}
\end{figure}

Portanto, a essência do \texttt{ggplot2} é a construção gráfica em camadas. A página \href{https://www.r-graph-gallery.com/}{\emph{The R Graph Gallery}} compila uma série de exemplos gráficos possíveis de serem realizados no R, a partir do \texttt{ggplot2}, disponibilizando os códigos para que outros possam reproduzí-los e se inspirarem em novas criações.

A seguir, veremos as aplicações das diversas possibilidades gráficas e a lógica gramatical por trás de tudo. Para isso, devemos rodar o pacote \texttt{ggplot2}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

Caso você não tenha instalado o \texttt{ggplot2}, prossiga da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

Para verificar todos os conteúdos presentes no \texttt{ggplot2}, execute o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ls}\NormalTok{(}\StringTok{"package:ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Se você rodou o comando, notou que o \texttt{ggplot2} possui mais de 1000 funcionalidades! Mas, apesar da complexidade que este pacote carrega, suas ferramentas básicas são fáceis de serem assimiladas. A seguir, daremos os primeiros passos para construir os principais gráficos em \texttt{ggplot2}, para que, posteriormente, o leitor possa explorar com propriedade estas vastas funcionalidades presentes no pacote.

Nos exemplos a seguir, utilizaremos alguns bancos de dados que podem ser baixados \href{https://github.com/gustavojy/ApostilaCD-R/blob/main/dados_zip/dados_ggplot2.zip?raw=true}{clicando aqui}.

\hypertarget{gruxe1fico-de-dispersuxe3o}{%
\section{Gráfico de Dispersão}\label{gruxe1fico-de-dispersuxe3o}}

O primeiro gráfico que construiremos será o de dispersão. Esse tipo de gráfico é muito útil para determinar a tendência dos dados, seja linear ou não-linear, principalmente tratando de duas variáveis contínuas. Além disso, permite identificar observações atípicas. Para tanto, utilizaremos dados de alunos da disciplina Estatística Aplicada, presentes no arquivo \texttt{dados\_alunos.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}

\NormalTok{dados\_alunos }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_ggplot2/dados\_alunos.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_alunos}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 64 x 7
   sexo  idade altura  peso horas_estudo media_ponderada futuro   
   <chr> <dbl>  <dbl> <dbl>        <dbl>           <dbl> <chr>    
 1 M        23   1.75    80            2             7.5 academico
 2 F        19   1.67    65            2             8.3 mercado  
 3 M        19   1.7     90            3             6.9 mercado  
 4 M        22   1.73    87            3             7.1 academico
 5 M        19   1.83    71            2             6.5 mercado  
 6 M        19   1.8     80            3             8.6 mercado  
 7 M        20   1.9     90            2             7.8 academico
 8 F        20   1.6     55            1             8   mercado  
 9 F        24   1.62    55            2             8.2 academico
10 F        18   1.64    60            2             7.3 mercado  
# ... with 54 more rows
\end{verbatim}

A base de dados possui 64 observações e 7 variáveis, as quais informam o sexo, idade, altura (em metros), peso (em kg), horas de estudo (por dia), média ponderada no curso e perspectiva futura após a graduação.

Neste primeiro momento, utilizaremos as variáveis altura e peso para construir o gráfico de pontos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-188-1} \end{center}

A primeira camada do nosso gráfico é dada pela função \texttt{ggplot()}. O argumento \texttt{data\ =} recebe o objeto \texttt{dados\_alunos}, ou seja, recebe a base de dados que importamos anteriormente e que utilizaremos para construir o gráfico. Em seguida, o argumento \texttt{mapping\ =} define a estética do gráfico a partir da função \texttt{aes()}, sendo atribuído ao eixo x a variável altura (\texttt{x\ =\ altura}) e ao eixo y, a variável peso (\texttt{y\ =\ peso}). Por fim, criamos uma última camada referente ao tipo de geometria adotado no gráfico, no caso, a geometria de pontos \texttt{geom\_point()}.

Perceba que as camadas são unidas por um sinal de \texttt{+}. Portanto, a combinação das funções \texttt{ggplot()} e \texttt{geom\_point()} define o tipo de gráfico resultante.

Para se ter uma noção de como foi gerado o gráfico e entender melhor a lógica da \emph{gramática de gráficos}, rodaremos o código anterior por partes.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-189-1} \end{center}

Ao definir somente o argumento \texttt{data\ =\ dados\_alunos} na função \texttt{ggplot()}, o \texttt{ggplot2} nos retorna um gráfico vazio, pois indicamos apenas qual a base de dados que utilizaremos, sem fornecer informações referentes à estrutura do gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura, }
                     \AttributeTok{y =}\NormalTok{ peso))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-190-1} \end{center}

Agora, indicando as variáveis mapeadas nos eixos x e y, temos um gráfico com as coordenadas definidas, porém sem ter os dados plotados, pois ainda não definimos qual o tipo de geometria será utilizada.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-191-1} \end{center}

Assim, ao definir a geometria de pontos \texttt{geom\_point()}, os dados são inseridos no gráfico.

Portanto, para os que estão começando a utilizar o \texttt{ggplot2}, recomendo executar comando por comando, pois auxiliará na compreensão da montagem dos gráficos.

\hypertarget{cores}{%
\subsection{Cores}\label{cores}}

Há a possibilidade de incluir outras variáveis ao gráfico anterior. Por exemplo, dentro da função \texttt{aes()}, podemos incluir o argumento \texttt{color\ =\ sexo} para distinguir a coloração dos pontos de acordo com o sexo dos alunos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-192-1} \end{center}

\hypertarget{formatos}{%
\subsection{Formatos}\label{formatos}}

Podemos realizar algumas modificações em relação à aparência dos pontos, como por exemplo, alterar seu formato utilizando o argumento \texttt{shape\ =} dentro da função \texttt{geom\_point()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{shape =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-193-1} \end{center}

Cada tipo de formato é representado por um número, cujas legendas podem ser conferidas na figura \ref{fig:shape}.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/shapes} 

}

\caption{Legendas dos tipos de formatos de pontos, indicados no argumento `shape`. Fonte: R for Data Science, 2017.}\label{fig:shape}
\end{figure}

Além de atribuir um único tipo de formato aos pontos, podemos distinguir variáveis a partir dos formatos. Para isso, utilizamos o argumento \texttt{shape} dentro da função \texttt{aes()}, indicando qual variável da base de dados será atribuída ao argumento. Como exemplo, utilizaremos novamente a variável \texttt{sexo}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{shape =}\NormalTok{ sexo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-194-1} \end{center}

Como padrão, o argumento atribui aos pontos os formatos \texttt{16} e \texttt{17}. Para alterá-los, utilizamos a função \texttt{scale\_shape\_manual()}, com o argumento \texttt{values} recebendo um vetor com os números dos formatos que se deseja atribuir.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{shape =}\NormalTok{ sexo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{scale\_shape\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\DecValTok{13}\NormalTok{, }\DecValTok{24}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-195-1} \end{center}

Perceba que a ordem dos números no vetor segue a ordem das variáveis, ou seja, o formato \texttt{13} é referente ao sexo feminino (\texttt{F}) e o formato \texttt{24}, ao sexo masculino (\texttt{M}).

\hypertarget{tamanho}{%
\subsection{Tamanho}\label{tamanho}}

Ainda, podemos alterar o tamanho dos pontos. Para isso, utilizamos o argumento \texttt{size} dentro da função \texttt{geom\_point()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-196-1} \end{center}

Caso o argumento \texttt{size} não seja especificado, por padrão, o valor adotado é igual a 1. Assim, podemos gerar ponto maiores designando valores superiores a 1, ou senão, pontos menores, atribuindo valores inferiores a 1.

Outra possibilidade é diferenciar as idades dos alunos pelo tamanho dos pontos. Para isso, o argumento \texttt{size} receberá a variável \texttt{idade}, dentro a função \texttt{aes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{size =}\NormalTok{ idade)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-197-1} \end{center}

\hypertarget{transparuxeancia}{%
\subsection{Transparência}\label{transparuxeancia}}

Por fim, podemos diferenciar as idades pela transparência dos pontos, utilizando o argumento \texttt{alpha}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-198-1} \end{center}

Você deve ter percebido que um mesmo argumento pode ser utilizado de diferentes maneiras. Nos exemplos anteriores, utilizamos os argumentos \texttt{shape} e \texttt{size} dentro da função \texttt{aes()}, mas também na \texttt{geom\_point()}. Quando utilizamos dentro da \texttt{aes()}, o argumento sempre recebe uma \textbf{variável} da base de dados. Por outro lado, quando utilizada na \texttt{geom\_point()}, eles recebem um valor genérico contido em uma determinada escala. Assim, devemos nos atentar a esses detalhes para construirmos os gráficos de acordo com as especificações e posições dos argumentos.

\hypertarget{facetas-facets}{%
\subsection{\texorpdfstring{Facetas (\emph{Facets})}{Facetas (Facets)}}\label{facetas-facets}}

As facetas (\emph{facets}) replicam os gráficos, separando-os em grades (\emph{grids}), de acordo com uma variável categórica do nosso banco de dados. Para ficar mais claro, vamos exemplificar as facetas. Para isso, utilizaremos a função \texttt{facet\_wrap()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{sexo, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-199-1} \end{center}

A função \texttt{facet\_wrap()} entra como uma terceira camada ao gráfico. Como argumento, utilizamos a fórmula \texttt{\textasciitilde{}sexo} para dizer que a variável \texttt{sexo} será utilizada como fator para quebrar o gráfico em duas grades. Como se pode perceber, cada grade recebe somente os dados referentes aos respectivos sexos. Logo em seguida, temos um outro argumento que nos indica a disposição dos gráficos. No caso do \texttt{ncol}, os gráficos ficam dispostos lado a lado, sendo que para o \texttt{nrow} os gráficos se dispõem um embaixo do outro, como podemos ver a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{sexo, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-200-1} \end{center}

Ainda podemos associar duas variáveis categóricas ao \emph{facet}. Como exemplo, adicionaremos a variável \texttt{futuro} à fórmula \texttt{futuro\textasciitilde{}sexo}, a fim de verificarmos as perspectivas dos alunos sobre seus futuros após a graduação, de acordo com o sexo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(futuro}\SpecialCharTok{\textasciitilde{}}\NormalTok{sexo, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-201-1} \end{center}

Perceba que o número atribuído ao argumento \texttt{ncol\ =} define o número de colunas do \emph{facet}. A mesma lógica é válida para o \texttt{nrow\ =}, porém definindo o número de linhas.

\hypertarget{linhas-de-referuxeancia}{%
\subsection{Linhas de referência}\label{linhas-de-referuxeancia}}

Podemos adicionar linhas de referência aos nossos gráficos.

\hypertarget{linhas-horizontais}{%
\subsubsection*{Linhas horizontais}\label{linhas-horizontais}}
\addcontentsline{toc}{subsubsection}{Linhas horizontais}

Para criar linhas horizontais, utilizamos a função \texttt{geom\_hline()}. Como argumento, devemos usar a \texttt{yintercept}, que indica em qual ponto do eixo y será traçada a linha de referência horizontal.

No exemplo a seguir, será construído um gráfico de dispersão entre as horas de estudo e a média ponderada dos estudantes. A linha de referência será a média (\texttt{mean()}) da média ponderada dos alunos, indicada no argumento \texttt{yintercept}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ horas\_estudo,}
                     \AttributeTok{y =}\NormalTok{ media\_ponderada))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{yintercept =} \FunctionTok{mean}\NormalTok{(media\_ponderada)),}
             \AttributeTok{color =} \StringTok{"red"}\NormalTok{,}
             \AttributeTok{linetype =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-202-1} \end{center}

Perceba que o argumento \texttt{yintercept} foi colocado dentro da função \texttt{aes()}, pois utilizamos uma variável da nossa base de dados para construir a linha. Além disso, atribuímos a cor vermelha à linha (\texttt{color\ =\ "red"}) e definimos seu estilo com o argumento \texttt{linetype}. Cada tipo de linha é representado por um número, cuja legenda pode ser conferida na figura \ref{fig:linetype}.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{imagens/linetype} 

}

\caption{Possíveis tipos de linhas a partir do argumento `linetype`. Fonte: R Graphics Cookbook.}\label{fig:linetype}
\end{figure}

\hypertarget{linhas-verticais}{%
\subsubsection*{Linhas verticais}\label{linhas-verticais}}
\addcontentsline{toc}{subsubsection}{Linhas verticais}

As linhas de referência vertical são análogas às linhas horizontais. São construídas a partir da função \texttt{geom\_vline()}, que recebe o argumento \texttt{xintercept\ =} para indicar em qual ponto do eixo x será traçada a linha.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada,}
                     \AttributeTok{y =}\NormalTok{ horas\_estudo))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{mean}\NormalTok{(media\_ponderada)),}
             \AttributeTok{color =} \StringTok{"red"}\NormalTok{,}
             \AttributeTok{linetype =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-203-1} \end{center}

\hypertarget{linhas-diagonais}{%
\subsubsection*{Linhas diagonais}\label{linhas-diagonais}}
\addcontentsline{toc}{subsubsection}{Linhas diagonais}

Já as linhas diagonais são feitas com a \texttt{geom\_abline()}. Essa função desenha qualquer linha que siga a equação \texttt{y\ =\ a\ +\ b*x}, sendo \texttt{a} o intercepto com o eixo y, ou seja, o ponto onde a reta toca no eixo y, representado pelo argumento \texttt{intercept}, e \texttt{b}, o coeficiente angular da reta, indicado pelo argumento \texttt{slope}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculando o intercepto e o coeficiente angular}
\FunctionTok{lm}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Petal.Length }\SpecialCharTok{\textasciitilde{}}\NormalTok{ iris}\SpecialCharTok{$}\NormalTok{Petal.Width)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Call:
lm(formula = iris$Petal.Length ~ iris$Petal.Width)

Coefficients:
     (Intercept)  iris$Petal.Width  
           1.084             2.230  
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Gráfico com geom\_abline()}
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Petal.Width,}
                 \AttributeTok{y =}\NormalTok{ Petal.Length,}
                 \AttributeTok{color =}\NormalTok{ Species))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \FloatTok{1.084}\NormalTok{,}
              \AttributeTok{slope =} \FloatTok{2.23}\NormalTok{,}
              \AttributeTok{size =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-204-1} \end{center}

Como exemplo, utilizamos a base de dados nativa do R \texttt{iris} para criar um gráfico de dispersão entre a largura e o comprimento das pétalas de flores. Com a função \texttt{lm()}, calculamos o intercepto e o coeficiente angular entre as variáveis selecionadas, informando primeiro a variável do eixo y, seguida da variável do eixo x, tendo entre ambas o símbolo \texttt{\textasciitilde{}}.

Uma vez calculados o intercepto e o coeficiente angular, na função \texttt{geom\_abline()} especificamos os argumentos \texttt{intercept\ =\ 1.084} e \texttt{slope\ =\ 2.23} para informar que a reta começa na coordenada (0 , 1.084), possuindo um coeficiente de angulação igual a 2,23.

Perceba que, em um mesmo gráfico, utilizamos duas camadas geométricas. Nesse último exemplo, a função \texttt{geom\_point()} foi sobreposta pela \texttt{geom\_abline()}, pois segundo a lógica da \emph{gramática dos gráficos}, esses são construídos em camadas, portanto, a camada \texttt{geom\_point()} vem antes da \texttt{geom\_abline()}, sendo então sobreposta pela última.

\hypertarget{linhas-de-regressuxe3o}{%
\subsection{Linhas de regressão}\label{linhas-de-regressuxe3o}}

Também podemos incluir linhas de regressão ajustadas aos dados, a partir da função \texttt{geom\_smooth()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-205-1} \end{center}

Neste primeiro gráfico, definimos dentro da função \texttt{ggplot()} os eixos \texttt{x\ =\ altura} e \texttt{y\ =\ peso}. Sendo assim, essa estética é utilizada por ambas as funções geométricas, tanto a \texttt{geom\_point()}, como a \texttt{geom\_smooth()}.

Podemos definir na função \texttt{geom\_smooth()} o tipo de método para gerar a linha de regressão. Por padrão, o metódo utilizado é o \texttt{loess} (sigla de \emph{locally estimated scatterplot smoothing}).

Para alterar o método, utilizamos o argumento \texttt{method\ =} na função \texttt{geom\_smooth()}. No exemplo a seguir, definimos o método \texttt{"lm"}, ou seja, modelo linear (\emph{linear model}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-206-1} \end{center}

Perceba que a linha de regressão apresenta uma região sombreada em seu entorno. Essa região é o intervalo de confiança que, por padrão, adota-se 95\% de confiança. Para alterar o nível de confiança, utilizamos o argumento \texttt{level}. No exemplo a seguir, adotaremos 70\% de confiança (\texttt{level\ =\ 0.70}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }
              \AttributeTok{level =} \FloatTok{0.70}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-207-1} \end{center}

Para desativar o intervalo de confiança, utilizamos o argumento \texttt{se\ =\ FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-208-1} \end{center}

Ainda podemos alterar alguns fatores estéticos da reta, como por exemplo a cor, tamanho e tipo de linha.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{,}
              \AttributeTok{color =} \StringTok{"red"}\NormalTok{,}
              \AttributeTok{size =} \DecValTok{1}\NormalTok{,}
              \AttributeTok{linetype =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-209-1} \end{center}

Para construir linhas de regressão para diferentes grupos, em um mesmo gráfico, podemos prosseguir de diferentes maneiras. No exemplo a seguir, distinguiremos os pontos por cores, de acordo com o sexo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                           \AttributeTok{y =}\NormalTok{ peso,}
                           \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                            \AttributeTok{y =}\NormalTok{ peso),}
              \AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-210-1} \end{center}

Perceba que, apesar de ter distinguido os pontos de acordo com o sexo, foi traçada uma única linha de regressão para ambos os sexos. Para construir uma linha para cada sexo, precisamos agrupar a variável \texttt{sexo} na função \texttt{aes()} da \texttt{geom\_smooth()}, a partir do argumento \texttt{group\ =}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                           \AttributeTok{y =}\NormalTok{ peso,}
                           \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                            \AttributeTok{y =}\NormalTok{ peso,}
                            \AttributeTok{group =}\NormalTok{ sexo),}
              \AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-211-1} \end{center}

Nesses últimos exemplo, percaba que definimos a estética do gráfico (\texttt{aes()}) dentro de cada geometria e não mais na função \texttt{ggplot()}. Isso permite definir as estéticas individuais de cada geometria.

Caso contrário, poderíamos definir uma mesma estética para ambas as geometrias, definindo-a como função da \texttt{ggplot()}. No exemplo a seguir, traremos uma outra solução para o problema das linhas de regressão por categoria, definindo a \texttt{aes()} na função \texttt{ggplot()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-212-1} \end{center}

Nesse caso, definimos o fator cor (\texttt{color}) para diferenciarmos o sexo, tanto para a \texttt{geom\_point()}, como para a \texttt{geom\_smooth()}. Assim, perceba que os ponto e as retas de regressão ficaram com cores diferentes, de acordo com o sexo.

Para saber mais sobre as linhas de regressão no \texttt{ggplot2}, confira os capítulos 5.6 a 5.9 do excelente livro \href{https://r-graphics.org/recipe-scatter-fitlines}{R Graphics Cookbook}.

\hypertarget{tuxedtulos-e-ruxf3tulos}{%
\subsection{Títulos e rótulos}\label{tuxedtulos-e-ruxf3tulos}}

De maneira intuitiva, para colocarmos títulos e rótulos nos gráficos, adicionamos a camada \texttt{labs()}. Como argumento, indicamos qual fator desejamos (re)nomear. Atente-se ao fato de que as nomeações devem estar entre aspas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-213-1} \end{center}

Podemos adicionar mais alguns ajustes, como centralizar o título e subtítulo, colocar a fonte à esquerda, além de ocultar as legendas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \DecValTok{0}\NormalTok{),}
        \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-214-1} \end{center}

Nesse caso, conjuntamente à função \texttt{theme()}, utilizamos outra função, a \texttt{element\_text()}, para ajustar o posicionamento horizontal do título (\texttt{plot.title}) e do subtítulo (\texttt{plot.subtitle}), além da fonte (\texttt{plot.caption}). O argumento \texttt{hjust} apresenta uma escala de 0 a 1, sendo 0 o posicionamento mais à esquerda do gráfico. Assim, para centralizarmos os textos, definimos o ajuste na metade da escala (\texttt{hjust\ =\ 0.5}).

No caso das legendas, ainda dentro da função \texttt{theme()}, utilizamos o argumento \texttt{legend.position\ =\ "none"} para ocultar todas as legendas presentes no gráfico.

Caso queira ocultar somente uma das legendas, utilizamos a função \texttt{guides()}, informando a variável cuja legenda se deseja ocultar.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{alpha =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-215-1} \end{center}

Nesse exemplo, ocultamos apenas a legenda da variável \texttt{alpha}, atribuindo o valor lógico \texttt{FALSE}.

Para saber mais sobre títulos, rótulos e aparência geral dos gráficos, confira os capítulos 9 e 10 do livro \href{https://r-graphics.org/chapter-appearance}{\emph{R Graphics Cookbook}}.

\hypertarget{temas}{%
\subsection{Temas}\label{temas}}

Existe a possibilidade de escolhermos outros temas para confeccionar nossos gráficos. Podemos criar temas a partir do zero ou senão utilizar aqueles presentes no \texttt{ggplot2} pela função \texttt{theme\_}. A seguir demonstraremos alguns dos temas pré-configurados.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{alpha =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-216-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{alpha =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-217-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dados\_alunos,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                     \AttributeTok{y =}\NormalTok{ peso,}
                     \AttributeTok{color =}\NormalTok{ sexo,}
                     \AttributeTok{alpha =}\NormalTok{ idade))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Altura (m)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Peso (kg)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Gênero"}\NormalTok{,}
    \AttributeTok{alpha =} \StringTok{"Idade (anos)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Altura x Peso"}\NormalTok{,}
    \AttributeTok{caption =} \StringTok{"Fonte: Disciplina Estatística Aplicada/ESALQ."}
\NormalTok{  )}\SpecialCharTok{+}
  \FunctionTok{theme\_dark}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{alpha =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-218-1} \end{center}

\hypertarget{gruxe1fico-de-barras}{%
\section{Gráfico de Barras}\label{gruxe1fico-de-barras}}

Para a construção do gráfico de barras, dependendo do tipo de dados que queremos representar, podemos prosseguir a partir de duas vias. A primeira é utilizando a função \texttt{geom\_col()}, sendo a outra, a \texttt{geom\_bar()}. A seguir trataremos com detalhes ambas as funções.

\hypertarget{geom_col}{%
\subsection*{\texorpdfstring{\texttt{geom\_col()}}{geom\_col()}}\label{geom_col}}
\addcontentsline{toc}{subsection}{\texttt{geom\_col()}}

Utilizamos a função \texttt{geom\_col()} para construir gráficos de barras em que indicamos uma variável categórica ao eixo x e uma variável quantitativa ao eixo y, sendo essa última, a que determinará a altura das barras. Para a elaboração dos exemplos, utilizaremos dados referentes à produção de milho e trigo, disponível no arquivo \texttt{milho\_trigo.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{producao }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_ggplot2/milho\_trigo.csv"}\NormalTok{)}

\NormalTok{producao}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 8 x 3
  Local  Cultura Valor
  <chr>  <chr>   <dbl>
1 Brasil Milho    2.6 
2 Brasil Trigo    1.52
3 China  Milho    3.94
4 China  Trigo    3.07
5 India  Milho    1.62
6 India  Trigo    2.08
7 EUA    Milho    7.38
8 EUA    Trigo    2.48
\end{verbatim}

A base de dados apresenta 8 observações e 3 variáveis. A variável \texttt{Local} possui os países Brasil, China, Índia e Estado Unidos; a \texttt{Cultura} contém as culturas agrícolas milho e trigo; e \texttt{Valor} representa a produtividade média anual dos países, em toneladas por hectare, entre 1961 e 2019.

\hypertarget{cores-1}{%
\subsubsection{Cores}\label{cores-1}}

Nesse primeiro exemplo, queremos criar um gráfico de barras para representar a produção média de milho e trigo em cada um dos países. Para isso, utilizamos a função \texttt{geom\_col()}. Perceba que, para diferenciarmos as porções da barra que representam as produções de cada cereal, podemos utilizar os argumentos estéticos \texttt{color\ =\ Item} e \texttt{fill\ =\ Item}.

O argumento \texttt{color\ =} somente colore as bordas das colunas, enquanto que o \texttt{fill\ =} preenche a barra com cores, de acordo os valores das variáveis milho e trigo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Argumento "color ="}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-220-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Argumento "fill ="}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-221-1} \end{center}

\hypertarget{posiuxe7uxe3o}{%
\subsubsection{Posição}\label{posiuxe7uxe3o}}

Caso queira alterar a disposição das colunas, podemos utilizar o argumento \texttt{position\ =} e especificar o ajuste desejado, tendo como opções: \texttt{"stack"}, \texttt{"dodge"} e \texttt{"fill"}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "stack"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"stack"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-222-1} \end{center}

Perceba que a posição \texttt{"stack"} é a opção padrão do argumento \texttt{position\ =}, portanto, caso o argumento não seja especificado, a disposição do gráfico de colunas será a \texttt{"stack"}. Essa disposição de barras representa os valores absolutos de produtividade das culturas em apenas uma barra, de acordo com o país.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "dodge"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-223-1} \end{center}

Já a posição \texttt{"dodge"} representa as cultura em colunas separadas, de acordo com o país, ainda representando valores absolutos de produtividade.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "fill"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-224-1} \end{center}

Por último, a posição \texttt{"fill"} constrói barras iguais, com escala de 0 a 1, preenchendo-as com os valores absolutos das produções de milho e trigo, de acordo com o país.

\hypertarget{legendas}{%
\subsubsection{Legendas}\label{legendas}}

Podemos adicionar legendas às nossas colunas, a partir da função \texttt{geom\_text()}. Nos seguintes caso, demonstraremos como inserir as legendas nos três tipos de posição, indicando os valores de produtividades referentes a cada cultura e país.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "stack"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"stack"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ Valor),}
           \AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
           \AttributeTok{vjust =} \FloatTok{1.5}\NormalTok{,}
           \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\FloatTok{0.9}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-225-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "dodge"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ Valor),}
            \AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
            \AttributeTok{vjust =} \FloatTok{1.5}\NormalTok{,}
            \AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{(}\FloatTok{0.9}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-226-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Posição "fill"}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ producao,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Local,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{fill =}\NormalTok{ Cultura))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ Valor),}
            \AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
            \AttributeTok{vjust =} \FloatTok{2.5}\NormalTok{,}
            \AttributeTok{position =} \FunctionTok{position\_fill}\NormalTok{(}\FloatTok{0.9}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-227-1} \end{center}

Note que a estrutura da função \texttt{geom\_text()} é quase idêntica para as três posições, apenas alterando alguns valores e especificações. Primeiramente, definimos na função \texttt{aes()} a variável utilizada para ilustrar as legendas, no caso, a \texttt{Valor}. Em seguida, definimos a cor da legenda, sendo definida como branca (\texttt{color\ =\ "white"}). O argumento \texttt{vjust\ =} ajusta o posicionamento vertical das legendas, tendo como referência cada uma das barras; nesse caso, faça os ajustes testando valores, sendo possível atribuir valores negativos, fazendo com que a legenda suba. Por fim, a função \texttt{position\_}, contida no argumento \texttt{position\ =}, ajusta o posicionamento das legendas em cada um dos setores da barra, de acordo com o tipo de posição adotada no \texttt{geom\_col()}, seja o \texttt{stack} (\texttt{position\_stack()}), \texttt{dodge} (\texttt{position\_dodge()}) ou \texttt{fill} (\texttt{position\_fill()}).

\hypertarget{geom_bar}{%
\subsection*{\texorpdfstring{\texttt{geom\_bar()}}{geom\_bar()}}\label{geom_bar}}
\addcontentsline{toc}{subsection}{\texttt{geom\_bar()}}

A função \texttt{geom\_bar()} constrói gráficos de barras a partir da contagem de valores presentes em uma variável categórica. Como exemplo, utilizaremos a base de dados \texttt{diamonds}, presente no prórprio pacote \texttt{ggplot2}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 53,940 x 10
   carat cut       color clarity depth table price     x     y     z
   <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <int> <dbl> <dbl> <dbl>
 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
 7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
 8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
 9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
# ... with 53,930 more rows
\end{verbatim}

Essa \emph{tibble} apresenta 53.940 observações e 10 variáveis, referentes às características de uma amostra de diamantes. Dessas variáveis, utilizaremos apenas a \texttt{cut}, que informa a qualidade de corte dos diamantes, sendo categorizadas em \texttt{Fair}, \texttt{Good}, \texttt{Very\ Good}, \texttt{Premium} e \texttt{Ideal}. Assim sendo, faremos um gráfico de barras que conta a quantidade de diamantes que se encaixam em cada uma dessas categorias.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(diamonds,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ cut))}\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-229-1} \end{center}

Perceba que foi preciso informar apenas a variável categórica \texttt{cut} no eixo x, sendo o y construido, automaticamente, a partir da contagem dos diamantes que se encaixam nas respectivas categorias.

Podemos melhorar a apresentação do gráfico atribuindo cores às categorias. Para isso, utilizamos o argumento \texttt{fill} na função \texttt{aes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(diamonds,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ cut,}
           \AttributeTok{fill =}\NormalTok{ cut))}\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-230-1} \end{center}

\hypertarget{coordenadas}{%
\subsubsection{Coordenadas}\label{coordenadas}}

O sistema de coordenadas padrão do \texttt{ggplot2} é o cartesiano, onde os eixo x e y atuam de maneira independente para determinar a localização de cada ponto. De maneira simples, podemos inverter os eixos x e y utilizando a função \texttt{coord\_flip()}, assim, dispomos as barras no sentido horizontal. O exemplo a seguir ilustra o caso.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(diamonds,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ cut,}
           \AttributeTok{fill =}\NormalTok{ cut))}\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-231-1} \end{center}

Podemos utilizar outras coordenadas para contruir diferentes tipos de gráficos, como é o caso dos gráficos de setores, os quais veremos a seguir.

\hypertarget{gruxe1fico-de-setores-pizza}{%
\section{Gráfico de Setores (Pizza)}\label{gruxe1fico-de-setores-pizza}}

Mais conhecido como gráfico de pizza, esse tipo gráfico é muito popular e simples de ser compreendido. Apesar disso, sua utilização deve ser cautelosa para não sobrecarregar em informação ou utilizá-lo de maneira inadequada. Normalmente, um gráfico de pizza visa representar a frequência relativa de valores, de acordo com uma variável categórica.

Para construí-lo no \texttt{ggplot2}, utilizamos do artifício \texttt{coord\_polar()}, o qual altera a coordenada do gráfico de barras. A seguir, veremos uma demonstração com dados hipotéticos sobre o grau de instrução de indivíduos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{educ }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{Instrucao =} \FunctionTok{c}\NormalTok{(}\StringTok{"Fundamental"}\NormalTok{, }\StringTok{"Médio"}\NormalTok{, }\StringTok{"Superior"}\NormalTok{),}
  \AttributeTok{Quantidade =} \FunctionTok{c}\NormalTok{(}\DecValTok{150}\NormalTok{, }\DecValTok{200}\NormalTok{, }\DecValTok{60}\NormalTok{),}
  \AttributeTok{Porcentagem =} \FunctionTok{round}\NormalTok{((Quantidade}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(Quantidade)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{),}\DecValTok{2}\NormalTok{)}
\NormalTok{)}

\NormalTok{educ}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 3
  Instrucao   Quantidade Porcentagem
  <chr>            <dbl>       <dbl>
1 Fundamental        150        36.6
2 Médio              200        48.8
3 Superior            60        14.6
\end{verbatim}

Assim, devemos proceder da seguinte maneira para construir o gráfico de setores:

\textbf{1. Montar o gráfico de barras:} devemos deixar vazio o eixo x (\texttt{x\ =\ ""}), definir os valores percentuais no eixo y (\texttt{y\ =\ Porcentagem}) e preencher a barra com a variável categórica (\texttt{fill\ =\ Instrucao}). Feito isso, atribuímos a geometria de barras (\texttt{geom\_col()}), colorindo suas bordas com a cor preta (\texttt{color\ =\ "black"}), a fim de delimitar os segmentos do gráfico;

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ educ,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{y =}\NormalTok{ Porcentagem,}
                     \AttributeTok{fill =}\NormalTok{ Instrucao))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-233-1} \end{center}

\textbf{2. Legendas:} utilizamos a \texttt{geom\_text()} para definir a legenda das porcentagens dentro de cada setor da barra. Dentro da função \texttt{aes()}, definimos como rótulo (\texttt{label\ =}) a variável \texttt{Porcentagem}, sendo que a função \texttt{paste(Porcentagem,\ "\%")} insere o símbolo de \texttt{\%} logo após os valores de porcentagem. Por último, o argumento \texttt{vjust\ =\ 0.5} ajusta a posição das legendas;

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ educ,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{y =}\NormalTok{ Porcentagem,}
                     \AttributeTok{fill =}\NormalTok{ Instrucao))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(Porcentagem, }\StringTok{"\%"}\NormalTok{)),}
            \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-234-1} \end{center}

\textbf{3. Coordenada:} nesse ponto, utilizamos a função \texttt{coord\_polar()} para tornar nosso gráfico redondo. O argumento \texttt{theta\ =\ "y"} indica que o eixo y deve ser adotado como referência para a alteração da coordenada e o \texttt{start\ =} indica por qual valor o gráfico deve começar (teste outro valores para ver a diferença);

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ educ,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{y =}\NormalTok{ Porcentagem,}
                     \AttributeTok{fill =}\NormalTok{ Instrucao))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(Porcentagem, }\StringTok{"\%"}\NormalTok{)),}
            \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{,}
              \AttributeTok{start =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-235-1} \end{center}

\textbf{4. Retirar elementos:} neste ponto, já temos um gráfico de pizza, porém poluído devido a presença das escalas, nome dos eixos e cor de fundo inadequada. Para alterar o fundo cinza para um branco, escolhemos o tema \texttt{theme\_minimal()}. Em seguida, na função \texttt{theme()}, atribuímos a alguns argumentos o \texttt{element\_blank()}, ou seja, função que retira os elementos de cena. Portanto, o \texttt{axis.title\ =\ element\_blank()} retira os nomes dos eixos, o \texttt{axis.text\ =\ element\_blank()} exclui o restante de texto presente no gráfico e o \texttt{panel.grid\ =\ element\_blank()} omite o restante das linhas gráficas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ educ,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{y =}\NormalTok{ Porcentagem,}
                     \AttributeTok{fill =}\NormalTok{ Instrucao))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(Porcentagem, }\StringTok{"\%"}\NormalTok{)),}
            \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{,}
              \AttributeTok{start =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{    )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-236-1} \end{center}

\textbf{5. Personalização:} agora temos um gráfico de pizza autêntico. Podemos realizar mais algumas modificações estéticas, como definir uma paleta de cores com a \texttt{scale\_fill\_brewer()} e ajustar o nome na legenda com o \texttt{labs()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ educ,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{y =}\NormalTok{ Porcentagem,}
                     \AttributeTok{fill =}\NormalTok{ Instrucao))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(Porcentagem, }\StringTok{"\%"}\NormalTok{)),}
            \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{,}
              \AttributeTok{start =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{    )}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Grau de Instrução"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-237-1} \end{center}

\hypertarget{gruxe1fico-de-linhas}{%
\section{Gráfico de Linhas}\label{gruxe1fico-de-linhas}}

Os gráficos de linhas são muito utilizados para representar séries temporais, ou seja, a progressão de valores ao longo do tempo. Utilizamos a função \texttt{geom\_line()} para construí-los. Para exemplificação, utilizaremos os dados de produtividade de milho entre 1961 e 2019, disponíveis no arquivo \texttt{produtiv\_milho.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\NormalTok{produtiv\_milho }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_ggplot2/produtiv\_milho.csv"}\NormalTok{)}

\NormalTok{produtiv\_milho}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 236 x 3
   Local    Ano Valor
   <chr>  <dbl> <dbl>
 1 Brasil  1961  1.31
 2 Brasil  1962  1.30
 3 Brasil  1963  1.31
 4 Brasil  1964  1.16
 5 Brasil  1965  1.38
 6 Brasil  1966  1.31
 7 Brasil  1967  1.38
 8 Brasil  1968  1.34
 9 Brasil  1969  1.31
10 Brasil  1970  1.44
# ... with 226 more rows
\end{verbatim}

A base de dados apresenta 236 observações e 3 variáveis. A variável \texttt{Local} possui os países Brasil, China, Índia e Estado Unidos; a \texttt{Ano} dispõe de dados entre 1961 e 2019; e \texttt{Valor} representa a produtividade da cultura do milho, em toneladas por hectare.

Para o primeiro exemplo, utilizaremos apenas os dados referentes ao Brasil. Para isso, utilizaremos a função \texttt{dplyr::filter}, do pacote \texttt{dplyr}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{produtiv\_br }\OtherTok{\textless{}{-}}\NormalTok{ produtiv\_milho }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Local }\SpecialCharTok{==} \StringTok{"Brasil"}\NormalTok{)}

\NormalTok{produtiv\_br}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 59 x 3
   Local    Ano Valor
   <chr>  <dbl> <dbl>
 1 Brasil  1961  1.31
 2 Brasil  1962  1.30
 3 Brasil  1963  1.31
 4 Brasil  1964  1.16
 5 Brasil  1965  1.38
 6 Brasil  1966  1.31
 7 Brasil  1967  1.38
 8 Brasil  1968  1.34
 9 Brasil  1969  1.31
10 Brasil  1970  1.44
# ... with 49 more rows
\end{verbatim}

Portanto, o objeto \texttt{produtiv\_br} possui apenas o país Brasil, apresentando 59 observações e 3 variáveis.

Para construir o gráfico de linhas, atribuiremos ao eixo x a variável \texttt{Ano} e ao eixo y, a variável \texttt{Valor}, além de definir a geometria de linha, ou seja, a \texttt{geom\_line()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_br)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
                \AttributeTok{y =}\NormalTok{ Valor))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-240-1} \end{center}

\hypertarget{cores-2}{%
\subsection{Cores}\label{cores-2}}

Podemos definir a cor da linha de maneira manual, utilizando o argumento \texttt{color\ =}. Porém, devemos nos atentar a alguns detalhes.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_br)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
                \AttributeTok{y =}\NormalTok{ Valor,}
                \AttributeTok{color =} \StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-241-1} \end{center}

Perceba que o argumento \texttt{color\ =\ "blue"} nos retornou uma linha de coloração vermelha e não azul. Isto aconteceu pois o argumento foi colocado dentro da função \texttt{aes()} e esta espera uma coluna do banco de dados para mapear, assim, o valor \texttt{"blue"} é tratado como uma nova variável pertencente a todas as observações. Portanto, a linha é colorida de vermelho (padrão do \texttt{ggplot2}) associada à nova categoria ``\emph{blue}''.

Portanto, para colorirmos a linha de azul, devemos colocar o atributo \texttt{color\ =} fora da função \texttt{aes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_br)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
                \AttributeTok{y =}\NormalTok{ Valor),}
            \AttributeTok{color =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-242-1} \end{center}

\hypertarget{tamanho-1}{%
\subsection{Tamanho}\label{tamanho-1}}

Para alterarmos o tamanho da linha, utilizamos o argumento \texttt{size\ =}. Agora que aprendemos com o exemplo anterior, devemos colocá-lo fora da função \texttt{aes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_br)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
                \AttributeTok{y =}\NormalTok{ Valor),}
            \AttributeTok{color =} \StringTok{"blue"}\NormalTok{,}
            \AttributeTok{size =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-243-1} \end{center}

\hypertarget{geometrias}{%
\subsection{Geometrias}\label{geometrias}}

Nos gráficos de linhas, podemos mesclar diversas geometrias. A seguir, demonstraremos alguns exemplos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"red"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-244-1} \end{center}

Aqui, podemos ver a associação do gráfico de linhas com o gráfico de pontos. Perceba que a estética (\texttt{aes()}) foi definida na função \texttt{ggplot()}, servindo tanto para o \texttt{geom\_line()}, como para o \texttt{geom\_point()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ Local),}
            \AttributeTok{size =} \DecValTok{1}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ Local),}
              \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
              \AttributeTok{method =} \StringTok{"lm"}\NormalTok{,}
              \AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-245-1} \end{center}

Agora, utilizando a base de dados \texttt{produtiv\_milho}, unimos os quatro países em um mesmo gráfico. Designamos a variável \texttt{Local} (ou seja, os países) ao argumento \texttt{color\ =} para distingui-los com cores diferentes. Por se tratar de uma variável do nosso banco de dados, colocamos o argumento dentro da função \texttt{aes()}, contida na \texttt{geom\_line()}. A outra camada geométrica é referente a reta de regressão, onde agrupamos a variável \texttt{Local} para que fosse possível traçar uma linha de regressão linear para cada variável.

\hypertarget{formatos-1}{%
\subsection{Formatos}\label{formatos-1}}

Também podemos diferenciar variáveis pelo formato das linhas, aplicando o argumento \texttt{linetype\ =} dentro da função \texttt{aes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{linetype =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-246-1} \end{center}

Ademais, poderiamos associar formatos e cores em um mesmo gráfico, a fim de diferenciar as variáveis.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local,}
           \AttributeTok{linetype =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-247-1} \end{center}

\hypertarget{escalas}{%
\subsection{Escalas}\label{escalas}}

A família de funções \texttt{scale\_} confere propriedades para mudar as escalas de gráficos, cada qual com funções específicas. A seguir demonstraremos algumas delas.

\hypertarget{eixos}{%
\subsubsection*{Eixos}\label{eixos}}
\addcontentsline{toc}{subsubsection}{Eixos}

Para quebrarmos (\texttt{breaks\ =}) as escalas dos eixos \texttt{x} e \texttt{y} e redefinirmos outra sequência (\texttt{seq()}), utilizamos as funções \texttt{scale\_x\_continuous()} e \texttt{scale\_y\_continuous()}. Como fatores do argumento \texttt{seq()}, definimos o limite inferior (\texttt{from\ =}), o limite superior (\texttt{to\ =}) e a sequência da escala (\texttt{by\ =}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \DecValTok{1}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1961}\NormalTok{, }\AttributeTok{to =} \DecValTok{2019}\NormalTok{, }\AttributeTok{by =} \DecValTok{3}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{0}\NormalTok{, }\AttributeTok{to =} \DecValTok{12}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-248-1} \end{center}

Perceba que, no eixo x, os anos ficaram apertados e mal apresentados. Para melhorar sua aparência, podemos alterar a angulação do texto (\texttt{angle\ =}) com o argumento \texttt{axis.text.x\ =\ element\_text()}, dentro da função \texttt{theme()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \DecValTok{1}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1961}\NormalTok{, }\AttributeTok{to =} \DecValTok{2019}\NormalTok{, }\AttributeTok{by =} \DecValTok{3}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{0}\NormalTok{, }\AttributeTok{to =} \DecValTok{12}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{45}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-249-1} \end{center}

Ainda podemos inserir uma segunda escala aos nossos gráficos, utilizando a função \texttt{scale\_y\_continuous()}. Uma segunda escala é útil para representar, em um mesmo gráfico, variáveis que apresentem escala numérica diferente. Como exemplo, utilizaremos a base de dados sobre o PIB do Brasil, disponível no arquivo \texttt{pib\_br.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib\_br }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"dados\_ggplot2/pib\_br.csv"}\NormalTok{)}

\NormalTok{pib\_br}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 18 x 3
     ano var_anual  valor
   <dbl>     <dbl>  <dbl>
 1  2000      2.8   3722.
 2  2001     -0.09  3155.
 3  2002      1.29  2842.
 4  2003     -0.15  3063.
 5  2004      4.34  3623.
 6  2005      2     4770.
 7  2006      2.81  5860.
 8  2007      4.95  7314.
 9  2008      4.03  8788.
10  2009     -1.11  8553.
11  2010      6.49 11224.
12  2011      2.99 13167.
13  2012      0.97 12292.
14  2013      2.06 12217.
15  2014     -0.38 12027.
16  2015     -4.59  8750.
17  2016     -4.25  8645.
18  2017      0.2   9812.
\end{verbatim}

A \emph{tibble} apresenta 18 observações e 3 variáveis, sendo elas o \texttt{ano}, entre 2000 e 2019; a variação anual do PIB (\texttt{var\_anual}); e o valor bruto do PIB, em US\$ (\texttt{valor}).

Primeiramente, plotaremos uma variável por vez, a fim de observarmos a escala do eixo y de cada uma, começando pela variação anual do PIB.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pib\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ano))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ var\_anual,}
               \AttributeTok{fill =}\NormalTok{ var\_anual}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{),}
           \AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{,}
           \AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-251-1} \end{center}

Para preencher as barras com cores, utilizamos o critério no qual valores positivos recebem uma cor e negativos, outra cor. Perceba que a escala da variação anual do PIB varia entre, aproximadamente, -5 e 6.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pib\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ano))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ (valor)))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-252-1} \end{center}

Já no gráfico referente ao valor bruto do PIB, a escala varia entre 2.500 e 13.000.

Assim, para unirmos ambas as medidas, precisaremos criar duas escalas no eixo y. Para isso, precisamos redefinir a escala da variável \texttt{valor}. A tática a ser utilizada será dividir os valores pelo menor valor apresentado na variável referente à variação anual do PIB.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pib\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ano))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ var\_anual,}
               \AttributeTok{fill =}\NormalTok{ var\_anual}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{),}
           \AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{,}
           \AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ (valor}\SpecialCharTok{/}\DecValTok{2842}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-253-1} \end{center}

Dessa maneira, conseguimos representar ambas as variáveis em um mesmo gráfico. Contudo, precisamos definir um novo eixo y, a fim de representarmos os valores da variável \texttt{var\_anual}. Para isso, utilizaremos a função \texttt{scale\_y\_continuous()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pib\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ano))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ var\_anual,}
               \AttributeTok{fill =}\NormalTok{ var\_anual}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{),}
           \AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{,}
           \AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ (valor}\SpecialCharTok{/}\DecValTok{2842}\NormalTok{)))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{4.0}\NormalTok{, }\FloatTok{6.0}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{),}
                     \AttributeTok{sec.axis =} \FunctionTok{sec\_axis}\NormalTok{(}\AttributeTok{trans =} \SpecialCharTok{\textasciitilde{}}\NormalTok{. }\SpecialCharTok{*}\DecValTok{2842}\NormalTok{,}
                                         \AttributeTok{name =} \StringTok{"US$"}\NormalTok{,}
                                         \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{20000}\NormalTok{, }\AttributeTok{by =} \DecValTok{4000}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-254-1} \end{center}

Na função \texttt{scale\_y\_continuous()}, o primeiro argumento (\texttt{breaks\ =}) trata de redefinir a escala da variável \texttt{var\_anual}. Posteriormente, o \texttt{sec.axis\ =} lida com a criação do segundo eixo y para representar a escala referente ao valor bruto do PIB brasileiro. Essa segunda escala toma como base os valores da escala primária do eixo y. O primeiro argumento é o \texttt{trans\ =}, que recebe uma fórmula, a fim de realizar uma operação matemática para alterar a escala do eixo y secundário. No nosso exemplo, multiplicaremos pelo valor \texttt{2842}, o mesmo o qual dividimos anteriomente os valores do PIB bruto, para representar ambas as variáveis em um mesmo gráfico. Em seguida, nomeamos a nova escala com o argumento \texttt{names\ =} e definimos sua escala com \texttt{breaks\ =}.

Por fim, podemos realizar mais alguns incrementos ao gráfico para deixá-lo mais apresentável.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pib\_br,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ano))}\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ var\_anual,}
               \AttributeTok{fill =}\NormalTok{ var\_anual}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{),}
           \AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{,}
           \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
           \AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ (valor}\SpecialCharTok{/}\DecValTok{2842}\NormalTok{)),}
            \AttributeTok{size =} \FloatTok{1.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{name =} \StringTok{"\%"}\NormalTok{,}
                     \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{4.0}\NormalTok{, }\FloatTok{6.0}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{),}
                     \AttributeTok{sec.axis =} \FunctionTok{sec\_axis}\NormalTok{(}\AttributeTok{trans =} \SpecialCharTok{\textasciitilde{}}\NormalTok{. }\SpecialCharTok{*}\DecValTok{2842}\NormalTok{,}
                                         \AttributeTok{name =} \StringTok{"US$"}\NormalTok{,}
                                         \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{20000}\NormalTok{, }\AttributeTok{by =} \DecValTok{4000}\NormalTok{)))}\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{name =} \StringTok{""}\NormalTok{,}
                     \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2000}\NormalTok{, }\DecValTok{2019}\NormalTok{, }\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{25}\NormalTok{))  }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-255-1} \end{center}

Esse exemplo representa um gráfico mais completo e de nível mais avançado. Caso não tenha entendido algum passo, rode o código por camada, para acompanhar a progressão de construção do gráfico e entender a lógica por trás.

\hypertarget{cores-3}{%
\subsubsection*{Cores}\label{cores-3}}
\addcontentsline{toc}{subsubsection}{Cores}

Para mudarmos as escalas de cores, utilizamos a \texttt{scale\_color\_} e \texttt{scale\_fill\_}.

Para alterá-las manualmente, utiliza-se as funções \texttt{scale\_color\_manual()} e \texttt{scale\_fill\_manual}, tendo como argumento o \texttt{values\ =}, que recebe um vetor com o nome das cores, cuja ordem no vetor diz respeito à ordem das variáveis às quais se quer atribuir tais cores.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.5}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"chocolate"}\NormalTok{, }\StringTok{"cyan3"}\NormalTok{, }\StringTok{"bisque4"}\NormalTok{, }\StringTok{"chartreuse4"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-256-1} \end{center}

A figura \ref{fig:cornome} mostra os nomes das possíveis cores.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{imagens/nome_cor} 

}

\caption{Nome das possíveis cores a serem definidas para os gráficos. Fonte: *The R Graph Gallery.*}\label{fig:cornome}
\end{figure}

Também, podemos alterar as colorações a partir de paletas de cores pré-definidas, utilizando a função \texttt{scale\_color\_brewer()}, tendo como argumento a \texttt{palette\ =}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.5}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-257-1} \end{center}

A figura \ref{fig:paleta} mostra as possíveis paletas de cores.

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{imagens/paleta_cor} 

}

\caption{Nome das paletas de cores disponíveis para aplicarmos em nossos gráficos. Fonte: *The R Graph Gallery*.}\label{fig:paleta}
\end{figure}

Caso queira saber mais sobre as escalas de cores existentes no R, confira o post do site \emph{The R Graph Gallery}: \href{https://www.r-graph-gallery.com/ggplot2-color.html}{Dealing with colors in ggplot2}.

\hypertarget{ruxf3tulos}{%
\subsubsection*{Rótulos}\label{ruxf3tulos}}
\addcontentsline{toc}{subsubsection}{Rótulos}

Para trocar o nome das categorias na legenda, usa-se \texttt{scale\_"argumento"\_discrete()}, junto ao argumento \texttt{labels}. A seguir, citamos algumas das possibilidades:

\begin{itemize}
\item
  \texttt{scale\_color\_discrete()}: para alterar o nome das variáveis contidas no argumento \texttt{color};
\item
  \texttt{scale\_fill\_discrete()}: para alterar o nome das variáveis contidas no argumento \texttt{fill};
\item
  \texttt{scale\_alpha\_discrete()}: para alterar o nome das variáveis contidas no argumento \texttt{alpha};
\item
  \texttt{scale\_size\_discrete()}: para alterar o nome das variáveis contidas no argumento \texttt{size}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(produtiv\_milho, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{Ano,}
           \AttributeTok{y =}\NormalTok{ Valor,}
           \AttributeTok{color =}\NormalTok{ Local))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.5}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"BR"}\NormalTok{, }\StringTok{"CHI"}\NormalTok{, }\StringTok{"IND"}\NormalTok{, }\StringTok{"EUA"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-258-1} \end{center}

\hypertarget{gruxe1ficos-de-medidas-resumo}{%
\section{Gráficos de medidas-resumo}\label{gruxe1ficos-de-medidas-resumo}}

Voltemos aos dados dos alunos de Estatística Aplicada para fazermos alguns gráficos de medidas-resumo, importantes para observarmos a distribuição de valores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_alunos}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 64 x 7
   sexo  idade altura  peso horas_estudo media_ponderada futuro   
   <chr> <dbl>  <dbl> <dbl>        <dbl>           <dbl> <chr>    
 1 M        23   1.75    80            2             7.5 academico
 2 F        19   1.67    65            2             8.3 mercado  
 3 M        19   1.7     90            3             6.9 mercado  
 4 M        22   1.73    87            3             7.1 academico
 5 M        19   1.83    71            2             6.5 mercado  
 6 M        19   1.8     80            3             8.6 mercado  
 7 M        20   1.9     90            2             7.8 academico
 8 F        20   1.6     55            1             8   mercado  
 9 F        24   1.62    55            2             8.2 academico
10 F        18   1.64    60            2             7.3 mercado  
# ... with 54 more rows
\end{verbatim}

\hypertarget{histogramas}{%
\subsection{Histogramas}\label{histogramas}}

Neste primeiro caso, faremos um histograma referente à média ponderada dos alunos. Esse tipo de gráfico é útil para verificar a frequência de uma variável e a sua distribuição.

Para isso, utilizamos a função \texttt{geom\_histogram()}, sendo necessário indicar somente o atributo \texttt{x\ =}, pois o eixo y será construído, automaticamente, a partir da contagem dos valores correspondentes às variáveis \texttt{x}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-260-1} \end{center}

Por padrão, a função define que o histograma apresenta 30 intervalos. Porém, este número não é o ideal para representar os nossos dados. Para redefini-lo, utilizamos o argumento \texttt{bins}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada),}
                 \AttributeTok{bins =} \DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-261-1} \end{center}

Podemos melhorar a aparência do histograma utilizando os argumentos \texttt{color\ =}, para colorir as bordas das barras, e o \texttt{fill\ =}, para colorir o seu interior.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada),}
                 \AttributeTok{bins =} \DecValTok{8}\NormalTok{, }
                 \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
                 \AttributeTok{fill =} \StringTok{"light blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-262-1} \end{center}

\hypertarget{gruxe1fico-de-densidade}{%
\subsection{Gráfico de densidade}\label{gruxe1fico-de-densidade}}

A construção do gráfico de densidade é semelhante ao histograma. Utilizamos a função \texttt{geom\_density()}, atribuindo apenas uma variável contínua ao eixo x, sendo o eixo y construído automaticamente, de acordo com os valores da variável do eixo x. Ademais, podemos preencher seu interior com o argumento \texttt{fill\ =} e alterar a transparência da cor com o argumento \texttt{alpha}, cuja escala vai de 0 a 1, sendo 0 o valor máximo de transparência.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada))}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{fill =} \StringTok{"light green"}\NormalTok{,}
               \AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-263-1} \end{center}

Podemos representar mais de uma densidade em um mesmo gráfico. Basta atribuir uma variável categórica ao argumento \texttt{fill\ =} ou \texttt{color\ =}, a fim de distinguir as densidades.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
           \AttributeTok{fill =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-264-1} \end{center}

\hypertarget{boxplot}{%
\subsection{Boxplot}\label{boxplot}}

Por fim, temos o boxplot, muito útil para observarmos a distribuição de valores de uma variável. Para fazermos os boxplots, utilizamos a função \texttt{geom\_boxplot()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ media\_ponderada))}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-265-1} \end{center}

Nesse primeiro caso, fizemos um boxplot da média ponderada dos alunos, atribuindo os valores da variável no eixo y. Para conferir os valores dos quartis, além da amplitude, podemos utilizar a função \texttt{summary()}. Para calcular a distância interquartil - cujo cálculo se dá pela subtração entre o valor do 3º quartil e do 1º quartil - utilizamos a função \texttt{IQR()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(dados\_alunos}\SpecialCharTok{$}\NormalTok{media\_ponderada)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  5.000   7.000   7.400   7.425   8.000   8.700 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{IQR}\NormalTok{(dados\_alunos}\SpecialCharTok{$}\NormalTok{media\_ponderada)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

Podemos incluir outras variáveis ao nosso boxplot, como, por exemplo, a variável \texttt{futuro}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ futuro,}
           \AttributeTok{y =}\NormalTok{ media\_ponderada))}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-267-1} \end{center}

Neste caso, podemos ver a distribuição da média ponderada dos alunos e alunas de acordo com as perspectivas futuras de cada um. Perceba que a variável categórica \texttt{futuro} foi atribuída ao eixo x.

Agora, caso se queira dividir os boxplots anteriores de acordo com o sexo, podemos atribui-la ao argumento \texttt{fill}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ futuro,}
           \AttributeTok{y =}\NormalTok{ media\_ponderada,}
           \AttributeTok{fill =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-268-1} \end{center}

Assim, podemos observar a distribuição das médias ponderadas de acordo com o sexo e a perspectiva futura.

\hypertarget{juntar-gruxe1ficos-diferentes}{%
\section{Juntar gráficos diferentes}\label{juntar-gruxe1ficos-diferentes}}

Temos a possibilidade de juntar gráficos diferentes em uma mesma apresentação. Para isso, utilizamos o pacote \texttt{patchwork}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"patchwork"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(patchwork)}
\end{Highlighting}
\end{Shaded}

O pacote funciona de maneira bem simples. Para juntarmos gráficos, devemos salvá-los em um objeto e, posteriomente, uni-los com um sinal de \texttt{+}. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Boxplot salvo no objeto "g1"}
\NormalTok{g1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
             \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ futuro,}
                 \AttributeTok{y =}\NormalTok{ media\_ponderada,}
                 \AttributeTok{fill =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}

\CommentTok{\# Gráfico de densidade salvo no objeto "g2"}
\NormalTok{g2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dados\_alunos,}
             \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ altura,}
                 \AttributeTok{fill =}\NormalTok{ sexo))}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{)}

\CommentTok{\# Unindo os gráficos "g1" e "g2"}
\NormalTok{g1 }\SpecialCharTok{+}\NormalTok{ g2}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-271-1} \end{center}

Podemos dispô-los um embaixo do outro com o operador \texttt{/}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g1 }\SpecialCharTok{/}\NormalTok{ g2}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-272-1} \end{center}

Além disso, podemos inserir mais gráficos ao conjunto. Nesse caso, incluiremos o histograma.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dados\_alunos)}\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ media\_ponderada),}
                 \AttributeTok{bins =} \DecValTok{8}\NormalTok{, }
                 \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
                 \AttributeTok{fill =} \StringTok{"light blue"}\NormalTok{)}

\NormalTok{(g1 }\SpecialCharTok{+}\NormalTok{ g2) }\SpecialCharTok{/}\NormalTok{ g3}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-273-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g1 }\SpecialCharTok{+}\NormalTok{ (g2 }\SpecialCharTok{/}\NormalTok{ g3)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-274-1} \end{center}

Assim, dependendo da combinação de operações entre objetos, a partir do pacote \texttt{patchwork}, é possível dispor os gráficos de diferentes formas.

Como visto ao longo deste capítulo, percebemos que o pacote \texttt{ggplot2} possui ferramentas poderosas e versáteis para lidar com gráficos. Há diversas outras funcionalidades presentes no pacote, as quais podem (e devem) ser exploradas. Contudo, neste primeiro momento, o que foi exposto se apresenta como uma base para possibilitar a execução dos primeiros gráficos em R, além de ser a porta de entrada ao leitor para que possa aprofundar e aprimorar seus gráficos de maneira mais independente.

Para os leitores que desejam aprofundar o conhecimento no pacote \texttt{ggplot2}, deixo como recomendação alguns livros, todos disponíveis gratuitamente na \emph{web}:

\begin{itemize}
\item
  \href{https://r-graphics.org/}{R Graphics Cookbook} - Winston Chang;
\item
  \href{https://ggplot2-book.org/}{ggplot2: Elegant Graphics for Data Analysis} - Hadley Wickham;
\item
  \href{https://bookdown.org/content/b298e479-b1ab-49fa-b83d-a57c2b034d49/}{R Gallery Book} - Kyle W. Brown.
\end{itemize}

\hypertarget{mapas}{%
\chapter{Mapas}\label{mapas}}

Em complemento à visualização de dados a partir de gráficos, nesse capítulo, demonstraremos como podemos representá-los em mapas no R. Existem diversos pacotes desenvolvidos pela comunidade do R que tratam do assunto. No caso da confecção de mapas do Brasil, utilizaremos o pacote \texttt{geobr}.

O pacote \texttt{geobr} foi desenvolvido pelo Instituto de Pesquisa Econômica Aplicada (IPEA) \href{https://github.com/ipeaGIT/geobr}{(PEREIRA; GONÇALVES et al., 2019)}. Nele, encontramos uma ampla gama de dados geoespaciais oficiais do Brasil, disponíveis em várias escalas geográficas e por vários anos, com atributos, projeção e topologia harmonizados.

A instalação do pacote \texttt{geobr} é realizada diretamente via GitHub. Essa é uma das formas de se instalar pacotes que não estão presentes no CRAN - a via mais comum para instalar pacotes. Para isso, precisaremos instalar e, posteriormente, carregar o pacote \texttt{devtools} para realizarmos a instalação do \texttt{geobr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(devtools)}
\end{Highlighting}
\end{Shaded}

Uma vez instalado o pacote \texttt{devtools}, procederemos da seguinte forma para instalar o \texttt{geobr}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Instalação do pacote \textasciigrave{}geobr\textasciigrave{}}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"ipeaGIT/geobr"}\NormalTok{, }\AttributeTok{subdir =} \StringTok{"r{-}package"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Carregamento do pacote \textasciigrave{}geobr\textasciigrave{}}
\FunctionTok{library}\NormalTok{(geobr)}
\end{Highlighting}
\end{Shaded}

Dentro da função \texttt{devtools::install\_github()}, inserimos o nome do usuário do GitHub (no caso, \texttt{ipeaGIT}), seguido do nome do repositório (\texttt{geobr}), ambos separados por uma \texttt{/}. Ainda, inserimos um segundo argumento indicando em qual subdiretório está o pacote (\texttt{subdir\ =\ "r-package"}).

A maioria dos pacotes disponibilizados via GitHub contém instruções de como fazer sua instalação, mais especificamente na parte denominada \texttt{README}. Podemos verificar o \texttt{README} do \texttt{geobr} \href{https://github.com/ipeaGIT/geobr\#readme}{clicando aqui}.

Ademais, vale destacar que este material foi desenvolvido a partir da versão 1.6.5999 do pacote \texttt{geobr}, que pode passar por melhorias e incrementos ao longo do tempo.

\hypertarget{funuxe7uxf5es-do-pacote-geobr}{%
\section{\texorpdfstring{Funções do pacote \texttt{geobr}}{Funções do pacote geobr}}\label{funuxe7uxf5es-do-pacote-geobr}}

Para verificarmos todos os conjuntos de dados disponíveis no pacote \texttt{geobr}, utilizamos a função \texttt{list\_geobr()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{list\_geobr}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{view}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering\begingroup\fontsize{16}{18}\selectfont

\begin{tabular}[t]{l|l|l|l}
\hline
function & geography & years & source\\
\hline
`read\_country` & Country & 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_region` & Region & 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_state` & States & 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_meso\_region` & Meso region & 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_micro\_region` & Micro region & 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_intermediate\_region` & Intermediate region & 2017, 2019, 2020 & IBGE\\
\hline
`read\_immediate\_region` & Immediate region & 2017, 2019, 2020 & IBGE\\
\hline
`read\_municipality` & Municipality & 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2005, 2007, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020 & IBGE\\
\hline
`read\_municipal\_seat` & Municipality seats (sedes municipais) & 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2010 & IBGE\\
\hline
`read\_weighting\_area` & Census weighting area (área de ponderação) & 2010 & IBGE\\
\hline
`read\_census\_tract` & Census tract (setor censitário) & 2000, 2010, 2017, 2019, 2020 & IBGE\\
\hline
`read\_statistical\_grid` & Statistical Grid of 200 x 200 meters & 2010 & IBGE\\
\hline
`read\_metro\_area` & Metropolitan areas & 1970, 2001, 2002, 2003, 2005, 2010, 2013, 2014, 2015, 2016, 2017, 2018 & IBGE\\
\hline
`read\_urban\_area` & Urban footprints & 2005, 2015 & IBGE\\
\hline
`read\_amazon` & Brazil's Legal Amazon & 2012 & MMA\\
\hline
`read\_biomes` & Biomes & 2004, 2019 & IBGE\\
\hline
`read\_conservation\_units` & Environmental Conservation Units & 201909 & MMA\\
\hline
`read\_disaster\_risk\_area` & Disaster risk areas & 2010 & CEMADEN and IBGE\\
\hline
`read\_indigenous\_land` & Indigenous lands & 201907, 202103 & FUNAI\\
\hline
`read\_semiarid` & Semi Arid region & 2005, 2017 & IBGE\\
\hline
`read\_health\_facilities` & Health facilities & 2015 & CNES, DataSUS\\
\hline
`read\_health\_region` & Health regions and macro regions & 1991, 1994, 1997, 2001, 2005, 2013 & DataSUS\\
\hline
`read\_neighborhood` & Neighborhood limits & 2010 & IBGE\\
\hline
`read\_schools` & Schools & 2020 & INEP\\
\hline
`read\_comparable\_areas` & Historically comparable municipalities, aka Areas minimas comparaveis (AMCs) & 1872,1900,1911,1920,1933,1940,1950,1960,1970,1980,1991,2000,2010 & IBGE\\
\hline
`read\_urban\_concentrations` & Urban concentration areas (concentrações urbanas) & 2015 & IBGE\\
\hline
`read\_pop\_arrangements` & Population arrangements (arranjos populacioanis) & 2015 & IBGE\\
\hline
\end{tabular}
\endgroup{}
\end{table}

A função \texttt{list\_geobr()} nos retorna um objeto do tipo \emph{data frame}, apresentando como variáveis o nome das funções que contém os conjuntos de dados (\texttt{function}), a abrangência geográfica (\texttt{geography}), os anos presentes (\texttt{years}) e a fonte dos dados (\texttt{source}). A seguir, veremos como utilizar todas essas funções.

\hypertarget{mapa-do-pauxeds}{%
\section{Mapa do país}\label{mapa-do-pauxeds}}

Para acessar o mapa do Brasil, utilizamos a função \texttt{read\_country()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{brasil }\OtherTok{\textless{}{-}} \FunctionTok{read\_country}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}
\FunctionTok{class}\NormalTok{(brasil)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "sf"         "data.frame"
\end{verbatim}

Perceba que a função nos retorna um \emph{data frame} do tipo \texttt{sf} (sigla para \href{https://r-spatial.github.io/sf/articles/sf1.html}{\emph{simple features}}), que, de maneira geral, contém informações geoespaciais as quais são utilizadas para a confecção dos mapas no R.

Assim, utilizaremos o pacote \texttt{ggplot2} como ferramenta para gerar os mapas, a partir da interpretação dos dados geoespaciais do \texttt{geobr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ brasil)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-282-1} \end{center}

Com a função \texttt{ggplot()}, utilizamos a geometria \texttt{geom\_sf()}, que converte os dados \texttt{sf} em mapa.

A mesma lógica que utilizamos para confeccionar gráficos no \texttt{ggplot2} é aplicável aos mapas. A seguir, serão demonstrados alguns exemplos básicos de personalização do mapa anterior.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ brasil,}
          \AttributeTok{fill =} \StringTok{"\#2D3E50"}\NormalTok{,}
          \AttributeTok{color =} \StringTok{"\#FEBF57"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Mapa do Brasil"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"com o pacote geobr"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Longitude"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Latitude"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-283-1} \end{center}

Tanto as escalas, como os sistemas de referência geodésicos utilizados para a confecção dos mapas podem ser conferidos na documentação das funções, utilizando o \texttt{?}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Acessando a documentação da função \textasciigrave{}read\_country()\textasciigrave{} }
\NormalTok{?read\_country}
\end{Highlighting}
\end{Shaded}

\hypertarget{estados}{%
\section{Estados}\label{estados}}

Para representarmos o mapa do Brasil dividido por estados, utilizamos a função \texttt{read\_state()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{simplified =}\NormalTok{ F,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-285-1} \end{center}

A função \texttt{read\_state()} apresenta alguns argumentos importantes para confeccionarmos os mapas. O argumento \texttt{code\_state\ =} é utilizado para especificar qual(is) estados serão considerados para compor o mapa. Se \texttt{code\_state\ =\ "all"}, todos os estados são utilizados. Para selecionar um estado em específico, pode-se utilizar a abreviação do nome do estado (\texttt{abbrev\_state}) ou um código de dois dígitos (\texttt{code\_state}). Tanto as abreviações, como os códigos podem ser consultados no \emph{data frame} da respectiva função.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{view}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{table}
\centering\begingroup\fontsize{16}{18}\selectfont

\begin{tabular}[t]{r|l|l|r|l|l}
\hline
code\_state & abbrev\_state & name\_state & code\_region & name\_region & geom\\
\hline
11 & RO & Rondônia & 1 & Norte & MULTIPOLYGON (((-63.32721 -...\\
\hline
12 & AC & Acre & 1 & Norte & MULTIPOLYGON (((-73.18253 -...\\
\hline
13 & AM & Amazonas & 1 & Norte & MULTIPOLYGON (((-67.32609 2...\\
\hline
14 & RR & Roraima & 1 & Norte & MULTIPOLYGON (((-60.20051 5...\\
\hline
15 & PA & Pará & 1 & Norte & MULTIPOLYGON (((-54.95431 2...\\
\hline
16 & AP & Amapá & 1 & Norte & MULTIPOLYGON (((-51.1797 4....\\
\hline
17 & TO & Tocantins & 1 & Norte & MULTIPOLYGON (((-48.35878 -...\\
\hline
21 & MA & Maranhão & 2 & Nordeste & MULTIPOLYGON (((-45.84073 -...\\
\hline
22 & PI & Piauí & 2 & Nordeste & MULTIPOLYGON (((-41.74605 -...\\
\hline
23 & CE & Ceará & 2 & Nordeste & MULTIPOLYGON (((-41.16703 -...\\
\hline
24 & RN & Rio Grande Do Norte & 2 & Nordeste & MULTIPOLYGON (((-37.25329 -...\\
\hline
25 & PB & Paraíba & 2 & Nordeste & MULTIPOLYGON (((-37.22269 -...\\
\hline
26 & PE & Pernambuco & 2 & Nordeste & MULTIPOLYGON (((-32.39705 -...\\
\hline
27 & AL & Alagoas & 2 & Nordeste & MULTIPOLYGON (((-35.46753 -...\\
\hline
28 & SE & Sergipe & 2 & Nordeste & MULTIPOLYGON (((-37.99245 -...\\
\hline
29 & BA & Bahia & 2 & Nordeste & MULTIPOLYGON (((-39.36446 -...\\
\hline
31 & MG & Minas Gerais & 3 & Sudeste & MULTIPOLYGON (((-41.87545 -...\\
\hline
32 & ES & Espirito Santo & 3 & Sudeste & MULTIPOLYGON (((-41.87545 -...\\
\hline
33 & RJ & Rio De Janeiro & 3 & Sudeste & MULTIPOLYGON (((-41.85946 -...\\
\hline
35 & SP & São Paulo & 3 & Sudeste & MULTIPOLYGON (((-44.90215 -...\\
\hline
41 & PR & Paraná & 4 & Sul & MULTIPOLYGON (((-52.05188 -...\\
\hline
42 & SC & Santa Catarina & 4 & Sul & MULTIPOLYGON (((-48.63865 -...\\
\hline
43 & RS & Rio Grande Do Sul & 4 & Sul & MULTIPOLYGON (((-51.90486 -...\\
\hline
50 & MS & Mato Grosso Do Sul & 5 & Centro Oeste & MULTIPOLYGON (((-56.1037 -1...\\
\hline
51 & MT & Mato Grosso & 5 & Centro Oeste & MULTIPOLYGON (((-54.89485 -...\\
\hline
52 & GO & Goiás & 5 & Centro Oeste & MULTIPOLYGON (((-50.16015 -...\\
\hline
53 & DF & Distrito Federal & 5 & Centro Oeste & MULTIPOLYGON (((-47.57461 -...\\
\hline
\end{tabular}
\endgroup{}
\end{table}

Na subseção \ref{estad}, demonstraremos como trabalhar com os estados de maneira individualizada.

O argumento \texttt{year()} permite selecionar um ano em específico do conjunto de dados. Caso o argumento não seja declarado, por padrão, será a dotado o ano de 2010. Como ilustração, podemos comparar o mapa dos estados do Brasil entre o ano de 1872 e 2020.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mapa dos estados do Brasil em 1872}
\NormalTok{br\_1872 }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{1872}\NormalTok{,}
                      \AttributeTok{simplified =}\NormalTok{ F,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightgray"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"1872"}\NormalTok{)}

\NormalTok{br\_1872}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mapa dos estados do Brasil em 2020}
\NormalTok{br\_2020 }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                      \AttributeTok{simplified =}\NormalTok{ F,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightgray"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2020"}\NormalTok{)}

\NormalTok{br\_2020}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-290-1} \end{center}

Ainda, o argumento \texttt{simplified\ =} trata da resolução do mapa; caso \texttt{simplified\ =\ TRUE}, as bordas do mapa são traçadas de maneira ``aproximada''; por outro lado, caso \texttt{simplified\ =\ FALSE}, as bordas são traçadas de maneira detalhada. Caso o argumento não seja especificado, por padrão, adota-se \texttt{simplified\ =\ TRUE}.

Por fim, o argumento \texttt{showProgress\ =} aceita valores lógicos para mostrar (\texttt{TRUE}) ou não (\texttt{FALSE}) a barra de progresso do download dos dados da função.

\hypertarget{estad}{%
\subsection{Selecionando estados}\label{estad}}

Como citado na seção acima, podemos selecionar um estado em específico a partir da função \texttt{read\_state()}. O exemplo a seguir demonstra a seleção do estado de São Paulo a partir de sua nomenclatura abreviada e pelo seu código de identificação.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Seleção por nomenclatura abreviada}
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"SP"}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2020
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-292-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Seleção por código de identificação}
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \DecValTok{35}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-293-1} \end{center}

Também podemos formar um mapa com mais de um estado. O exemplo a seguir representa a região do MATOPIBA.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"MA"}\NormalTok{, }\StringTok{"TO"}\NormalTok{, }\StringTok{"PI"}\NormalTok{, }\StringTok{"BA"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_state))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"MATOPIBA"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-294-1} \end{center}

Perceba que utilizamos a função \texttt{dplyr::filter()} para filtrar somente as observações referentes aos estados que compõem o MATOPIBA, presentes no \emph{data frame} da função \texttt{read\_state()}.

\hypertarget{leg}{%
\subsection{Adicionando legendas}\label{leg}}

Para adicionar legendas nos mapas, utilizamos a função \texttt{geom\_sf\_text()} como camada adicional ao \texttt{ggplot()}. A seguir, adicionaremos as abreviações dos nomes dos estados como legenda no mapa do Brasil.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state), }\AttributeTok{size =} \FloatTok{1.8}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-295-1} \end{center}

Dentro da função \texttt{geom\_sf\_text()}, declaramos o argumento \texttt{label\ =} dentro da \texttt{aes()}, indicando que, para compor a legenda, serão consideradas as abreviações dos nomes dos estados (\texttt{abbrev\_state}).

\hypertarget{estado-de-um-cep}{%
\subsection{Estado de um CEP}\label{estado-de-um-cep}}

A função \texttt{cep\_to\_state()} nos retorna o estado correspondente a um CEP (Código de Endereçamento Postal). Apresenta o argumento \texttt{cep\ =}, que recebe um valor de 8 dígitos, redigidos no formato ``xxxxx-xxx'' ou em número corrido.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cep\_to\_state}\NormalTok{(}\AttributeTok{cep =} \StringTok{"01525{-}000"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "SP"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cep\_to\_state}\NormalTok{(}\AttributeTok{cep =} \DecValTok{01525000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "SP"
\end{verbatim}

\hypertarget{regiuxf5es}{%
\section{Regiões}\label{regiuxf5es}}

De maneira semelhante aos estados, podemos dividir o mapa do Brasil a partir das regiões geográficas. Para isso, utilizamos a função \texttt{read\_region()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
            \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_region))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Paired"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Região"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-297-1} \end{center}

\hypertarget{regiuxf5es-especuxedficas}{%
\subsection{Regiões específicas}\label{regiuxf5es-especuxedficas}}

Para selecionar uma região específica, podemos utilizar, novamente, a função \texttt{dplyr::filter()}. No exemplo a seguir, filtraremos a região nordeste.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
            \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_region }\SpecialCharTok{==} \StringTok{"Nordeste"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-298-1} \end{center}

\hypertarget{regiuxf5es-com-os-estados}{%
\subsection{Regiões com os estados}\label{regiuxf5es-com-os-estados}}

Para gerarmos o mapa de uma região específica delimitada pelos estados, devemos filtrar as observações que desejamos. Como exemplo, filtraremos as observações referentes à região \texttt{Nordeste}, presentes na coluna \texttt{name\_region}, dentro do \emph{data frame} contido na função \texttt{read\_state()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
           \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
           \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_region }\SpecialCharTok{==} \StringTok{"Nordeste"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_state))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Paired"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Estados Nordestinos"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-299-1} \end{center}

\hypertarget{mesorregiuxf5es-e-microrregiuxf5es}{%
\section{Mesorregiões e Microrregiões}\label{mesorregiuxf5es-e-microrregiuxf5es}}

Para representarmos as mesorregiões e as microrregiões do Brasil, utilizamos as funções \texttt{read\_meso\_region()} e \texttt{read\_micro\_region()}, respectivamente. A lógica dessas funções segue a mesma das explicadas acima, apenas alterando o argumento \texttt{code\_state\ =} para \texttt{code\_meso\ =} e \texttt{code\_micro\ =}, respectivamente.

\hypertarget{mesorregiuxf5es}{%
\subsection{Mesorregiões}\label{mesorregiuxf5es}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_meso\_region}\NormalTok{(}\AttributeTok{code\_meso =} \StringTok{"all"}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                 \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-300-1} \end{center}

\hypertarget{selecionando-mesorregiuxf5es}{%
\subsubsection{Selecionando Mesorregiões}\label{selecionando-mesorregiuxf5es}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as mesorregiões do estado de Minas Gerais}
\FunctionTok{read\_meso\_region}\NormalTok{(}\AttributeTok{code\_meso =} \StringTok{"MG"}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                 \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2020
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-302-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as mesorregiões dos estados do Rio de Janeiro e Espírito Santo}
\FunctionTok{read\_meso\_region}\NormalTok{(}\AttributeTok{code\_meso =} \StringTok{"all"}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                 \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"RJ"}\NormalTok{, }\StringTok{"ES"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ abbrev\_state))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Estados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-303-1} \end{center}

Para selecionar uma mesorregião específica de um estado, devemos colocar o seu código de identificação no argumento \texttt{code\_meso\ =}. Lembrando que todos os códigos de identificação podem ser conferidos no \emph{data frame} da respectiva função.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando apenas uma mesorregião {-} Metropolitana de São Paulo}
\FunctionTok{read\_meso\_region}\NormalTok{(}\AttributeTok{code\_meso =} \DecValTok{3515}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                 \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-304-1} \end{center}

\hypertarget{regiuxf5es-geogruxe1ficas-intermediuxe1rias}{%
\subsubsection{Regiões geográficas intermediárias}\label{regiuxf5es-geogruxe1ficas-intermediuxe1rias}}

As regiões geográficas intermediárias são parte de uma nova divisão geográfica, criada em 2017, pelo IBGE. Foram concebidas para substituir as mesorregiões. No \texttt{geobr}, utilizamos a função \texttt{read\_intermediate\_region()} para representá-las. Essa função segue a mesma lógica exposta para as mesorregiões.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_intermediate\_region}\NormalTok{(}\AttributeTok{code\_intermediate =} \StringTok{"all"}\NormalTok{,}
                         \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                         \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-305-1} \end{center}

\hypertarget{microrregiuxf5es}{%
\subsection{Microrregiões}\label{microrregiuxf5es}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_micro\_region}\NormalTok{(}\AttributeTok{code\_micro =} \StringTok{"all"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-306-1} \end{center}

\hypertarget{selecionando-microrregiuxf5es}{%
\subsubsection{Selecionando Microrregiões}\label{selecionando-microrregiuxf5es}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as microrregiões do estado do Rio Grande do Sul}
\FunctionTok{read\_micro\_region}\NormalTok{(}\AttributeTok{code\_micro =} \StringTok{"RS"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2020
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-308-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as microrregiões dos estados de Santa Catarina e Paraná}
\FunctionTok{read\_micro\_region}\NormalTok{(}\AttributeTok{code\_micro =} \StringTok{"all"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"SC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ abbrev\_state))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Estados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-309-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando apenas uma microrregião {-} Chapecó/SC}
\FunctionTok{read\_micro\_region}\NormalTok{(}\AttributeTok{code\_micro =} \DecValTok{42002}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-310-1} \end{center}

\hypertarget{regiuxf5es-geogruxe1ficas-imediatas}{%
\subsubsection{Regiões geográficas imediatas}\label{regiuxf5es-geogruxe1ficas-imediatas}}

Assim como as regiões geográficas intermediárias, as regiões geográficas imediatas são parte de uma nova divisão geográfica, criada em 2017, pelo IBGE. Foram concebidas para substituir as microrregiões. No \texttt{geobr}, utilizamos a função \texttt{read\_immediate\_region()} para representá-las. Essa função segue a mesma lógica exposta para as microrregiões.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_immediate\_region}\NormalTok{(}\AttributeTok{code\_immediate =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-311-1} \end{center}

\hypertarget{municuxedpios}{%
\section{Municípios}\label{municuxedpios}}

Para representarmos os municípios do Brasil, utilizamos a função \texttt{read\_municipality()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-312-1} \end{center}

\hypertarget{funuxe7uxe3o-lookup_muni}{%
\subsection{\texorpdfstring{Função \texttt{lookup\_muni()}}{Função lookup\_muni()}}\label{funuxe7uxe3o-lookup_muni}}

A função \texttt{lookup\_muni()} nos auxilia a encontrar informações referentes a códigos, nomenclaturas e classificações de um município em específico. Para isso, podemos indicar o nome de um município no argumento \texttt{name\_muni\ =} para buscar suas informações.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Buscando informações sobre o município de Piracicaba/SP}
\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{name\_muni =} \StringTok{"Piracicaba"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni  name_muni code_state name_state abbrev_state code_micro
3700   3538709 Piracicaba         35  São Paulo           SP      35028
     name_micro code_meso  name_meso code_immediate name_immediate
3700 Piracicaba      3506 Piracicaba         350040     Piracicaba
     code_intermediate name_intermediate
3700              3510          Campinas
\end{verbatim}

Da mesma forma, podemos buscar informações dos municípios a partir do código de identificação, utilizando o argumento \texttt{code\_muni\ =}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Buscando informações sobre o município de código 3509502}
\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{code\_muni =} \DecValTok{3509502}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni name_muni code_state name_state abbrev_state code_micro
3375   3509502  Campinas         35  São Paulo           SP      35032
     name_micro code_meso name_meso code_immediate name_immediate
3375   Campinas      3507  Campinas         350038       Campinas
     code_intermediate name_intermediate
3375              3510          Campinas
\end{verbatim}

No exemplo acima, verificamos que o código 3509502 é respectivo ao município de Campinas/SP.

\hypertarget{selecionando-municuxedpios}{%
\subsection{Selecionando Municípios}\label{selecionando-municuxedpios}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os municípios do estado de São Paulo}
\FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"SP"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2020
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-316-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando um municípios em específico {-} Piracicaba/SP}
\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{name\_muni =} \StringTok{"Piracicaba"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni  name_muni code_state name_state abbrev_state code_micro
3700   3538709 Piracicaba         35  São Paulo           SP      35028
     name_micro code_meso  name_meso code_immediate name_immediate
3700 Piracicaba      3506 Piracicaba         350040     Piracicaba
     code_intermediate name_intermediate
3700              3510          Campinas
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \DecValTok{3538709}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-317-1} \end{center}

\hypertarget{mapa-do-brasil-com-as-capitais}{%
\subsection{Mapa do Brasil com as capitais}\label{mapa-do-brasil-com-as-capitais}}

Podemos representar as capitais de cada estado no mapa do país. Para tanto, utilizamos as informações referentes aos municípios para construir tal mapa.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Carregando dados dos estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\CommentTok{\# Carregando dados dos municípios}
\NormalTok{municipios }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                                \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                                \AttributeTok{showProgress =}\NormalTok{ F)}

\CommentTok{\# Criando data frame com as capitais de cada estado}
\NormalTok{cap }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{name\_state =} \FunctionTok{c}\NormalTok{(}\StringTok{"Acre"}\NormalTok{, }\StringTok{"Alagoas"}\NormalTok{, }\StringTok{"Amapá"}\NormalTok{, }\StringTok{"Amazônas"}\NormalTok{, }\StringTok{"Bahia"}\NormalTok{, }\StringTok{"Ceará"}\NormalTok{, }\StringTok{"Espírito Santo"}\NormalTok{, }\StringTok{"Goiás"}\NormalTok{, }\StringTok{"Maranhão"}\NormalTok{, }\StringTok{"Mato Grosso"}\NormalTok{, }\StringTok{"Mato Grosso do Sul"}\NormalTok{, }\StringTok{"Minas Gerais"}\NormalTok{, }\StringTok{"Pará"}\NormalTok{, }\StringTok{"Paraíba"}\NormalTok{, }\StringTok{"Paraná"}\NormalTok{, }\StringTok{"Pernambuco"}\NormalTok{, }\StringTok{"Piauí"}\NormalTok{, }\StringTok{"Rio de Janeiro"}\NormalTok{, }\StringTok{"Rio Grande do Norte"}\NormalTok{, }\StringTok{"Rio Grande do Sul"}\NormalTok{, }\StringTok{"Rondônia"}\NormalTok{, }\StringTok{"Roraima"}\NormalTok{, }\StringTok{"Santa Catarina"}\NormalTok{, }\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"Sergipe"}\NormalTok{, }\StringTok{"Tocantins"}\NormalTok{, }\StringTok{"Distrito Federal"}\NormalTok{),}
  
  \AttributeTok{name\_muni =} \FunctionTok{c}\NormalTok{(}\StringTok{"Rio Branco"}\NormalTok{, }\StringTok{"Maceió"}\NormalTok{, }\StringTok{"Macapá"}\NormalTok{, }\StringTok{"Manaus"}\NormalTok{, }\StringTok{"Salvador"}\NormalTok{, }\StringTok{"Fortaleza"}\NormalTok{, }\StringTok{"Vitória"}\NormalTok{, }\StringTok{"Goiânia"}\NormalTok{, }\StringTok{"São Luís"}\NormalTok{, }\StringTok{"Cuiabá"}\NormalTok{, }\StringTok{"Campo Grande"}\NormalTok{, }\StringTok{"Belo Horizonte"}\NormalTok{, }\StringTok{"Belém"}\NormalTok{, }\StringTok{"João Pessoa"}\NormalTok{, }\StringTok{"Curitiba"}\NormalTok{, }\StringTok{"Recife"}\NormalTok{, }\StringTok{"Teresina"}\NormalTok{, }\StringTok{"Rio De Janeiro"}\NormalTok{, }\StringTok{"Natal"}\NormalTok{, }\StringTok{"Porto Alegre"}\NormalTok{, }\StringTok{"Porto Velho"}\NormalTok{, }\StringTok{"Boa Vista"}\NormalTok{, }\StringTok{"Florianópolis"}\NormalTok{, }\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"Aracaju"}\NormalTok{, }\StringTok{"Palmas"}\NormalTok{, }\StringTok{"Brasília"}\NormalTok{)}
\NormalTok{)}

\CommentTok{\# Selecionando os municípios referentes às capitais no banco de dados dos municípios}

\NormalTok{capitais }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{inner\_join}\NormalTok{(municipios, cap)}


\CommentTok{\# Plotando capitais no mapa do Brasil}
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ capitais, }\AttributeTok{fill =} \StringTok{"red"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-318-1} \end{center}

Primeiramente, para a confecção do mapa anterior, carregamos os bancos de dados dos estados e dos municípios, respectivos às funções \texttt{read\_state()} e \texttt{read\_municipality()}.

Em seguida, criamos um \emph{data frame} denominado \texttt{cap}, contendo as capitais de cada estado, para, posteriormente, selecionar apenas os municípios respectivos às capitais. Para isso, utilizamos a função \texttt{dplyr::inner\_join()} que selecionou apenas as capitais presentes no banco de dados do objeto \texttt{municipios}, baseado na correspondência com o \emph{data frame} \texttt{cap}.

Por fim, para construir o mapa, foram utilizadas duas geometrias (\texttt{geom\_sf()}). A primeira é relativa ao mapa dos estados do Brasil; já a segunda, às capitais dos estados. Portanto, para unir dois mapas distintos, devemos utilizar mais de uma geometria, cada qual correspondente à respectiva base de dados.

Contudo, perceba que as capitais foram representadas a partir dos polígonos que delimitam suas áreas. Para representá-las mais adequadamente, podemos criar apenas pontos no mapa que indiquem suas localizações.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ capitais,}
             \FunctionTok{aes}\NormalTok{(}\AttributeTok{geometry =}\NormalTok{ geom),}
             \AttributeTok{stat =} \StringTok{"sf\_coordinates"}\NormalTok{,}
             \AttributeTok{color =} \StringTok{"red"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-319-1} \end{center}

Para isso, na geometria referente às capitais, substituimos a \texttt{geom\_sf()} por \texttt{geom\_point()}, declarando os argumentos \texttt{stat\ =\ "sf\_coordinates"} e \texttt{geometry\ =\ geom} dentro do \texttt{aes()}, ambos para indicar que os dados considerados estão no formato \texttt{sf} e que desejamos representá-los por pontos no mapa.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ capitais,}
             \FunctionTok{aes}\NormalTok{(}\AttributeTok{geometry =}\NormalTok{ geom),}
             \AttributeTok{stat =} \StringTok{"sf\_coordinates"}\NormalTok{,}
             \AttributeTok{color =} \StringTok{"red"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados,}
               \FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state),}
               \AttributeTok{size =} \DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ capitais,}
               \FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name\_muni),}
               \AttributeTok{size =} \DecValTok{2}\NormalTok{,}
               \AttributeTok{nudge\_y =} \FloatTok{0.7}\NormalTok{,}
               \AttributeTok{nudge\_x =} \DecValTok{1}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-320-1} \end{center}

Para inserir legendas com o nome das capitais e as abreviações dos nomes dos estados, utilizamos a função \texttt{geom\_sf\_text()}, como demonstrado na subseção \ref{leg}. Perceba que foram utilizadas duas \texttt{geom\_sf\_text()}, uma respectiva às abreviações dos estados e a outra, ao nome das capitais. Os argumentos \texttt{nudge\_y\ =} e \texttt{nudge\_x\ =} servem para reordenar o posicionamento das legendas no mapa, cada qual referente ao eixo vertical e horizontal, respectivamente.

\hypertarget{sedes-municipais}{%
\subsection{Sedes municipais}\label{sedes-municipais}}

A função \texttt{read\_municipal\_seat()} nos retorna as prefeituras das cidades entre os anos de 1872 e 2010. Por definição, a prefeitura é uma sede municipal do poder executivo municipal.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_municipal\_seat}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                    \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-321-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as prefeituras do estado de São Paulo}
\FunctionTok{read\_municipal\_seat}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                    \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"SP"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-322-1} \end{center}

Perceba que essa função nos retorna pontos no mapa, diferentemente dos exemplos anteriores, que nos retornavam polígonos. Essa diferença pode ser percebida a partir da classe da coluna \texttt{geom}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Verificando a classe da coluna \textasciigrave{}geom\textasciigrave{} da função \textasciigrave{}read\_municipal\_seat()\textasciigrave{}}
\NormalTok{prefeituras }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipal\_seat}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F)}
\FunctionTok{class}\NormalTok{(prefeituras}\SpecialCharTok{$}\NormalTok{geom)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "sfc_POINT" "sfc"      
\end{verbatim}

Note que a classe da coluna \texttt{geom} da função \texttt{read\_municipal\_seat()} é do tipo \texttt{sfc\_POINT}, ou seja, uma classe que nos retorna pontos nos mapas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Verificando a classe da coluna \textasciigrave{}geom\textasciigrave{} da função \textasciigrave{}read\_municipality()\textasciigrave{}}
\NormalTok{municipios }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                                \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                                \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{class}\NormalTok{(municipios}\SpecialCharTok{$}\NormalTok{geom)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "sfc_MULTIPOLYGON" "sfc"             
\end{verbatim}

Por outro lado, a classe da coluna \texttt{geom} da função \texttt{read\_municipality()} é do tipo \texttt{sfc\_MULTIPOLYGON}, portanto, nos retorna polígonos para formar os mapas.

Assim, podemos unir, em um único mapa, os municípios (\texttt{read\_municipality()}) e as prefeituras (\texttt{read\_municipal\_seat()}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os municípios do estado de São Paulo}
\NormalTok{municipios\_sp }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"SP"}\NormalTok{,}
                                   \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F)}


\CommentTok{\# Selecionando as prefeituras do estado de São Paulo}
\NormalTok{prefeituras\_sp }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipal\_seat}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"SP"}\NormalTok{)}


\CommentTok{\# Plotando municípios e prefeituras}
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_sp, }\AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{, }\AttributeTok{color =} \StringTok{"lightgrey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ prefeituras\_sp, }\AttributeTok{size =} \FloatTok{1.3}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
Using year 2010
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-326-1} \end{center}

A primeira geometria é correspondente ao mapa dos municípios de São Paulo, que foi sobreposto pela segunda geometria, referente ao mapa das prefeituras dos municípios de São Paulo.

\hypertarget{bairrossubdistritosdistritos}{%
\section{Bairros/Subdistritos/Distritos}\label{bairrossubdistritosdistritos}}

A função \texttt{read\_neighborhood()} retorna os limites de bairros/subdistritos/distritos de 720 municípios brasileiros. Os dados são baseados em agregações dos setores censitários do censo brasileiro. Atualmente, apenas dados de 2010 estão disponíveis.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_neighborhood}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                  \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-327-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os limites dos bairros do município de Piracicaba/SP}
\FunctionTok{read\_neighborhood}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                  \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(name\_muni }\SpecialCharTok{==} \StringTok{"Piracicaba"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-328-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(gghighlight)}

\CommentTok{\# Selecionando os limites dos bairros do município de Piracicaba/SP, destacando o bairro Agronomia}
\FunctionTok{read\_neighborhood}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                  \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(name\_muni }\SpecialCharTok{==} \StringTok{"Piracicaba"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
\NormalTok{  gghighlight}\SpecialCharTok{::}\FunctionTok{gghighlight}\NormalTok{(name\_neighborhood }\SpecialCharTok{==} \StringTok{"Agronomia"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name\_neighborhood), }\AttributeTok{nudge\_y =} \FloatTok{0.003}\NormalTok{)}\SpecialCharTok{+}  
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-329-1} \end{center}

No mapa acima, construímos o mapa com os bairros de Piracicaba/SP, destacando o bairro Agronomia - onde se localiza a ESALQ/USP - utilizando a função \texttt{gghighlight::gghighlight()}.

\hypertarget{regiuxf5es-metropolitanas}{%
\section{Regiões Metropolitanas}\label{regiuxf5es-metropolitanas}}

A função \texttt{read\_metro\_area()} retorna as regiões metropolitanas do Brasil. Essas regiões são definidas a partir de legislações estaduais.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_metro\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2018}\NormalTok{,}
                \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-330-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adicionando as regiões metropolitanas ao mapa do Brasil, dividido por estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{reg\_metrop }\OtherTok{\textless{}{-}} \FunctionTok{read\_metro\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2018}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ reg\_metrop, }\AttributeTok{fill =} \StringTok{"orange"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-331-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as regiões metropolitanas do Rio de Janeiro}
\NormalTok{rj }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"RJ"}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                 \AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{rj\_metrop }\OtherTok{\textless{}{-}} \FunctionTok{read\_metro\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2018}\NormalTok{,}
                             \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"RJ"}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ rj)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ rj\_metrop, }\AttributeTok{fill =} \StringTok{"orange"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2019
\end{verbatim}

\begin{verbatim}
Using year 2018
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-333-1} \end{center}

\hypertarget{uxe1reas-urbanas}{%
\section{Áreas urbanas}\label{uxe1reas-urbanas}}

A função \texttt{read\_urban\_area()} retorna as áreas urbanas do Brasil nos anos de 2005 e 2015, segundo a metodologia do IBGE. Informações adicionais sobre a metodologia utilizada estão disponíveis em: \url{https://biblioteca.ibge.gov.br/visualizacao/livros/liv100639.pdf}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_urban\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-334-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adicionando as áreas ubanas ao mapa do Brasil, dividido por estados}

\DocumentationTok{\#\# Estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\DocumentationTok{\#\# 2005}
\NormalTok{urb\_2005 }\OtherTok{\textless{}{-}} \FunctionTok{read\_urban\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2005}\NormalTok{,}
                            \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2005"}\NormalTok{)}

\NormalTok{urb\_2005}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# 2015}
\NormalTok{urb\_2015 }\OtherTok{\textless{}{-}} \FunctionTok{read\_urban\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                            \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2015"}\NormalTok{)}

\NormalTok{urb\_2015}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-336-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as áreas urbanas de São Paulo em 2015}

\DocumentationTok{\#\# Selecionando os códigos dos municípios de SP}
\NormalTok{municipios\_sp }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"SP"}\NormalTok{,}
                                   \AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{code\_muni\_sp }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{code\_muni =}\NormalTok{ municipios\_sp}\SpecialCharTok{$}\NormalTok{code\_muni)}


\DocumentationTok{\#\# Carregando os dados das áreas urbanas}
\NormalTok{urb }\OtherTok{\textless{}{-}} \FunctionTok{read\_urban\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                       \AttributeTok{showProgress =}\NormalTok{ F)}


\DocumentationTok{\#\# Selecionando os códigos das áreas urbanas de SP}
\NormalTok{urb\_sp }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(urb, code\_muni\_sp)}


\DocumentationTok{\#\# Plotando as áreas urbanas de SP}
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_sp, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ urb\_sp, }\AttributeTok{color =} \StringTok{"\#F8766D"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2015
Using year 2015
\end{verbatim}

\begin{verbatim}
Joining, by = "code_muni"
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-338-1} \end{center}

\hypertarget{uxe1reas-muxednimas-comparuxe1veis-amcs}{%
\section{Áreas mínimas comparáveis (AMCs)}\label{uxe1reas-muxednimas-comparuxe1veis-amcs}}

A função \texttt{read\_comparable\_areas()} traz os dados das Áreas mínimas comparáveis (AMCs) dos municípios. Estes dados são referentes a área agregada do menor número de municípios necessários para que as comparações intertemporais sejam geograficamente consistentes.

Os dados estão disponíveis para qualquer combinação de anos censitários entre 1872 e 2010. Esses conjuntos de dados são gerados com base no código \emph{Stata}, originalmente desenvolvido por \href{https://www.scielo.br/j/ee/a/d87GfsmvZGhsjTQPLpb8hBJ/?lang=en}{Philipp Ehrl (2017)}, sendo convertido para a linguagem R pela equipe desenvolvedora do pacote \texttt{geobr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_comparable\_areas}\NormalTok{(}\AttributeTok{start\_year =} \DecValTok{1980}\NormalTok{,}
                      \AttributeTok{end\_year =} \DecValTok{2010}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-339-1} \end{center}

Esta função recebe os argumentos \texttt{start\_year\ =} e \texttt{end\_year\ =} para indicar o ano inicial e final, respectivamente, como referência do período a ser considerado.

Como resultado, obtem-se um código da área mínima comparável (\texttt{code\_amc}) e uma lista com código(s) de municípios (\texttt{list\_code\_muni\_2010}) respectivos à área mínima comparável do período em questão.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{amc }\OtherTok{\textless{}{-}} \FunctionTok{read\_comparable\_areas}\NormalTok{(}\AttributeTok{start\_year =} \DecValTok{1980}\NormalTok{,}
                             \AttributeTok{end\_year =} \DecValTok{2010}\NormalTok{,}
                             \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(code\_amc }\SpecialCharTok{==} \DecValTok{1021}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Área mínima comparável }\SpecialCharTok{\textbackslash{}n}\StringTok{1980"}\NormalTok{, }\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}


\NormalTok{amc}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{muni }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                          \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(code\_muni }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1301001}\NormalTok{,}\DecValTok{1301951}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name\_muni))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Municípios }\SpecialCharTok{\textbackslash{}n}\StringTok{2010"}\NormalTok{, }\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}

\NormalTok{muni}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-341-1} \end{center}

O mapa acima representa a área mínima comparável dos municípios de Carauari e Itamarati (AM), no período entre 1980 e 2010.

\hypertarget{mapas-temuxe1ticos}{%
\section{Mapas temáticos}\label{mapas-temuxe1ticos}}

Depois de apresentadas algumas das funções presentes no pacote \texttt{geobr}, demonstraremos alguns exemplos aplicados utilizando mapas em conjunto à bases de dados.

\hypertarget{censo-agropecuuxe1rio-2006-e-2017}{%
\subsection{Censo agropecuário 2006 e 2017}\label{censo-agropecuuxe1rio-2006-e-2017}}

Para tanto, utilizaremos os dados dos \href{https://www.ibge.gov.br/estatisticas/economicas/agricultura-e-pecuaria/21814-2017-censo-agropecuario.html?=\&t=destaques}{Censos Agropecuários} de 2006 e 2017, realizados pelo Instituto Brasileiro de Geografia e Estatística (IBGE). Dentre as diversas informações que o censo coleta, iremos utilizar a área e o número de estabelecimentos agropecuários em 2006 e 2017, para os estados brasileiros e os municípios de Mato Grosso.

Os dados foram coletados do Sistema IBGE de Recuperação Automática (SIDRA), a partir de duas fontes. Para 2006, utilizou-se a \href{https://sidra.ibge.gov.br/tabela/263}{Tabela 263} e para 2017, a \href{https://sidra.ibge.gov.br/tabela/6754}{Tabela 6754}.

Para fazer o \emph{download} dos dados compilados e processados, \href{https://github.com/gustavojy/ApostilaCD-R/blob/main/dados_zip/dados_mapa.zip?raw=true}{clique aqui}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{censo\_agro\_06\_17 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"dados\_mapa/DADOS\_CENSO\_AGROPEC.xlsx"}\NormalTok{)}

\FunctionTok{glimpse}\NormalTok{(censo\_agro\_06\_17)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Rows: 195
Columns: 6
$ nivel         <chr> "UF", "UF", "UF", "UF", "UF", "UF", "UF", "UF", "UF", "U~
$ cod           <dbl> 11, 12, 13, 14, 15, 16, 17, 21, 22, 23, 24, 25, 26, 27, ~
$ localidade    <chr> "Rondônia", "Acre", "Amazonas", "Roraima", "Pará", "Amap~
$ n_estab       <dbl> 87078, 29483, 66784, 10310, 222029, 3527, 56567, 287039,~
$ area_estab_ha <dbl> 8433868, 3528543, 3668753, 1717532, 22925331, 873789, 14~
$ ano           <dbl> 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 20~
\end{verbatim}

A base de dados apresenta 195 observações e 6 variáveis, sendo elas: o nível geográfico (\texttt{nivel}), podendo ser um estado (\texttt{UF}) ou um município (\texttt{MU}); os códigos de identificação dos locais (\texttt{cod}); a \texttt{localidade}, seja dos estados brasileiros ou dos municípios de Mato Grosso; os anos presentes, no caso, 2006 e 2017; e os valores do número de estabelecimentos (\texttt{n\_estab}) e da área (\texttt{area\_estab\_ha}), em hectares.

\hypertarget{estados-1}{%
\subsubsection*{Estados}\label{estados-1}}
\addcontentsline{toc}{subsubsection}{Estados}

Nessa etapa, iremos fazer um mapa coroplético dos estados. Um mapa coroplético é um tipo de mapa temático que representa uma superfície estatística por meio de áreas simbolizadas com cores, sombreamentos ou padrões de acordo com uma escala que representa a proporcionalidade da variável estatística. Nesse caso, iremos utilizar o número e as respectivas áreas dos estabelecimentos agropecuários, em 2006 e 2017 para criarmos o nosso mapa.

Primeiramente, iremos realizar algumas mudanças na base de dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{censo\_estados }\OtherTok{\textless{}{-}}\NormalTok{ censo\_agro\_06\_17 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(nivel }\SpecialCharTok{==} \StringTok{"UF"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_estab\_1000 =}\NormalTok{ n\_estab}\SpecialCharTok{/}\DecValTok{1000}\NormalTok{,}
         \AttributeTok{area\_estab\_100mil\_ha =}\NormalTok{ area\_estab\_ha}\SpecialCharTok{/}\DecValTok{100000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(cod, localidade, ano, n\_estab\_1000, area\_estab\_100mil\_ha) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(n\_estab\_1000, area\_estab\_100mil\_ha),}
               \AttributeTok{names\_to =} \StringTok{"var"}\NormalTok{,}
               \AttributeTok{values\_to =} \StringTok{"valores"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Na função \texttt{mutate()}, convertemos os valores de número de estabelecimentos para mil estabelecimentos e a área, para 100 mil hectares. Posteriormente, selecionamos as variáveis de interesse com a \texttt{select()} e realizamos a pivotagem das variáveis relativas aos estabelecimentos e áreas para as colunas \texttt{var} e \texttt{valores}.

Agora, precisamos carregar os dados geográficos dos estados a partir da função \texttt{geobr::read\_state()}, como visto na seção \ref{estados}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mapa\_estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{, }\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{glimpse}\NormalTok{(mapa\_estados)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Rows: 27
Columns: 6
$ code_state   <dbl> 11, 12, 13, 14, 15, 16, 17, 21, 22, 23, 24, 25, 26, 27, 2~
$ abbrev_state <chr> "RO", "AC", "AM", "RR", "PA", "AP", "TO", "MA", "PI", "CE~
$ name_state   <chr> "Rondônia", "Acre", "Amazonas", "Roraima", "Pará", "Amapá~
$ code_region  <dbl> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, ~
$ name_region  <chr> "Norte", "Norte", "Norte", "Norte", "Norte", "Norte", "No~
$ geom         <MULTIPOLYGON [°]> MULTIPOLYGON (((-63.32721 -..., MULTIPOLYGON~
\end{verbatim}

Tendo os dados do censo agropecuário, precisamos juntá-los aos dados geográficos em um único \emph{data frame}, para criarmos o mapa temático. Para isso, utilizaremos a função \texttt{dplyr::full\_join()}, tendo como base as colunas \texttt{name\_state} e \texttt{code\_state}.

Portanto, antes de uni-las, iremos modificar os nomes das colunas do banco de dados referente ao censo, a fim padronizar as nomenclaturas e possibilitar a utilização da função de junção dos bancos de dados.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Modificando o nome das colunas do bando de dados do censo}
\NormalTok{censo\_estados }\OtherTok{\textless{}{-}}\NormalTok{ censo\_estados }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"name\_state"} \OtherTok{=}\NormalTok{ localidade,}
         \StringTok{"code\_state"} \OtherTok{=}\NormalTok{ cod)}

\CommentTok{\# Juntando os bancos de dados}
\NormalTok{dados\_mapa\_estados }\OtherTok{\textless{}{-}} \FunctionTok{full\_join}\NormalTok{(mapa\_estados, censo\_estados, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"name\_state"}\NormalTok{, }\StringTok{"code\_state"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Feito isso, iniciaremos a confecção dos mapas, começando pelos dados do censo agropecuário de 2006.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2006 {-} Nº de estabelecimentos}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==} \DecValTok{2006}\NormalTok{,}
\NormalTok{         var }\SpecialCharTok{==} \StringTok{"n\_estab\_1000"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-346-1} \end{center}

O mapa coroplético acima representa o número de estabelecimentos agropecuários, em 2006, de acordo com os estados. Para a sua confecção, primeiramente, filtramos o ano de 2006 e a variável relativa ao número de estabelecimentos (\texttt{n\_estab\_1000}). Em seguida, dentro do \texttt{aes()} de geometria \texttt{geom\_sf()} definimos a coluna de \texttt{valores} como parâmetro do argumento \texttt{fill\ =}, ou seja, os valores relativos ao número de estabelecimentos agropecuários serão preenchidos no mapa, de acordo com o estado.

Assim, de maneira bem simples, podemos confeccionar mapas coropléticos a partir do \texttt{geobr}, junto a base de dados de interesse. A seguir, demontraremos como melhorar a estética dos mapas

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2006 {-} Nº de estabelecimentos}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==} \DecValTok{2006}\NormalTok{,}
\NormalTok{         var }\SpecialCharTok{==} \StringTok{"n\_estab\_1000"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{direction =} \DecValTok{0}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{800}\NormalTok{),}
                       \AttributeTok{name =} \StringTok{"Nº estabelecimentos (por 1000 und.)"}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{3}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{12}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{,}
                         \AttributeTok{title.position =} \StringTok{\textquotesingle{}top\textquotesingle{}}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2006"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Número de estabelecimentos agropecuários por estado, a cada 1000 unidades"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2006"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{15}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{10}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{8}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{7}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.88}\NormalTok{, }\FloatTok{0.12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-347-1} \end{center}

A função \texttt{scale\_fill\_distiller()} define a paleta de cores a serem utilizadas, bem como os parâmetros referentes à legenda. A \texttt{labs()} permite inserir rótulos ao mapa, seja o título, subtítulo, fonte, dentre outros. Também definimos a temática estética do mapa ao definir o tamanho de letras e posicionamentos no mapa.

O mapa a seguir segue a mesma lógica do anterior, porém, representando a área dos estabelecimentos agropecuários e utilizando a paleta de cores da função \texttt{scale\_fill\_gradient2()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2006 {-} área dos estabelecimentos}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==} \DecValTok{2006}\NormalTok{,}
\NormalTok{         var }\SpecialCharTok{==} \StringTok{"area\_estab\_100mil\_ha"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{550}\NormalTok{),}
                       \AttributeTok{name =} \StringTok{"Área estabelecimentos (por 100 mil ha)"}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{3}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{10}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{,}
                         \AttributeTok{title.position =} \StringTok{\textquotesingle{}top\textquotesingle{}}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2006"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Área dos estabelecimentos agropecuários por estado, a cada 100 mil hectares"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2006"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{15}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{10}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{8}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{7}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.88}\NormalTok{, }\FloatTok{0.12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-348-1} \end{center}

Também podemos juntar dois mapas tamáticos. No exemplo a seguir, uniremos o mapa do número de estabelecimentos com a área, de acordo com o censo agropecuário de 2006.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2006 {-} Nº estabelecimentos e área}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==} \DecValTok{2006}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{var,}
             \AttributeTok{labeller =} \FunctionTok{as\_labeller}\NormalTok{(}
               \FunctionTok{c}\NormalTok{(}\AttributeTok{area\_estab\_100mil\_ha =} \StringTok{"Área estabelecimentos"}\NormalTok{,}
                 \AttributeTok{n\_estab\_1000 =} \StringTok{"Nº estabelecimentos"}\NormalTok{)))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{direction =} \DecValTok{0}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{800}\NormalTok{),}
                       \AttributeTok{name =} \StringTok{"Quantidade e Área estabelecimentos"}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{3}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{11}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{,}
                         \AttributeTok{title.position =} \StringTok{\textquotesingle{}top\textquotesingle{}}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2006"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Quantidade e área de estabelecimentos agropecuários, por estado"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2006"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{15}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{2}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{11}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \FloatTok{2.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{8}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.49}\NormalTok{, }\FloatTok{0.06}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-349-1} \end{center}

Para isso, utilizamos a função \texttt{facet\_wrap()}, definindo a variável \texttt{var} como parâmetro para dividir os mapas. Além disso, dentro dessa mesma função, utilizamos a \texttt{labeller\ =\ as\_labeller()} para alterar os nomes das observações que compõem a coluna \texttt{var}, a fim de ficarem mais apresentáveis ao mapa.

Podemos proceder da mesma forma para comparar o censo de 2006 com o de 2017, apenas alterando o parâmetro da função \texttt{facet\_wrap()} para a coluna \texttt{ano}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censos 2006 e 2017 {-} Nº estabelecimentos}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(var }\SpecialCharTok{==} \StringTok{"n\_estab\_1000"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ano)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{direction =} \DecValTok{0}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{800}\NormalTok{),}
                       \AttributeTok{name =} \StringTok{"Nº estabelecimentos (por 1000 und.)"}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{3}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{11}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{,}
                         \AttributeTok{title.position =} \StringTok{\textquotesingle{}top\textquotesingle{}}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2006 e 2017"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Número de estabelecimentos agropecuários por estado, a cada 1000 unidades"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2006 e 2017"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{15}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{2}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{11}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \FloatTok{2.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{8}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.49}\NormalTok{, }\FloatTok{0.06}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-350-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censos 2006 e 2017 {-} Área}
\NormalTok{dados\_mapa\_estados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(var }\SpecialCharTok{==} \StringTok{"area\_estab\_100mil\_ha"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ano)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{direction =} \DecValTok{0}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{800}\NormalTok{),}
                       \AttributeTok{name =} \StringTok{"Área estabelecimentos (por 100 mil ha)"}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{3}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{11}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{,}
                         \AttributeTok{title.position =} \StringTok{\textquotesingle{}top\textquotesingle{}}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2006 e 2017"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Área dos estabelecimentos agropecuários por estado, a cada 100 mil hectares"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2006 e 2017"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{15}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{2}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{11}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \FloatTok{2.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{8}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.49}\NormalTok{, }\FloatTok{0.06}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-351-1} \end{center}

\hypertarget{municuxedpios-de-mato-grosso}{%
\subsubsection*{Municípios de Mato Grosso}\label{municuxedpios-de-mato-grosso}}
\addcontentsline{toc}{subsubsection}{Municípios de Mato Grosso}

Podemos proceder da mesma maneira para criar mapas coroplético a partir de outra dimensão geográfica. Nesse caso, faremos para os municípios do estado do Mato Grosso, de acordo com os dados do censo agropecuário de 2017.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Organizando dados do censo agropecuário 2017}
\NormalTok{censo\_muni\_MT }\OtherTok{\textless{}{-}}\NormalTok{ censo\_agro\_06\_17 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(nivel }\SpecialCharTok{==} \StringTok{"MU"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_estab\_100 =}\NormalTok{ n\_estab}\SpecialCharTok{/}\DecValTok{100}\NormalTok{,}
         \AttributeTok{area\_estab\_100mil\_ha =}\NormalTok{ area\_estab\_ha}\SpecialCharTok{/}\DecValTok{100000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(cod, localidade, ano, n\_estab\_100, area\_estab\_100mil\_ha) }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(n\_estab\_100, area\_estab\_100mil\_ha),}
               \AttributeTok{names\_to =} \StringTok{"var"}\NormalTok{,}
               \AttributeTok{values\_to =} \StringTok{"valores"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rename}\NormalTok{(}\StringTok{"code\_muni"} \OtherTok{=}\NormalTok{ cod)}

\CommentTok{\# Carregando dados dos municípios de MT}
\NormalTok{mapa\_muni\_MT }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"MT"}\NormalTok{, }\AttributeTok{showProgress =}\NormalTok{ F)}

\CommentTok{\# Juntando as bases de dados a partir da coluna \textasciigrave{}code\_muni\textasciigrave{}}
\NormalTok{dados\_mapa\_muni }\OtherTok{\textless{}{-}} \FunctionTok{full\_join}\NormalTok{(mapa\_muni\_MT, censo\_muni\_MT, }\AttributeTok{by =} \StringTok{"code\_muni"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(code\_muni, name\_muni, ano, var, valores, geom)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2017 {-} MT {-} Nº estabelecimentos}
\NormalTok{dados\_mapa\_muni }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(var }\SpecialCharTok{==} \StringTok{"n\_estab\_100"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{direction =} \DecValTok{0}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{40}\NormalTok{),}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"left"}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Número de estabelecimentos agropecuários por município de MT, a cada 100 unidades"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{fill =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{13}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{10}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{9}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-354-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Censo 2017 {-} MT {-} Área}
\NormalTok{dados\_mapa\_muni }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(var }\SpecialCharTok{==} \StringTok{"area\_estab\_100mil\_ha"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{20}\NormalTok{),}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"left"}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Área dos estabelecimentos agropecuários por município de MT, a cada 100 mil hectares"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{fill =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{13}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{10}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{9}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-355-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nº estabelecimentos e área}
\NormalTok{dados\_mapa\_muni }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ valores))}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{var,}
             \AttributeTok{labeller =} \FunctionTok{as\_labeller}\NormalTok{(}
               \FunctionTok{c}\NormalTok{(}\AttributeTok{area\_estab\_100mil\_ha =} \StringTok{"Área estabelecimentos"}\NormalTok{,}
                 \AttributeTok{n\_estab\_100 =} \StringTok{"Nº estabelecimentos"}\NormalTok{)))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{40}\NormalTok{),}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}
                         \AttributeTok{keyheight =} \FunctionTok{unit}\NormalTok{(}\DecValTok{2}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{keywidth=}\FunctionTok{unit}\NormalTok{(}\DecValTok{7}\NormalTok{, }\AttributeTok{units =} \StringTok{"mm"}\NormalTok{),}
                         \AttributeTok{label.position =} \StringTok{"bottom"}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Quantidade e área de estabelecimentos agropecuários por município de MT"}\NormalTok{,}
       \AttributeTok{caption =} \StringTok{"Fonte: IBGE {-} Censo Agropecuário 2017"}\NormalTok{,}
       \AttributeTok{fill =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{13}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{2}\NormalTok{),}
        \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=} \DecValTok{10}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{2}\NormalTok{),}
        \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size=}\DecValTok{9}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{),}
        \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.52}\NormalTok{, }\FloatTok{0.06}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-356-1} \end{center}

\hypertarget{biomas}{%
\section{Biomas}\label{biomas}}

O pacote \texttt{geobr} também possui uma base de dados para os biomas e a zona costeira do Brasil, baseado nos dados originais do \href{https://www.ibge.gov.br/apps/biomas/\#/home}{IBGE - Biomas e Sistema Costeiro-Marinho}. Para tanto, utilizamos a função \texttt{read\_biomes()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_biomes}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_biome)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Biomas"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-357-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando um bioma {-} Cerrado}
\FunctionTok{read\_biomes}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_biome }\SpecialCharTok{==} \StringTok{"Cerrado"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_biome)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-358-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adicionando um bioma ao mapa do Brasil {-} Sistema Costeiro}
\NormalTok{brasil }\OtherTok{\textless{}{-}} \FunctionTok{read\_country}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_biomes}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_biome }\SpecialCharTok{==} \StringTok{"Sistema Costeiro"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ brasil)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_biome)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Blues"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-359-1} \end{center}

No exemplo acima, a primeira geometria é correspondente ao mapa do país, sendo a outra, ao bioma costeiro. O exemplo a seguir segue a mesma lógica explicada, porém, agora, para mais de um tipo de bioma.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adicionando mais de um bioma ao mapa do Brasil}
\NormalTok{brasil }\OtherTok{\textless{}{-}} \FunctionTok{read\_country}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_biomes}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_biome }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Amazônia"}\NormalTok{, }\StringTok{"Mata Atlântica"}\NormalTok{, }\StringTok{"Pantanal"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ brasil)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_biome)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Greens"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Biomas"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-360-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adicionando os biomas ao mapa do Brasil, dividido por estados}
\NormalTok{brasil }\OtherTok{\textless{}{-}} \FunctionTok{read\_country}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{bioma }\OtherTok{\textless{}{-}} \FunctionTok{read\_biomes}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ bioma, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ name\_biome), }\AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"antiquewhite4"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ brasil, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Pastel1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state), }\AttributeTok{size =} \FloatTok{1.7}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Biomas"}\NormalTok{, }\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-361-1} \end{center}

O exemplo acima juntou o mapa do país, dividido por estados, com o dos biomas. Para isso, tivemos que sobrepor os mapas para formar um único. Em cada um dos \texttt{geom\_sf()}, declaramos - a partir do argumento \texttt{data\ =} - qual base de dados foi considerada.

No caso da geometria referente aos biomas (\texttt{data\ =\ bioma}), preenchemos com os tipos de biomas (\texttt{fill\ =\ name\_biome}) e retiramos as cores das bordas com o \texttt{color\ =\ 0}. Em seguida, sobrepomos ao mapa dos biomas o mapa dos estados (\texttt{data\ =\ estados}); uma vez que precisamos apenas das linhas que demarcam os estados, utilizamos o argumento \texttt{alpha\ =\ 0} para deixar o interior dos estados transparentes. Por fim, o \texttt{data\ =\ brasil} foi utilizado para realçar as bordas que delimitam o país, sendo necessário utilizar novamente o \texttt{alpha\ =\ 0} para manter apenas as bordas e deixar transparente o interior do mapa do Brasil.

\hypertarget{amazuxf4nia-legal}{%
\section{Amazônia Legal}\label{amazuxf4nia-legal}}

A função \texttt{read\_amazon()} nos retorna a área da Amazônia Legal Brasileira, definida pela lei n.12.651/2012. Os presentes dados são do Ministério do Meio Ambiente (MMA) e podem ser acessados em: \url{http://mapas.mma.gov.br/i3geo/datadownload.htm}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_amazon}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-362-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inserindo a área da Amazônia Legal Brasileira no mapa do Brasil, delimitado por estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_amazon}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightgreen"}\NormalTok{, }\AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state), }\AttributeTok{size =} \FloatTok{1.7}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-363-1} \end{center}

\hypertarget{semiuxe1rido}{%
\section{Semiárido}\label{semiuxe1rido}}

A função \texttt{read\_semiarid()} retorna os municípios que compunham o semiárido brasileiro nos anos de 2005 e 2017, baseado nos dados do \href{https://www.ibge.gov.br/geociencias/cartas-e-mapas/mapas-regionais/15974-semiarido-brasileiro.html?=\&t=downloads}{IBGE - Semiárido Brasileiro}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2005}\NormalTok{,}
              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-364-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inserindo os municípios do semiárido no mapa do Brasil, dividido por estados, no ano de 2017}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2017}\NormalTok{,}
              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-365-1} \end{center}

No exemplo acima, podemos retirar as linhas dos municípios e colocar apenas a mancha dos municípios do semiário no mapa do Brasil, inserindo o argumento \texttt{color\ =\ 0} dentro do primeiro \texttt{geom\_sf()}, esse referente à geometria dos municípios do semiárido.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inserindo o semiárido no mapa do Brasil, dividido por estados, no ano de 2017}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2017}\NormalTok{,}
              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{, }\AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-366-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Comparando o semiárido entre 2005 e 2017}

\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\DocumentationTok{\#\# 2005}
\NormalTok{semiarido\_05 }\OtherTok{\textless{}{-}} \FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2005}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{,}
          \AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados,}
          \AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2005"}\NormalTok{)}

\NormalTok{semiarido\_05}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# 2017}
\NormalTok{semiarido\_17 }\OtherTok{\textless{}{-}} \FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2017}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{,}
          \AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados,}
          \AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2017"}\NormalTok{)}

\NormalTok{semiarido\_17}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-368-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fazendo um mapa com somente os estados do semiárido}

\DocumentationTok{\#\# Semiárido em 2005}
\NormalTok{semiarido\_05 }\OtherTok{\textless{}{-}} \FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2005}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F)}

\DocumentationTok{\#\# Vetorizando os estados do semiárido em 2005}
\NormalTok{abbr\_semiarido\_05 }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(}\FunctionTok{unique}\NormalTok{(semiarido\_05}\SpecialCharTok{$}\NormalTok{abbrev\_state))}

\DocumentationTok{\#\# Filtrando os estados do semiárido em 2005 na função read\_state()}
\NormalTok{estados\_semiarido\_05 }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{\%in\%}\NormalTok{ abbr\_semiarido\_05) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+} 
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ semiarido\_05,}
          \AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{,}
          \AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2005"}\NormalTok{, }\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state), }\AttributeTok{size =} \FloatTok{2.3}\NormalTok{)}

\NormalTok{estados\_semiarido\_05}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Semiárido em 2017}
\NormalTok{semiarido\_17 }\OtherTok{\textless{}{-}} \FunctionTok{read\_semiarid}\NormalTok{(}\AttributeTok{year =} \DecValTok{2017}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F)}

\DocumentationTok{\#\# Vetorizando os estados do semiárido em 2017}
\NormalTok{abbr\_semiarido\_17 }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(}\FunctionTok{unique}\NormalTok{(semiarido\_17}\SpecialCharTok{$}\NormalTok{abbrev\_state))}

\DocumentationTok{\#\# Filtrando os estados do semiárido em 2017 na função read\_state()}
\NormalTok{estados\_semiarido\_17 }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{\%in\%}\NormalTok{ abbr\_semiarido\_17) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+} 
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ semiarido\_17,}
          \AttributeTok{fill =} \StringTok{"\#F8766D"}\NormalTok{,}
          \AttributeTok{color =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"2017"}\NormalTok{, }\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ abbrev\_state), }\AttributeTok{size =} \FloatTok{2.3}\NormalTok{)}

\NormalTok{estados\_semiarido\_17}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-370-1} \end{center}

\hypertarget{uxe1reas-de-conservauxe7uxe3o}{%
\section{Áreas de conservação}\label{uxe1reas-de-conservauxe7uxe3o}}

Para trabalharmos com as áreas de conservação do Brasil, utilizamos a função \texttt{read\_conservation\_units()}. A última atualização foi feita em setembro de 2019, sendo baseada nos dados do Ministério do Meio Ambiente (MMA), podendo ser acessados em: \url{http://mapas.mma.gov.br/i3geo/datadownload.htm}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{areas\_conservacao }\OtherTok{\textless{}{-}} \FunctionTok{read\_conservation\_units}\NormalTok{(}\AttributeTok{date =} \DecValTok{201909}\NormalTok{,}
                                             \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{dim}\NormalTok{(areas\_conservacao)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1934   15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(areas\_conservacao)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "code_conservation_unit" "name_conservation_unit" "id_wcm"                
 [4] "category"               "group"                  "government_level"      
 [7] "creation_year"          "gid7"                   "quality"               
[10] "legislation"            "dt_ultim10"             "code_u111"             
[13] "name_organization"      "date"                   "geom"                  
\end{verbatim}

A base de dados possui 1934 áreas de conservação registradas, sendo divididas por código da unidade de conservação (\texttt{code\_conservation\_unit}), nome da unidade de conservação (\texttt{name\_conservation\_unit}), categoria da unidade de conservação (\texttt{category}), nivel governamental (\texttt{government\_level}), ano da criação (\texttt{creation\_year}), nome da organização responsável (\texttt{name\_organization}), dentre outros.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_conservation\_units}\NormalTok{(}\AttributeTok{date =} \DecValTok{201909}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-372-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de conservação no mapa do Brasil}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_conservation\_units}\NormalTok{(}\AttributeTok{date =} \DecValTok{201909}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightgreen"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-373-1} \end{center}

\hypertarget{terras-induxedgenas}{%
\section{Terras indígenas}\label{terras-induxedgenas}}

Para trabalharmos com áreas de terras indígenas, utilizamos a função \texttt{read\_indigenous\_land()}. O respectivo conjunto de dados abrange todas as terras indígenas, de todas as etnias e em diferentes estágios de demarcação. Os dados são de setembro de 2019 e março de 2021, oriundos da \href{https://www.gov.br/funai/pt-br}{Fundação Nacional do Índio (FUNAI)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_indigenous\_land}\NormalTok{(}\AttributeTok{date =} \DecValTok{201907}\NormalTok{,}
                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-374-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de terras indígenas no mapa do Brasil, dividido por estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}


\FunctionTok{read\_indigenous\_land}\NormalTok{(}\AttributeTok{date =} \DecValTok{201907}\NormalTok{,}
                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#ED8141"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-375-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando terras indígenas de um estado {-} Acre}
\NormalTok{acre }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                          \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AC"}\NormalTok{)}

\FunctionTok{read\_indigenous\_land}\NormalTok{(}\AttributeTok{date =} \DecValTok{201907}\NormalTok{,}
                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AC"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ acre)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#ED8141"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-376-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Separando as terras indígenas por etnia}
\NormalTok{acre }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                          \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AC"}\NormalTok{)}

\FunctionTok{read\_indigenous\_land}\NormalTok{(}\AttributeTok{date =} \DecValTok{201907}\NormalTok{,}
                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AC"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ acre)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ etnia\_nome))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Etnia"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-377-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Separando as terras indígenas por estágio de demarcação {-} Amazonas}
\NormalTok{amazonia }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"all"}\NormalTok{,}
                              \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                              \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AM"}\NormalTok{)}

\FunctionTok{read\_indigenous\_land}\NormalTok{(}\AttributeTok{date =} \DecValTok{201907}\NormalTok{,}
                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"AM"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ amazonia)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ fase\_ti))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Estágio de}\SpecialCharTok{\textbackslash{}n}\StringTok{demarcação"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-378-1} \end{center}

\hypertarget{uxe1reas-de-risco-de-desastres-naturais}{%
\section{Áreas de risco de desastres naturais}\label{uxe1reas-de-risco-de-desastres-naturais}}

A função \texttt{read\_disaster\_risk\_area()} retorna dados oficiais de áreas de risco de desastres naturais no Brasil, para o ano de 2010, baseado na metodologia do \href{https://www.ibge.gov.br/geociencias/organizacao-do-territorio/tipologias-do-territorio/21538-populacao-em-areas-de-risco-no-brasil.html}{IBGE e CEMADEN}. As informações se concentram em desastres geodinâmicos e hidrometeorológicos capazes de desencadear deslizamentos de terra e inundações.

Cada polígono de área de risco (conhecido como ``BATER'') possui um código de identificação (coluna \texttt{geo\_bater}). O conjunto de dados traz informações sobre o quanto os polígonos das áreas de risco se sobrepõem aos setores censitários e faces do bloco (coluna \texttt{acuracia}) e número de áreas dentro de cada área de risco (coluna \texttt{num}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_disaster\_risk\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-379-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de risco no mapa do Brasil, dividido por estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_disaster\_risk\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{fill =} \StringTok{"white"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#2D3E50"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#FEBF57"}\NormalTok{, }\AttributeTok{size =}\NormalTok{ .}\DecValTok{15}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-380-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de risco no estado do RJ}
\NormalTok{rj }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"RJ"}\NormalTok{,}
                 \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                 \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_disaster\_risk\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"RJ"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ rj, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#2D3E50"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#FEBF57"}\NormalTok{, }\AttributeTok{size =}\NormalTok{ .}\DecValTok{15}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2019
\end{verbatim}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-382-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de risco no município de Petrópolis/RJ}
\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{name\_muni =} \StringTok{"Petrópolis"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni  name_muni code_state     name_state abbrev_state code_micro
3229   3303906 Petrópolis         33 Rio de Janeiro           RJ      33015
     name_micro code_meso                       name_meso code_immediate
3229    Serrana      3306 Metropolitana do Rio de Janeiro         330007
     name_immediate code_intermediate name_intermediate
3229     Petrópolis              3303        Petrópolis
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{petropolis }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \DecValTok{3303906}\NormalTok{,}
                                \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_disaster\_risk\_area}\NormalTok{(}\AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_muni }\SpecialCharTok{==} \StringTok{"Petropolis"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ petropolis, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#2D3E50"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#FEBF57"}\NormalTok{, }\AttributeTok{size =}\NormalTok{ .}\DecValTok{15}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-383-1} \end{center}

\hypertarget{estabelecimentos-de-sauxfade}{%
\section{Estabelecimentos de saúde}\label{estabelecimentos-de-sauxfade}}

A função \texttt{read\_health\_facilities()} nos retorna os estabelecimentos de saúde presentes nos municípios brasileiros. Os dados são provenientes do Cadastro Nacional de Estabelecimentos de Saúde (CNES), originalmente coletados pelo Ministério da Saúde do Brasil.

Segundo o Ministério da Saúde, as coordenadas de cada unidade foram obtidas pelo CNES e validadas por meio de operações espaciais. Essas operações verificam se o ponto está no município, considerando um raio de 5.000 metros. Quando a coordenada não está correta, outras buscas são feitas em outros sistemas do Ministério da Saúde, como o \emph{DataSUS}, e em serviços web, como o \emph{Google Maps}. Por fim, se as coordenadas foram obtidas corretamente neste processo, são utilizadas as coordenadas da sede municipal.

A fonte do geocódigo utilizada está presente na coluna \texttt{data\_source} do banco de dados. A data da última atualização dos dados é registrada nas colunas \texttt{date\_update} e \texttt{year\_update}. Além disso, cada estabelecimento de saúde apresenta um código de identificação, presente na coluna \texttt{code\_cnes}.

Informações adicionais sobre os dados estão presentes em: \url{https://dados.gov.br/dataset?q=CNES}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{estab\_saude }\OtherTok{\textless{}{-}} \FunctionTok{read\_health\_facilities}\NormalTok{(}\AttributeTok{showProgress =}\NormalTok{ F)}

\NormalTok{estab\_saude }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-384-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os estabelecimentos de saúde do município de Piracicaba/SP}

\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{name\_muni =} \StringTok{"Piracicaba"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni  name_muni code_state name_state abbrev_state code_micro
3700   3538709 Piracicaba         35  São Paulo           SP      35028
     name_micro code_meso  name_meso code_immediate name_immediate
3700 Piracicaba      3506 Piracicaba         350040     Piracicaba
     code_intermediate name_intermediate
3700              3510          Campinas
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Carregando as delimitações espaciais do município de Piracicaba/SP}
\NormalTok{piracicaba }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \DecValTok{3538709}\NormalTok{,}
                                \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                                \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{)}

\DocumentationTok{\#\# Selecionando os estabelecimentos de saúde de Piracicaba/SP}
\NormalTok{pira\_estab\_saude }\OtherTok{\textless{}{-}}\NormalTok{ estab\_saude }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(code\_muni }\SpecialCharTok{==} \DecValTok{353870}\NormalTok{)}

\NormalTok{pira\_estab\_saude }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ piracicaba)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ pira\_estab\_saude)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-385-1} \end{center}

Vale destacar que na função \texttt{read\_health\_facilities()}, os códigos de identificação dos municípios (\texttt{code\_muni}) estão representados pelos 6 primeiros dígitos dos 7 dígitos que compõe o código original. Por tanto, quando utilizar os códigos do municípios na função \texttt{read\_health\_facilities()}, use apenas os 6 primeiros dígitos.

\hypertarget{regiuxf5es-de-sauxfade}{%
\section{Regiões de saúde}\label{regiuxf5es-de-sauxfade}}

A função \texttt{read\_health\_region()} contém o banco de dados das regiões de saúde no Brasil para os anos de 1991, 1994, 1997, 2001, 2005 e 2013.

Estes dados são utilizados para orientar o planejamento regional e estadual dos serviços de saúde. Dentro disso, temos as macrorregiões de saúde que, em particular, são utilizadas para orientar o planejamento dos serviços de saúde de alta complexidade, serviços estes que envolvem maior economia de escala e estão concentrados em poucos municípios, pois geralmente são mais intensivos em tecnologia, onerosos e enfrentam escassez de profissionais especializados. Uma macrorregião compreende uma ou mais regiões de saúde.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Regiões de saúde}
\NormalTok{reg\_saude }\OtherTok{\textless{}{-}} \FunctionTok{read\_health\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2013}\NormalTok{,}
                                \AttributeTok{macro =}\NormalTok{ F,}
                                \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Regiões de saúde"}\NormalTok{)}

\NormalTok{reg\_saude}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Macrorregiões de saúde}
\NormalTok{macroreg\_saude }\OtherTok{\textless{}{-}} \FunctionTok{read\_health\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2013}\NormalTok{,}
                                     \AttributeTok{macro =}\NormalTok{ T,}
                                     \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Macrorregiões de saúde"}\NormalTok{)}

\NormalTok{macroreg\_saude}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-387-1} \end{center}

O argumento \texttt{macro\ =} da função \texttt{read\_health\_region()} aceita valores lógicos para representar as macrorregiões de saúde (\texttt{macro\ =\ TRUE}) ou representar apenas as regiões de saúde (\texttt{macro\ =\ FALSE}). Por padrão, caso não seja especificado o argumento, \texttt{macro\ =\ FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as regiões e macrorregiões de saúde do estado de Goiás}
\DocumentationTok{\#\# Regiões de saúde}
\NormalTok{GO\_reg\_saude }\OtherTok{\textless{}{-}} \FunctionTok{read\_health\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2013}\NormalTok{,}
                                   \AttributeTok{macro =}\NormalTok{ F,}
                                   \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"GO"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Regiões de saúde {-} GO"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name\_health\_region), }\AttributeTok{size =} \FloatTok{1.8}\NormalTok{)}

\NormalTok{GO\_reg\_saude}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Macrorregiões de saúde}
\NormalTok{GO\_macroreg\_saude }\OtherTok{\textless{}{-}} \FunctionTok{read\_health\_region}\NormalTok{(}\AttributeTok{year =} \DecValTok{2013}\NormalTok{,}
                                        \AttributeTok{macro =}\NormalTok{ T,}
                                        \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"GO"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Macrorregiões de saúde {-} GO"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name\_health\_macroregion), }\AttributeTok{size =} \FloatTok{1.8}\NormalTok{)}

\NormalTok{GO\_macroreg\_saude}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-389-1} \end{center}

\hypertarget{escolas}{%
\section{Escolas}\label{escolas}}

A função \texttt{read\_schools()} contém os dados do Censo Escolar coletados pelo Instituto Nacional de Estudos e Pesquisas Educacionais Anísio Teixeira (INEP), para o ano de 2020. Para mais informações, acesse: \url{https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/inep-data/catalogo-de-escolas/}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_schools}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
             \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "abbrev_state"                   "name_muni"                     
 [3] "code_school"                    "name_school"                   
 [5] "education_level"                "education_level_others"        
 [7] "admin_category"                 "address"                       
 [9] "phone_number"                   "government_level"              
[11] "private_school_type"            "private_government_partnership"
[13] "regulated_education_council"    "service_restriction"           
[15] "size"                           "urban"                         
[17] "location_type"                  "date_update"                   
[19] "geom"                          
\end{verbatim}

O banco de dados possui diversas informações, como por exemplo, o nome da escola (\texttt{name\_school}), o nível escolar (\texttt{education\_level}), tipos de administração (\texttt{admin\_category}, \texttt{government\_level}, \texttt{private\_school\_type}, \texttt{private\_government\_partnership}), dentre outras.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_schools}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
             \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-391-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as escolas de Piracicaba/SP, categorizadas por tipo de administração}

\NormalTok{piracicaba }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \DecValTok{3538709}\NormalTok{,}
                                \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                                \AttributeTok{showProgress =} \ConstantTok{FALSE}\NormalTok{)}

\FunctionTok{read\_schools}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
             \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(name\_muni }\SpecialCharTok{==} \StringTok{"Piracicaba"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ piracicaba)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ government\_level), }\AttributeTok{size =} \FloatTok{1.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{color =} \StringTok{"Tipo administrativo"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-392-1} \end{center}

\hypertarget{uxe1reas-de-concentrauxe7uxe3o-de-populauxe7uxe3o}{%
\section{Áreas de Concentração de População}\label{uxe1reas-de-concentrauxe7uxe3o-de-populauxe7uxe3o}}

A função \texttt{read\_urban\_concentrations()} lê os dados oficiais das áreas de concentração urbana (Áreas de Concentração de População) do Brasil, que representa um município que se encaixa nessa classificação. Os dados originais foram gerados pelo IBGE, cuja metodologia detalhada pode ser acessada em: \url{https://www.ibge.gov.br/apps/arranjos_populacionais/2015/pdf/publicacao.pdf}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_urban\_concentrations}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{, }\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "code_urban_concentration" "name_urban_concentration"
 [3] "code_muni"                "name_muni"               
 [5] "pop_total_2010"           "pop_urban_2010"          
 [7] "pop_rural_2010"           "code_state"              
 [9] "abbrev_state"             "name_state"              
[11] "geom"                    
\end{verbatim}

O banco de dados traz como variáveis o nome das áreas de concentração urbana (\texttt{name\_urban\_concentration}), bem como os nomes dos municípios e estados que fazem parte. Além disso, as colunas \texttt{pop\_total\_2010}, \texttt{pop\_urban\_2010} e \texttt{pop\_rural\_2010} trazem o número da população total, urbana e rural, respectivamente, de acordo com o Censo 2010 realizado pelo IBGE.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_urban\_concentrations}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-394-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inserindo as áreas de concentração urbana ao mapa do Brasil, dividido por estados}
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{read\_state}\NormalTok{(}\AttributeTok{code\_state =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2019}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}


\FunctionTok{read\_urban\_concentrations}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ estados, }\AttributeTok{alpha =} \DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"orange"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-395-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Áreas de concentração urbana de São Paulo}
\NormalTok{municipios\_sp }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"SP"}\NormalTok{,}
                                   \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_urban\_concentrations}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"SP"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_sp, }\AttributeTok{fill =} \StringTok{"lightgrey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"orange"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{verbatim}
Using year 2015
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-397-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mapa de calor com a população urbana das áreas de concentração urbana do Paraná}

\NormalTok{municipios\_pr }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"PR"}\NormalTok{,}
                                   \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                                   \AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_urban\_concentrations}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                          \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"PR"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_pr, }\AttributeTok{fill =} \StringTok{"lightgrey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ pop\_urban\_2010))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{direction =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{3000}\NormalTok{, }\DecValTok{1750000}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"População urbana }\SpecialCharTok{\textbackslash{}n}\StringTok{Censo 2010"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{verbatim}
Using year 2015
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-399-1} \end{center}

Para confeccionar um mapa de calor de acordo com a população urbana das áreas de concentração urbana do Paraná, definimos o número de habitantes urbanos (\texttt{pop\_urban\_2010}) como parâmetro do argumento \texttt{fill\ =}, dentro da \texttt{aes()} respectiva ao banco de dados das áreas de concentração urbana. Além disso, com a função \texttt{scale\_fill\_viridis\_c()} definimos os limites de escala a serem considerados no mapa de calor, tendo valor mínimo de 3.000 e máximo de 1.750.000 habitantes.

\hypertarget{arranjos-populacionais}{%
\section{Arranjos populacionais}\label{arranjos-populacionais}}

A função \texttt{read\_pop\_arrangements()} retorna os dados oficiais sobre arranjos populacionais, que são agrupamentos de dois ou mais municípios com forte integração populacional, devido aos movimentos pendulares para trabalho ou estudo, ou à contiguidade entre manchas urbanas.

Os dados originais foram gerados pelo Instituto Brasileiro de Geografia e Estatística (IBGE), cuja metodologia detalhada pode ser acessada em: \url{https://www.ibge.gov.br/apps/arranjos_populacionais/2015/pdf/publicacao.pdf}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_pop\_arrangements}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{, }\AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "code_pop_arrangement" "name_pop_arrangement" "code_muni"           
 [4] "name_muni"            "pop_total_2010"       "pop_urban_2010"      
 [7] "pop_rural_2010"       "code_state"           "abbrev_state"        
[10] "name_state"           "geom"                
\end{verbatim}

De modo semelhante ao banco de dados das áreas de concentração urbana, este conjunto de dados contém a nomenclatura dos arranjos populacionais (\texttt{name\_pop\_arrangement}), o município e estado que faz parte e as populações totais, urbana e rural do arranjo, de acordo com o Censo 2010 do IBGE.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_pop\_arrangements}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-401-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os arranjos populacionais do RJ}
\NormalTok{municipios\_rj }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"RJ"}\NormalTok{,}\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_pop\_arrangements}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"RJ"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_rj)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{fill =} \StringTok{"orange"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{verbatim}
Using year 2015
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-403-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mapa de calor com a população total dos arranjos populacionais do RJ}
\NormalTok{municipios\_rj }\OtherTok{\textless{}{-}} \FunctionTok{read\_municipality}\NormalTok{(}\AttributeTok{code\_muni =} \StringTok{"RJ"}\NormalTok{,}\AttributeTok{showProgress =}\NormalTok{ F)}

\FunctionTok{read\_pop\_arrangements}\NormalTok{(}\AttributeTok{year =} \DecValTok{2015}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(abbrev\_state }\SpecialCharTok{==} \StringTok{"RJ"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ municipios\_rj)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ pop\_total\_2010))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{direction =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{8000}\NormalTok{, }\DecValTok{6400000}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{verbatim}
Using year 2015
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-405-1} \end{center}

\hypertarget{setor-censituxe1rio}{%
\section{Setor censitário}\label{setor-censituxe1rio}}

O setor censitário é a unidade territorial estabelecida pelo IBGE para planejar e realizar levantamentos de dados do Censo e Pesquisas Estatísticas. É formado por uma área contínua, considerando a Divisão Político-Administrativa, situada em um único quadro urbano ou rural, com dimensão e número de domicílios que permitam o levantamento das informações por um recenseador dentro do prazo determinado para a coleta. Assim sendo, cada recenseador procederá à coleta de informações tendo como meta a cobertura do setor censitário que lhe é designado.

Informações complementares estão disponíveis em: \url{https://www.ibge.gov.br/geociencias/organizacao-do-territorio/malhas-territoriais/26565-malhas-de-setores-censitarios-divisoes-intramunicipais.html?=\&t=downloads}

A função \texttt{read\_census\_tract()} nos retorna os dados do setor censitário para os anos de 2000, 2010, 2017, 2019 e 2020.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_census\_tract}\NormalTok{(}\AttributeTok{code\_tract =} \StringTok{"all"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2020}\NormalTok{,}
                  \AttributeTok{showProgress =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

O argumento \texttt{code\_tract\ =} pode receber os seguintes valores: \texttt{"all"} para selecionar todos os dados dos setores censitários do Brasil; código/abreviação do estado para um estado em específico; e um código de 7 dígitos referentes aos municípios.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os setores censitários de Sergipe, divididos por zona, em 2010}
\FunctionTok{read\_census\_tract}\NormalTok{(}\AttributeTok{code\_tract =} \StringTok{"SE"}\NormalTok{,}
                  \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                  \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ zone))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Zona"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-408-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando os setores censitários de Sergipe, divididos por zona, em 2000}

\DocumentationTok{\#\# Zona Rural}
\NormalTok{se\_rur }\OtherTok{\textless{}{-}} \FunctionTok{read\_census\_tract}\NormalTok{(}\AttributeTok{code\_tract =} \StringTok{"SE"}\NormalTok{,}
                            \AttributeTok{year =} \DecValTok{2000}\NormalTok{,}
                            \AttributeTok{zone =} \StringTok{"rural"}\NormalTok{,}
                            \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Setor censitário {-} Área rural }\SpecialCharTok{\textbackslash{}n}\StringTok{Sergipe, 2000"}\NormalTok{)}

\NormalTok{se\_rur}


\CommentTok{\# Zona Urbana}
\NormalTok{se\_urb }\OtherTok{\textless{}{-}} \FunctionTok{read\_census\_tract}\NormalTok{(}\AttributeTok{code\_tract =} \StringTok{"SE"}\NormalTok{,}
                            \AttributeTok{year =} \DecValTok{2000}\NormalTok{,}
                            \AttributeTok{zone =} \StringTok{"urban"}\NormalTok{,}
                            \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Setor censitário {-} Área urbana }\SpecialCharTok{\textbackslash{}n}\StringTok{Sergipe, 2000"}\NormalTok{)}

\NormalTok{se\_urb}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2000
\end{verbatim}

\begin{verbatim}
Using data of Rural census tracts
\end{verbatim}

\begin{verbatim}
Using year 2000
\end{verbatim}

\begin{verbatim}
Using data of Urban census tracts
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-411-1} \end{center}

No caso dos setores censitários do ano de 2000, as zonas rural e urbana estão em banco de dados separados. Para isso, precisamos utilizar o argumento \texttt{zone\ =} para especificar a zona rural (\texttt{zone\ =\ "rural"}) ou urbana (\texttt{zone\ =\ "urban"}). Caso o argumento não seja declarado, por padrão, adota-se a zona urbana.

\hypertarget{uxe1reas-de-ponderauxe7uxe3o}{%
\section{Áreas de ponderação}\label{uxe1reas-de-ponderauxe7uxe3o}}

Define-se área de ponderação como sendo uma unidade geográfica, formada por um agrupamento mutuamente exclusivo de setores censitários contíguos, para a aplicação dos procedimentos de calibração dos pesos de forma a produzir estimativas compatíveis com algumas das informações conhecidas para a população como um todo \href{https://www.ibge.gov.br/estatisticas/sociais/populacao/9662-censo-demografico-2010.html?edicao=9754\&t=sobre}{(IBGE, 2010)}.

A função \texttt{read\_weighting\_area()} nos retorna as áreas de ponderação para o ano de 2010.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_weighting\_area}\NormalTok{(}\AttributeTok{code\_weighting =} \StringTok{"all"}\NormalTok{,}
                    \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                    \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-412-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as áreas de ponderação do Distrito Federal}
\FunctionTok{read\_weighting\_area}\NormalTok{(}\AttributeTok{code\_weighting =} \StringTok{"DF"}\NormalTok{,}
                    \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                    \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Using year 2010
\end{verbatim}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-414-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecionando as áreas de ponderação do município de Presidente Prudente/SP}
\FunctionTok{lookup\_muni}\NormalTok{(}\AttributeTok{name\_muni =} \StringTok{"Presidente Prudente"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     code_muni           name_muni code_state name_state abbrev_state
3731   3541406 Presidente Prudente         35  São Paulo           SP
     code_micro          name_micro code_meso           name_meso
3731      35036 Presidente Prudente      3508 Presidente Prudente
     code_immediate      name_immediate code_intermediate   name_intermediate
3731         350018 Presidente Prudente              3505 Presidente Prudente
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_weighting\_area}\NormalTok{(}\AttributeTok{code\_weighting =} \DecValTok{3541406}\NormalTok{,}
                    \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                    \AttributeTok{showProgress =}\NormalTok{ F) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-415-1} \end{center}

\hypertarget{grade-estatuxedstica-do-ibge}{%
\section{Grade estatística do IBGE}\label{grade-estatuxedstica-do-ibge}}

As grades estatísticas se constituem em uma forma de disseminação de dados que
permite análises detalhadas e independentes das divisões territoriais, visando
atender, principalmente, a necessidade de se ter dados em unidades geográficas
pequenas e estáveis ao longo do tempo, facilitando sobremaneira a comparação
nacional e internacional e fornecendo um aumento significativo do detalhamento,
particularmente nas regiões rurais, em comparação com metodologias anteriores \href{https://geoftp.ibge.gov.br/recortes_para_fins_estatisticos/grade_estatistica/censo_2010/grade_estatistica.pdf}{(IBGE, 2016)}.

A função \texttt{read\_statistical\_grid()} nos retorna as grades estatísticas do IBGE, com dimensão de 200 x 200 metros, para o ano de 2010. Cada quadrante das grades são representados por um código de 7 dígitos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_statistical\_grid}\NormalTok{(}\AttributeTok{code\_grid =} \StringTok{"all"}\NormalTok{,}
                      \AttributeTok{year =} \DecValTok{2010}\NormalTok{,}
                      \AttributeTok{showProgress =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tabela-de-corresponduxeancia}{%
\subsection{Tabela de correspondência}\label{tabela-de-corresponduxeancia}}

A \texttt{grid\_state\_correspondence\_table} carrega uma tabela de correspondência indicando quais quadrantes da grade estatística do IBGE se cruzam com cada estado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grid\_state\_correspondence\_table }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   name_state abbrev_state code_grid
1        Acre           AC     ID_50
2        Acre           AC     ID_51
3        Acre           AC     ID_60
4        Acre           AC     ID_61
65    Alagoas           AL     ID_57
66    Alagoas           AL     ID_58
23      Amapá           AP     ID_74
24      Amapá           AP     ID_75
25      Amapá           AP     ID_84
26      Amapá           AP     ID_85
\end{verbatim}

\hypertarget{bibliografia-consultada}{%
\chapter*{Bibliografia consultada}\label{bibliografia-consultada}}
\addcontentsline{toc}{chapter}{Bibliografia consultada}

Chang, Winston. 2021. R Graphics Cookbook. 2nd ed.~Beijing: O'Reilly Media. \url{https://r-graphics.org/}.

Damiani, Athos; Lente, Caio; Milz, Beatriz; Falbel, Daniel; Correa, Fernando; Trecenti, Julio; Luduvice, Nicole; Amorim, William. 2021. Ciência de Dados em R. Curso-R. \url{https://livro.curso-r.com/index.html}.

Wickham, Hadley; Grolemund, Garrett. 2017. R for Data Science. 1st ed.~Sebastopol, California: O'Reilly Media. \url{https://r4ds.had.co.nz/index.html}.

Xie, Yihui. 2015. Dynamic Documents with R and Knitr. 2nd ed.~Boca Raton, Florida: Chapman; Hall/CRC. \url{http://yihui.org/knitr/}. 2021. Bookdown: Authoring Books and Technical Documents with r Markdown. \url{https://CRAN.R-project.org/package=bookdown}.

  \bibliography{book.bib,packages.bib}

\end{document}
